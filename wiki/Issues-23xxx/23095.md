# Issue 23095: autogen/interpreters does NOT work

archive/issues_022858.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nAfter making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.\n\nIn particular, the following should cause an error while building the interpreters, but it did not:\n\n```diff\ndiff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py\nindex 3af99b2..5a3bfbb 100644\n--- a/src/sage_setup/autogen/interpreters/generator.py\n+++ b/src/sage_setup/autogen/interpreters/generator.py\n@@ -316,6 +316,8 @@ class InterpreterGenerator(object):\n             sage: print(buff.getvalue())\n             # Automatically generated by ...\n         \"\"\"\n+        assert False\n+\n         s = self._spec\n         w = write\n         types = set()\n```\n\nThe reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):\n\n```python\n    # Although multiple files are generated by this function, since\n    # they are all generated at once it suffices to make sure if just\n    # one of the generated files is older than the generator sources\n    src_file = __file__\n    gen_file = os.path.join(dirname, '__init__.py')\n\n    if os.path.exists(gen_file):\n        if getmtime(gen_file) > getmtime(src_file) and not force:\n            return\n```\n\nCC:  @embray @jpflori\n\nComponent: **build**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**\n\nReviewer: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23095_\n\n",
    "closed_at": "2017-06-04T10:11:03Z",
    "created_at": "2017-05-29T12:39:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "autogen/interpreters does NOT work",
    "type": "issue",
    "updated_at": "2017-06-04T10:11:03Z",
    "url": "https://github.com/sagemath/sage/issues/23095",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

After making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.

In particular, the following should cause an error while building the interpreters, but it did not:

```diff
diff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py
index 3af99b2..5a3bfbb 100644
--- a/src/sage_setup/autogen/interpreters/generator.py
+++ b/src/sage_setup/autogen/interpreters/generator.py
@@ -316,6 +316,8 @@ class InterpreterGenerator(object):
             sage: print(buff.getvalue())
             # Automatically generated by ...
         """
+        assert False
+
         s = self._spec
         w = write
         types = set()
```

The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):

```python
    # Although multiple files are generated by this function, since
    # they are all generated at once it suffices to make sure if just
    # one of the generated files is older than the generator sources
    src_file = __file__
    gen_file = os.path.join(dirname, '__init__.py')

    if os.path.exists(gen_file):
        if getmtime(gen_file) > getmtime(src_file) and not force:
            return
```

CC:  @embray @jpflori

Component: **build**

Author: **Jeroen Demeyer**

Branch/Commit: **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**

Reviewer: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/23095_





---

archive/issue_events_319343.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T12:39:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319343"
}
```



---

archive/issue_events_319344.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T12:39:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319344"
}
```



---

archive/issue_events_319345.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T12:39:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319345"
}
```



---

archive/issue_events_319346.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T12:39:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319346"
}
```



---

archive/issue_comments_345852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,17 @@\n          w = write\n          types = set()\n ```\n+\n+The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):\n+\n+```python\n+    # Although multiple files are generated by this function, since\n+    # they are all generated at once it suffices to make sure if just\n+    # one of the generated files is older than the generator sources\n+    src_file = __file__\n+    gen_file = os.path.join(dirname, '__init__.py')\n+\n+    if os.path.exists(gen_file):\n+        if getmtime(gen_file) > getmtime(src_file) and not force:\n+            return\n+```\n``````\n",
    "created_at": "2017-05-29T12:41:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345852",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,17 @@
          w = write
          types = set()
 ```
+
+The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):
+
+```python
+    # Although multiple files are generated by this function, since
+    # they are all generated at once it suffices to make sure if just
+    # one of the generated files is older than the generator sources
+    src_file = __file__
+    gen_file = os.path.join(dirname, '__init__.py')
+
+    if os.path.exists(gen_file):
+        if getmtime(gen_file) > getmtime(src_file) and not force:
+            return
+```
``````




---

archive/issue_comments_345853.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-05-29T13:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345853",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_345854.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.",
    "created_at": "2017-05-29T13:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345854",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

I think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.



---

archive/issue_comments_345855.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI think there was one point where it was `src_files` but in one of the last rebases it got messed up.",
    "created_at": "2017-05-29T13:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345855",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

I think there was one point where it was `src_files` but in one of the last rebases it got messed up.



---

archive/issue_comments_345856.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)**",
    "created_at": "2017-05-29T13:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345856",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)**



---

archive/issue_events_319347.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T13:13:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319347"
}
```



---

archive/issue_comments_345857.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a\"><code>82f91f2</code></a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>\n",
    "created_at": "2017-05-29T13:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345857",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a"><code>82f91f2</code></a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>




---

archive/issue_comments_345858.json:
```json
{
    "body": "Commit: **[`82f91f2`](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)**",
    "created_at": "2017-05-29T13:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345858",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`82f91f2`](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)**



---

archive/issue_events_319348.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-29T13:18:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319348"
}
```



---

archive/issue_events_319349.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-29T13:18:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319349"
}
```



---

archive/issue_comments_345859.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.",
    "created_at": "2017-05-29T13:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345859",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.



---

archive/issue_comments_345860.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-05-29T13:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345860",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_345861.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAt first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.",
    "created_at": "2017-05-29T14:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345861",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

At first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.



---

archive/issue_comments_345862.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like \"checking if rebuild needed failed: <actual error>\").",
    "created_at": "2017-05-29T16:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345862",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like "checking if rebuild needed failed: <actual error>").



---

archive/issue_comments_345863.json:
```json
{
    "body": "Changed commit from **[`82f91f2`](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)** to **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**",
    "created_at": "2017-05-30T15:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345863",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`82f91f2`](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)** to **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**



---

archive/issue_comments_345864.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939\"><code>aaedeff</code></a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>\n",
    "created_at": "2017-05-30T15:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345864",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939"><code>aaedeff</code></a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>




---

archive/issue_events_319350.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-30T15:25:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319350"
}
```



---

archive/issue_events_319351.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-30T15:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319351"
}
```



---

archive/issue_comments_345865.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI don't want to make this more complicated than it needs to be. This is reverting to my original idea.",
    "created_at": "2017-05-30T15:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345865",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

I don't want to make this more complicated than it needs to be. This is reverting to my original idea.



---

archive/issue_events_319352.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-31T10:13:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319352"
}
```



---

archive/issue_events_319353.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-31T10:13:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319353"
}
```



---

archive/issue_comments_345866.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOkay, seems fine.",
    "created_at": "2017-05-31T10:13:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345866",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Okay, seems fine.



---

archive/issue_events_319354.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-04T10:11:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319354"
}
```



---

archive/issue_events_319355.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a2901ca8a321c73fa93b1a0d284e05cc14ab06cc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-04T10:11:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23095#event-319355"
}
```



---

archive/issue_comments_345867.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)** to **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**",
    "created_at": "2017-06-04T10:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23095#issuecomment-345867",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)** to **[`aaedeff`](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)**
