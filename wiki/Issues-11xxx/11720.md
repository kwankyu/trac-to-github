# Issue 11720: regularly refresh the pickle jar

archive/issues_011548.json:
```json
{
    "body": "The pickle jar hasn't been refreshed in a very long time.  We need a system in place that continually adds pickles to the jar, and keeps the old pickles around.\n\n**Assignee:** @williamstein\n\n**CC:**  @vbraun\n\n**Branch:** [public/11720](https://github.com/sagemath/sagetrac-mirror/tree/public/11720)\n\nIssue created by migration from https://trac.sagemath.org/ticket/11720\n\n",
    "closed_at": "2017-03-08T13:19:24Z",
    "created_at": "2011-08-23T08:14:53Z",
    "labels": [
        "component: pickling",
        "enhancement",
        "duplicate"
    ],
    "title": "regularly refresh the pickle jar",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11720",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```
The pickle jar hasn't been refreshed in a very long time.  We need a system in place that continually adds pickles to the jar, and keeps the old pickles around.

**Assignee:** @williamstein

**CC:**  @vbraun

**Branch:** [public/11720](https://github.com/sagemath/sagetrac-mirror/tree/public/11720)

Issue created by migration from https://trac.sagemath.org/ticket/11720





---

archive/issue_events_094139.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94139"
}
```



---

archive/issue_events_094140.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94140"
}
```



---

archive/issue_events_094141.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94141"
}
```



---

archive/issue_events_094142.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94142"
}
```



---

archive/issue_comments_123880.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess one question that needs to be addressed is: How can we keep track of the pickle jar *with git*? IICTC, the pickle jar is not under version control, and being a binary file (`.tar.bz2`) it *shouldn't* be under version control.\n\nEach item in the pickle jar corresponds to a pair of files. One file is pure text, describing the Sage version used to create the pickle, the class whose instance is pickled, and the expected string representation of the unpickled object. The second file is the actual pickle, `.sobj`.\n\nIs git able to look into bzipped tar files? If this was the case, then we could at least let git track the text files associated with the pickles.\n\nAnother question that needs to be addressed: How to post changes of the pickle jar on a trac ticket? Shall one attach the new version of the pickle jar, leaving a comment for the release manager asking him/her to replace the old jar with the new jar? That's why I put Volker on Cc (Hi Volker...).\n\nAnd perhaps it would be nice to have a function that automatically creates a new pickle in the jar. Yes, I know, there is a function that puts a \"text file\"-\"sobj\"-pair for a given object into a given directory. However, some manual work is currently involved to move this into `SAGE_EXTCODE/pickle_jar/pickle_jar.tar.bz2`, and this should easily be automated.\n\nConcerning the topic of this trac ticket: If I understand correctly, there is an option to automatically create a pickle jar during `sage -t`, containing pickles for all objects that are subject to a `loads/dumps` doc test. But perhaps this is overzealous, and in addition the result would currently not be automatically put into the standard pickle jar.\n\nHowever, this could be used as a starting point, to be modified so that\n1. the resulting pickles would automatically be put into the standard bzipped pickle jar in `SAGE_EXTCODE`\n2. only *new* pickles will be added: If an sobj created in version 5.9 is bitwise identical with an sobj created in version 6.1, then we should only have one copy of it in the pickle jar.",
    "created_at": "2014-05-02T21:32:25Z",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11720#issuecomment-123880",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
I guess one question that needs to be addressed is: How can we keep track of the pickle jar *with git*? IICTC, the pickle jar is not under version control, and being a binary file (`.tar.bz2`) it *shouldn't* be under version control.

Each item in the pickle jar corresponds to a pair of files. One file is pure text, describing the Sage version used to create the pickle, the class whose instance is pickled, and the expected string representation of the unpickled object. The second file is the actual pickle, `.sobj`.

Is git able to look into bzipped tar files? If this was the case, then we could at least let git track the text files associated with the pickles.

Another question that needs to be addressed: How to post changes of the pickle jar on a trac ticket? Shall one attach the new version of the pickle jar, leaving a comment for the release manager asking him/her to replace the old jar with the new jar? That's why I put Volker on Cc (Hi Volker...).

And perhaps it would be nice to have a function that automatically creates a new pickle in the jar. Yes, I know, there is a function that puts a "text file"-"sobj"-pair for a given object into a given directory. However, some manual work is currently involved to move this into `SAGE_EXTCODE/pickle_jar/pickle_jar.tar.bz2`, and this should easily be automated.

Concerning the topic of this trac ticket: If I understand correctly, there is an option to automatically create a pickle jar during `sage -t`, containing pickles for all objects that are subject to a `loads/dumps` doc test. But perhaps this is overzealous, and in addition the result would currently not be automatically put into the standard pickle jar.

However, this could be used as a starting point, to be modified so that
1. the resulting pickles would automatically be put into the standard bzipped pickle jar in `SAGE_EXTCODE`
2. only *new* pickles will be added: If an sobj created in version 5.9 is bitwise identical with an sobj created in version 6.1, then we should only have one copy of it in the pickle jar.



---

archive/issue_comments_123881.json:
```json
{
    "body": "<a id='comment:4'></a>\nGit doesn't do anything special for bzipped files, in particular space usage will grow with the size of the pickle jar.\n\nHow about we distribute the pickle jar like any other database, as a tarball with a dummy `build/pkg/pickle_jar`?",
    "created_at": "2014-05-03T08:12:35Z",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11720#issuecomment-123881",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Git doesn't do anything special for bzipped files, in particular space usage will grow with the size of the pickle jar.

How about we distribute the pickle jar like any other database, as a tarball with a dummy `build/pkg/pickle_jar`?



---

archive/issue_events_094143.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94143"
}
```



---

archive/issue_events_094144.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94144"
}
```



---

archive/issue_events_094145.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94145"
}
```



---

archive/issue_events_094146.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94146"
}
```



---

archive/issue_events_094147.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-08T13:19:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94147"
}
```



---

archive/issue_comments_123882.json:
```json
{
    "body": "<a id='comment:7'></a>\nDuplicate of #10768.",
    "created_at": "2017-03-08T13:19:24Z",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11720#issuecomment-123882",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Duplicate of #10768.



---

archive/issue_events_094148.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-08T13:19:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94148"
}
```



---

archive/issue_events_094149.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-08T13:19:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "label": "duplicate",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11720#event-94149"
}
```



---

archive/issue_comments_123883.json:
```json
{
    "body": "**Branch:** [public/11720](https://github.com/sagemath/sagetrac-mirror/tree/public/11720)",
    "created_at": "2021-01-29T02:56:06Z",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11720#issuecomment-123883",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Branch:** [public/11720](https://github.com/sagemath/sagetrac-mirror/tree/public/11720)



---

archive/issue_comments_123884.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry, this branch was intended for a ticket #17720 (typo).",
    "created_at": "2021-01-29T02:56:06Z",
    "issue": "https://github.com/sagemath/sage/issues/11720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11720#issuecomment-123884",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:8'></a>
Sorry, this branch was intended for a ticket #17720 (typo).
