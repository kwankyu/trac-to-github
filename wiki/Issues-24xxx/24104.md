# Issue 24104: Merge the code of ex.solve(...) and solve(...)

archive/issues_023867.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nBoth `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `solve` makes several attempts.\n\nIn order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.\n\nCC:  @mforets\n\nComponent: **symbolics**\n\nAuthor: **Ralf Stephan, Travis Scrimshaw**\n\nBranch/Commit: **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**\n\nReviewer: **Travis Scrimshaw, Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24104_\n\n",
    "closed_at": "2017-11-02T11:05:57Z",
    "created_at": "2017-10-25T13:31:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Merge the code of ex.solve(...) and solve(...)",
    "type": "issue",
    "updated_at": "2017-11-02T11:05:57Z",
    "url": "https://github.com/sagemath/sage/issues/24104",
    "user": "https://github.com/rwst"
}
```
<div id="comment:0"></div>

Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `solve` makes several attempts.

In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.

CC:  @mforets

Component: **symbolics**

Author: **Ralf Stephan, Travis Scrimshaw**

Branch/Commit: **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**

Reviewer: **Travis Scrimshaw, Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/24104_





---

archive/issue_events_331918.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T13:31:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331918"
}
```



---

archive/issue_events_331919.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T13:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331919"
}
```



---

archive/issue_events_331920.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T13:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331920"
}
```



---

archive/issue_comments_364530.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `ex.solve` uses the pexpect interface, and only `solve` makes several attempts.\n \n-In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will througout use maxima-lib. No doctest should be in need of change, except for improved output.\n+In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, and finally remove another instance of pexpect Maxima usage---, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.\n``````\n",
    "created_at": "2017-10-25T13:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364530",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `ex.solve` uses the pexpect interface, and only `solve` makes several attempts.
 
-In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will througout use maxima-lib. No doctest should be in need of change, except for improved output.
+In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, and finally remove another instance of pexpect Maxima usage---, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.
``````




---

archive/issue_events_331921.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T13:39:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331921"
}
```



---

archive/issue_comments_364531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `ex.solve` uses the pexpect interface, and only `solve` makes several attempts.\n+Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `solve` makes several attempts.\n \n-In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, and finally remove another instance of pexpect Maxima usage---, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.\n+In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.\n``````\n",
    "created_at": "2017-10-25T14:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364531",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `ex.solve` uses the pexpect interface, and only `solve` makes several attempts.
+Both `Expression.solve(...)` and global `solve(...)` use Maxima for solving (in)equalities but use their own code which agrees in part, and provide some of the same options.  The first allows univariate forms/relations, the second additionally systems, and several variables. Further differences are e.g. that only `solve` makes several attempts.
 
-In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, and finally remove another instance of pexpect Maxima usage---, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.
+In order to give users the full capabilities, regardless how called, and to ease maintenance and addition of improvements, this ticket should move the `ex.solve` code into `solve`, leaving only an interface to it. It will throughout use maxima-lib. No doctest should be in need of change, except for improved output.
``````




---

archive/issue_comments_364532.json:
```json
{
    "body": "Branch: **[u/rws/merge_the_code_of_ex_solve______and_solve_____](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/merge_the_code_of_ex_solve______and_solve_____)**",
    "created_at": "2017-10-26T08:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364532",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/merge_the_code_of_ex_solve______and_solve_____](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/merge_the_code_of_ex_solve______and_solve_____)**



---

archive/issue_events_331922.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-26T08:23:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331922"
}
```



---

archive/issue_comments_364533.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis already passes all tests in symbolic, calculus, tests, and doc. I think the solvers have a good home in `relation.py`. In a next ticket the doctests should be moved.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156\"><code>7caa1c4</code></a></td><td><code>24104: Merge the code of ex.solve(...) and solve(...)</code></td></tr></table>\n",
    "created_at": "2017-10-26T08:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364533",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

This already passes all tests in symbolic, calculus, tests, and doc. I think the solvers have a good home in `relation.py`. In a next ticket the doctests should be moved.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156"><code>7caa1c4</code></a></td><td><code>24104: Merge the code of ex.solve(...) and solve(...)</code></td></tr></table>




---

archive/issue_comments_364534.json:
```json
{
    "body": "Commit: **[`7caa1c4`](https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156)**",
    "created_at": "2017-10-26T08:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364534",
    "user": "https://github.com/rwst"
}
```

Commit: **[`7caa1c4`](https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156)**



---

archive/issue_comments_364535.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2017-10-26T08:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364535",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_364536.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWe can be a bit more concise, which IMO is more readable:\n\n```diff\n-        for i in x:\n-            if not isinstance(i, Expression):\n-                raise TypeError(\"%s is not a valid variable.\" % repr(i))\n+        if not all(isinstance(i, Expression) for i in x):\n+            raise TypeError(\"%s is not a valid variable\" % repr(i))\n```\n\nI feel like the handling of `f` being a single expression should be a separate function that is called by `solve` but still in the same file. It always returns something and is effectively called later in `solve` in special cases. IMO, this makes it easier to understand and maintain with independent doctests.\n\nI am tempted to keep it as a method of `Expression`, but I agree overall with the purpose of the ticket to have a uniform interface and behavior. This change also gives better code grouping. However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above. Your thoughts and counters?",
    "created_at": "2017-10-28T01:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364536",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

We can be a bit more concise, which IMO is more readable:

```diff
-        for i in x:
-            if not isinstance(i, Expression):
-                raise TypeError("%s is not a valid variable." % repr(i))
+        if not all(isinstance(i, Expression) for i in x):
+            raise TypeError("%s is not a valid variable" % repr(i))
```

I feel like the handling of `f` being a single expression should be a separate function that is called by `solve` but still in the same file. It always returns something and is effectively called later in `solve` in special cases. IMO, this makes it easier to understand and maintain with independent doctests.

I am tempted to keep it as a method of `Expression`, but I agree overall with the purpose of the ticket to have a uniform interface and behavior. This change also gives better code grouping. However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above. Your thoughts and counters?



---

archive/issue_comments_364537.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@tscrim](#comment%3A6):\n> We can be a bit more concise, which IMO is more readable:\n> \n> ```diff\n> -        for i in x:\n> -            if not isinstance(i, Expression):\n> -                raise TypeError(\"%s is not a valid variable.\" % repr(i))\n> +        if not all(isinstance(i, Expression) for i in x):\n> +            raise TypeError(\"%s is not a valid variable\" % repr(i))\n> ```\n\nThis will not work because `i` is local to `all`. Actually, I changed that snippet specifically because all of `x` was given in the error, but I wanted to print only the part failing.",
    "created_at": "2017-10-28T06:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364537",
    "user": "https://github.com/rwst"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@tscrim](#comment%3A6):
> We can be a bit more concise, which IMO is more readable:
> 
> ```diff
> -        for i in x:
> -            if not isinstance(i, Expression):
> -                raise TypeError("%s is not a valid variable." % repr(i))
> +        if not all(isinstance(i, Expression) for i in x):
> +            raise TypeError("%s is not a valid variable" % repr(i))
> ```

This will not work because `i` is local to `all`. Actually, I changed that snippet specifically because all of `x` was given in the error, but I wanted to print only the part failing.



---

archive/issue_comments_364538.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@tscrim](#comment%3A6):\n> I am tempted to keep it as a method of `Expression`\n\nI really would like to have short code snippets in `expression.py` with long functions and documentation elsewhere. You can't put all of symbolics in one file but Python forces us (because classes can't be split).",
    "created_at": "2017-10-28T06:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364538",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@tscrim](#comment%3A6):
> I am tempted to keep it as a method of `Expression`

I really would like to have short code snippets in `expression.py` with long functions and documentation elsewhere. You can't put all of symbolics in one file but Python forces us (because classes can't be split).



---

archive/issue_comments_364539.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tscrim](#comment%3A6):\n> However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above.\n\nThe problem is then that code has to be duplicated, e.g. the variable check above. I'm not averse to the idea in principle, separating out would need looking at the doctests which I didn't want to in this ticket. I propose to try it later when moving the doctests from `expression.py`.",
    "created_at": "2017-10-28T06:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364539",
    "user": "https://github.com/rwst"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tscrim](#comment%3A6):
> However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above.

The problem is then that code has to be duplicated, e.g. the variable check above. I'm not averse to the idea in principle, separating out would need looking at the doctests which I didn't want to in this ticket. I propose to try it later when moving the doctests from `expression.py`.



---

archive/issue_comments_364540.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHowever if you don't mind additionally reviewing extended changes to documentation I can put it in this ticket.",
    "created_at": "2017-10-28T06:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364540",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

However if you don't mind additionally reviewing extended changes to documentation I can put it in this ticket.



---

archive/issue_comments_364541.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@rwst](#comment%3A8):\n> Replying to [@tscrim](#comment%3A6):\n> > I am tempted to keep it as a method of `Expression`\n> \n> \n> I really would like to have short code snippets in `expression.py` with long functions and documentation elsewhere. You can't put all of symbolics in one file but Python forces us (because classes can't be split).\n\nThat's not true. Look at the graph code for a \"real world\" example, but basically, it does this:\n\n```python\nsage: def bar(self, x):  # Say this was in a separate file\n....:     return self._y + x\nsage: class Foo(object):\n....:     _y = 10\n....:     bar = bar\nsage: F = Foo()\nsage: F.bar(5)\n15\n```",
    "created_at": "2017-10-28T08:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364541",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@rwst](#comment%3A8):
> Replying to [@tscrim](#comment%3A6):
> > I am tempted to keep it as a method of `Expression`
> 
> 
> I really would like to have short code snippets in `expression.py` with long functions and documentation elsewhere. You can't put all of symbolics in one file but Python forces us (because classes can't be split).

That's not true. Look at the graph code for a "real world" example, but basically, it does this:

```python
sage: def bar(self, x):  # Say this was in a separate file
....:     return self._y + x
sage: class Foo(object):
....:     _y = 10
....:     bar = bar
sage: F = Foo()
sage: F.bar(5)
15
```



---

archive/issue_comments_364542.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@rwst](#comment%3A9):\n> Replying to [@tscrim](#comment%3A6):\n> > However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above.\n> \n> \n> The problem is then that code has to be duplicated, e.g. the variable check above. I'm not averse to the idea in principle, separating out would need looking at the doctests which I didn't want to in this ticket. I propose to try it later when moving the doctests from `expression.py`.\n\nI didn't feel like that would be hard to split out as a separate little helper function to avoid the duplication. Although at the same time it didn't seem like there would be too much in the way of code duplication, but maybe I am not looking closely enough.",
    "created_at": "2017-10-28T08:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364542",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@rwst](#comment%3A9):
> Replying to [@tscrim](#comment%3A6):
> > However, with the current branch, I don't feel like the two functions have been merged as they feel somewhat separate as per my comments above.
> 
> 
> The problem is then that code has to be duplicated, e.g. the variable check above. I'm not averse to the idea in principle, separating out would need looking at the doctests which I didn't want to in this ticket. I propose to try it later when moving the doctests from `expression.py`.

I didn't feel like that would be hard to split out as a separate little helper function to avoid the duplication. Although at the same time it didn't seem like there would be too much in the way of code duplication, but maybe I am not looking closely enough.



---

archive/issue_comments_364543.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@rwst](#comment%3A10):\n> However if you don't mind additionally reviewing extended changes to documentation I can put it in this ticket.\n\nI don't mind if it makes things easier to do for you.",
    "created_at": "2017-10-28T08:08:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364543",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@rwst](#comment%3A10):
> However if you don't mind additionally reviewing extended changes to documentation I can put it in this ticket.

I don't mind if it makes things easier to do for you.



---

archive/issue_comments_364544.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@tscrim](#comment%3A11):\n> That's not true. Look at the graph code for a \"real world\" example, but basically, it does this:\n\n(dynamically adding methods)\n\nThat's true! And I did it a few weeks ago in `interfaces/sympy` <slap head/>",
    "created_at": "2017-10-28T08:38:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364544",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@tscrim](#comment%3A11):
> That's not true. Look at the graph code for a "real world" example, but basically, it does this:

(dynamically adding methods)

That's true! And I did it a few weeks ago in `interfaces/sympy` <slap head/>



---

archive/issue_comments_364545.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86e9c201a75408816f76bde25208d46f9d73e692\"><code>86e9c20</code></a></td><td><code>24104: move doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9\"><code>91cb91f</code></a></td><td><code>24104: solve no longer calls itself</code></td></tr></table>\n",
    "created_at": "2017-10-29T16:15:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364545",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86e9c201a75408816f76bde25208d46f9d73e692"><code>86e9c20</code></a></td><td><code>24104: move doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9"><code>91cb91f</code></a></td><td><code>24104: solve no longer calls itself</code></td></tr></table>




---

archive/issue_comments_364546.json:
```json
{
    "body": "Changed commit from **[`7caa1c4`](https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156)** to **[`91cb91f`](https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9)**",
    "created_at": "2017-10-29T16:15:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364546",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7caa1c4`](https://github.com/sagemath/sagetrac-mirror/commit/7caa1c467f857cd598311ba52d2c5bf8e8ff3156)** to **[`91cb91f`](https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9)**



---

archive/issue_comments_364547.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tscrim](#comment%3A6):\n> It always returns something and is effectively called later in `solve` in special cases. IMO, this makes it easier to understand and maintain with independent doctests.\n\nCalling itself is not necessary and it's easy to rewrite without this call. While I agree with having structure in the doctests, they serve as highly visible example when a user inputs `solve?`. Separating them makes them partly inaccessible.\n\nPlease review.",
    "created_at": "2017-10-29T16:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364547",
    "user": "https://github.com/rwst"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tscrim](#comment%3A6):
> It always returns something and is effectively called later in `solve` in special cases. IMO, this makes it easier to understand and maintain with independent doctests.

Calling itself is not necessary and it's easy to rewrite without this call. While I agree with having structure in the doctests, they serve as highly visible example when a user inputs `solve?`. Separating them makes them partly inaccessible.

Please review.



---

archive/issue_comments_364548.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks. Although I think it would be better for the `is_Expression(f)` case to be a separate function within `relation.py`, say\n\n```python\ndef _solve_expression(f, x, explicit_solutions, multiplicities, to_poly_solve, solution_dict):\n   \"\"\"\n   Solve an expression ``f``. For more information, see :func:`solve`.\n\n   TESTS:\n\n   Only tests that check :trac:`ABCDE` is fixed::\n   \"\"\"\n   # Code here\n```\nThis gives better localization of (relevant) tests, does not introduce any doc issues (it is mainly an implementation detail), and can be called with your already parsed input. If you do not agree, then what you currently have is acceptable. Yet, it is quite a big function, and I feel it is more maintainable in smaller bites. I can also do that refactoring too if you'd want.",
    "created_at": "2017-10-29T22:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364548",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks. Although I think it would be better for the `is_Expression(f)` case to be a separate function within `relation.py`, say

```python
def _solve_expression(f, x, explicit_solutions, multiplicities, to_poly_solve, solution_dict):
   """
   Solve an expression ``f``. For more information, see :func:`solve`.

   TESTS:

   Only tests that check :trac:`ABCDE` is fixed::
   """
   # Code here
```
This gives better localization of (relevant) tests, does not introduce any doc issues (it is mainly an implementation detail), and can be called with your already parsed input. If you do not agree, then what you currently have is acceptable. Yet, it is quite a big function, and I feel it is more maintainable in smaller bites. I can also do that refactoring too if you'd want.



---

archive/issue_comments_364549.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nPlease do. I'm a bit entamgled today.",
    "created_at": "2017-10-30T04:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364549",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

Please do. I'm a bit entamgled today.



---

archive/issue_comments_364550.json:
```json
{
    "body": "Changed branch from **[u/rws/merge_the_code_of_ex_solve______and_solve_____](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/merge_the_code_of_ex_solve______and_solve_____)** to **[public/symbolcs/merge_solves-24104](https://github.com/sagemath/sagetrac-mirror/tree/public/symbolcs/merge_solves-24104)**",
    "created_at": "2017-10-30T08:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364550",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/rws/merge_the_code_of_ex_solve______and_solve_____](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/merge_the_code_of_ex_solve______and_solve_____)** to **[public/symbolcs/merge_solves-24104](https://github.com/sagemath/sagetrac-mirror/tree/public/symbolcs/merge_solves-24104)**



---

archive/issue_comments_364551.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHere you go.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff\"><code>0f6e826</code></a></td><td><code>Move the single expression solver into stand-alone function for granularity plus some mild cleanup.</code></td></tr></table>\n",
    "created_at": "2017-10-30T08:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364551",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Here you go.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff"><code>0f6e826</code></a></td><td><code>Move the single expression solver into stand-alone function for granularity plus some mild cleanup.</code></td></tr></table>




---

archive/issue_comments_364552.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-10-30T08:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364552",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_364553.json:
```json
{
    "body": "Changed commit from **[`91cb91f`](https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9)** to **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**",
    "created_at": "2017-10-30T08:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364553",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`91cb91f`](https://github.com/sagemath/sagetrac-mirror/commit/91cb91f846ebfbea538fbaacad7780c1867d19f9)** to **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**



---

archive/issue_comments_364554.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**",
    "created_at": "2017-10-31T14:10:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364554",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**



---

archive/issue_events_331923.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-31T14:10:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331923"
}
```



---

archive/issue_events_331924.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-31T14:10:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331924"
}
```



---

archive/issue_comments_364555.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThanks. LGTM. I added you as author.",
    "created_at": "2017-10-31T14:10:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364555",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">comment:20</div>

Thanks. LGTM. I added you as author.



---

archive/issue_comments_364556.json:
```json
{
    "body": "Changed author from **Ralf Stephan** to **Ralf Stephan, Travis Scrimshaw**",
    "created_at": "2017-10-31T14:10:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364556",
    "user": "https://github.com/rwst"
}
```

Changed author from **Ralf Stephan** to **Ralf Stephan, Travis Scrimshaw**



---

archive/issue_events_331925.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-02T11:05:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331925"
}
```



---

archive/issue_events_331926.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4d82659aaa02c4bb02b7488d23616c28d503d338",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-11-02T11:05:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24104#event-331926"
}
```



---

archive/issue_comments_364557.json:
```json
{
    "body": "Changed branch from **[public/symbolcs/merge_solves-24104](https://github.com/sagemath/sagetrac-mirror/tree/public/symbolcs/merge_solves-24104)** to **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**",
    "created_at": "2017-11-02T11:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24104",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24104#issuecomment-364557",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/symbolcs/merge_solves-24104](https://github.com/sagemath/sagetrac-mirror/tree/public/symbolcs/merge_solves-24104)** to **[`0f6e826`](https://github.com/sagemath/sagetrac-mirror/commit/0f6e8265f9ebc448d4aa4004ef0c6b504560b6ff)**
