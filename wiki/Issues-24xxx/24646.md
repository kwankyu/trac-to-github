# Issue 24646: Add support for staged installations in packages that use sdh_pip_install

archive/issues_024409.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis implements #22509 for any Python packages that are installed with `sdh_pip_install`.  Passing `--root=` to pip is essentially the same as using `DESTDIR` with `make install`.\n\nThis required a few additional changes to a small handful of packages for them to work with staged installation.\n\nComponent: **build**\n\nAuthor: **Erik Bray**\n\nBranch/Commit: **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**\n\nReviewer: **Julian R\u00fcth**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24646_\n\n",
    "closed_at": "2018-08-05T08:43:12Z",
    "created_at": "2018-02-02T13:50:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add support for staged installations in packages that use sdh_pip_install",
    "type": "issue",
    "updated_at": "2018-08-05T08:43:12Z",
    "url": "https://github.com/sagemath/sage/issues/24646",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

This implements #22509 for any Python packages that are installed with `sdh_pip_install`.  Passing `--root=` to pip is essentially the same as using `DESTDIR` with `make install`.

This required a few additional changes to a small handful of packages for them to work with staged installation.

Component: **build**

Author: **Erik Bray**

Branch/Commit: **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**

Reviewer: **Julian RÃ¼th**

_Issue created by migration from https://trac.sagemath.org/ticket/24646_





---

archive/issue_events_338482.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338482"
}
```



---

archive/issue_events_338483.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338483"
}
```



---

archive/issue_events_338484.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338484"
}
```



---

archive/issue_events_338485.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338485"
}
```



---

archive/issue_events_338486.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338486"
}
```



---

archive/issue_comments_373791.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a591ffb6a55aa36ca84f105d0ffb304ab66eae48\"><code>a591ffb</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/599668c1ded51d5603395fe7e328cd5522b3dd0f\"><code>599668c</code></a></td><td><code>The postinst script should probably be run with SAGE_SUDO if it is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac34ecbe33d0fec7462374b05698aac4bd52bda7\"><code>ac34ecb</code></a></td><td><code>Add a paragraph to the docs about spkg-postinst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6519c3fe185169388743ed7742250c7988df9761\"><code>6519c3f</code></a></td><td><code>Use $SAGE_SUDO, in case it's set, when moving files from the $SAGE_DESTDIR to $SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/454b75b4a9dbf3a02bedc59392aaa1c875b37eff\"><code>454b75b</code></a></td><td><code>Don't use SAGE_SUDO in these helpers if SAGE_DESTDIR is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56\"><code>fcd6e5d</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-03-26T11:18:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373791",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a591ffb6a55aa36ca84f105d0ffb304ab66eae48"><code>a591ffb</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/599668c1ded51d5603395fe7e328cd5522b3dd0f"><code>599668c</code></a></td><td><code>The postinst script should probably be run with SAGE_SUDO if it is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac34ecbe33d0fec7462374b05698aac4bd52bda7"><code>ac34ecb</code></a></td><td><code>Add a paragraph to the docs about spkg-postinst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6519c3fe185169388743ed7742250c7988df9761"><code>6519c3f</code></a></td><td><code>Use $SAGE_SUDO, in case it's set, when moving files from the $SAGE_DESTDIR to $SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/454b75b4a9dbf3a02bedc59392aaa1c875b37eff"><code>454b75b</code></a></td><td><code>Don't use SAGE_SUDO in these helpers if SAGE_DESTDIR is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56"><code>fcd6e5d</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_comments_373792.json:
```json
{
    "body": "Changed commit from **[`efecbb5`](https://github.com/sagemath/sagetrac-mirror/commit/efecbb56eb5e9743f63e0b24a639ae4edddf5c8b)** to **[`fcd6e5d`](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)**",
    "created_at": "2018-03-26T11:18:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373792",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`efecbb5`](https://github.com/sagemath/sagetrac-mirror/commit/efecbb56eb5e9743f63e0b24a639ae4edddf5c8b)** to **[`fcd6e5d`](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)**



---

archive/issue_comments_373793.json:
```json
{
    "body": "Changed commit from **[`fcd6e5d`](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)** to **[`fd1719e`](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)**",
    "created_at": "2018-03-26T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373793",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fcd6e5d`](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)** to **[`fd1719e`](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)**



---

archive/issue_comments_373794.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366\"><code>fd1719e</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-03-26T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373794",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366"><code>fd1719e</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_events_338487.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338487"
}
```



---

archive/issue_events_338488.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338488"
}
```



---

archive/issue_comments_373795.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nmerge failure on 8.3.b0",
    "created_at": "2018-05-12T19:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373795",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

merge failure on 8.3.b0



---

archive/issue_events_338489.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-12T19:57:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338489"
}
```



---

archive/issue_events_338490.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-12T19:57:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338490"
}
```



---

archive/issue_comments_373796.json:
```json
{
    "body": "Changed commit from **[`fd1719e`](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)** to **[`d03844b`](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)**",
    "created_at": "2018-05-14T15:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373796",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fd1719e`](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)** to **[`d03844b`](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)**



---

archive/issue_comments_373797.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b\"><code>d03844b</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-05-14T15:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373797",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b"><code>d03844b</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_comments_373798.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRebased since its dependency #24645 has been satisfied.",
    "created_at": "2018-05-14T15:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373798",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Rebased since its dependency #24645 has been satisfied.



---

archive/issue_comments_373799.json:
```json
{
    "body": "Changed dependencies from **#24645** to none",
    "created_at": "2018-05-14T15:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373799",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#24645** to none



---

archive/issue_events_338491.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-14T15:35:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338491"
}
```



---

archive/issue_events_338492.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-14T15:35:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338492"
}
```



---

archive/issue_events_338493.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-15T14:44:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338493"
}
```



---

archive/issue_events_338494.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-15T14:44:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338494"
}
```



---

archive/issue_comments_373800.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhat's up with `build/pkgs/widgetsnbextension/spkg-postinst`? That should just be removed.",
    "created_at": "2018-05-15T14:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373800",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

What's up with `build/pkgs/widgetsnbextension/spkg-postinst`? That should just be removed.



---

archive/issue_comments_373801.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor `sagenb`, why not keep\n\n```\nif [ ! -d mathjax ]; then\n    echo >&2 \"Error: Cannot symlink mathjax into the SageNB data directory.\"\n    exit 1\nfi\n```\nIt seems like a useful sanity check.",
    "created_at": "2018-05-15T14:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373801",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

For `sagenb`, why not keep

```
if [ ! -d mathjax ]; then
    echo >&2 "Error: Cannot symlink mathjax into the SageNB data directory."
    exit 1
fi
```
It seems like a useful sanity check.



---

archive/issue_comments_373802.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment%3A8):\n> What's up with `build/pkgs/widgetsnbextension/spkg-postinst`?\n\nLet me check whether or not that was intended to be in this branch.\n\n> That should just be removed.\n\nI don't see how you can assert that without knowing what it is.",
    "created_at": "2018-05-15T14:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373802",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment%3A8):
> What's up with `build/pkgs/widgetsnbextension/spkg-postinst`?

Let me check whether or not that was intended to be in this branch.

> That should just be removed.

I don't see how you can assert that without knowing what it is.



---

archive/issue_comments_373803.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jdemeyer](#comment%3A9):\n> For `sagenb`, why not keep\n\nYou can see just above that it checks that the directory being symlinked exists before making the symlink.",
    "created_at": "2018-05-15T15:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373803",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jdemeyer](#comment%3A9):
> For `sagenb`, why not keep

You can see just above that it checks that the directory being symlinked exists before making the symlink.



---

archive/issue_comments_373804.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@embray](#comment%3A11):\n> You can see just above that it checks that the directory being symlinked exists before making the symlink.\n\nIt's not at all obvious to me that the check *before* is equivalent to the `ln -s` succeeding. The check after is simpler and therefore safer.",
    "created_at": "2018-05-15T15:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373804",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@embray](#comment%3A11):
> You can see just above that it checks that the directory being symlinked exists before making the symlink.

It's not at all obvious to me that the check *before* is equivalent to the `ln -s` succeeding. The check after is simpler and therefore safer.



---

archive/issue_comments_373805.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@embray](#comment%3A10):\n> I don't see how you can assert that without knowing what it is.\n\nI know what it is because I wrote the original. The code which is in that `spkg-postinst` script used to be in `spkg-install` but it's no longer needed because of Jupyter improvements. At some point, you must have had a merge/rebase conflict with `spkg-install` and this left-over `spkg-postinst` script is fallout from that.",
    "created_at": "2018-05-15T15:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373805",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@embray](#comment%3A10):
> I don't see how you can assert that without knowing what it is.

I know what it is because I wrote the original. The code which is in that `spkg-postinst` script used to be in `spkg-install` but it's no longer needed because of Jupyter improvements. At some point, you must have had a merge/rebase conflict with `spkg-install` and this left-over `spkg-postinst` script is fallout from that.



---

archive/issue_comments_373806.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI see, you even removed the `jupyter nbextension` call a while ago (but probably after I first wrote this).  I believe you then, that it's no longer needed.",
    "created_at": "2018-05-15T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373806",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

I see, you even removed the `jupyter nbextension` call a while ago (but probably after I first wrote this).  I believe you then, that it's no longer needed.



---

archive/issue_comments_373807.json:
```json
{
    "body": "Changed commit from **[`d03844b`](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)** to **[`00bd3f3`](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)**",
    "created_at": "2018-05-16T09:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373807",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d03844b`](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)** to **[`00bd3f3`](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)**



---

archive/issue_comments_373808.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bbff408705de682799229f5d4c6bea3e8d2a044\"><code>6bbff40</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9\"><code>00bd3f3</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-05-16T09:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373808",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bbff408705de682799229f5d4c6bea3e8d2a044"><code>6bbff40</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9"><code>00bd3f3</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_373809.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOk, I dropped the `spkg-postinst` for `widgetsnbextension` and updated the sagenb install.  I think this is better now.",
    "created_at": "2018-05-16T09:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373809",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Ok, I dropped the `spkg-postinst` for `widgetsnbextension` and updated the sagenb install.  I think this is better now.



---

archive/issue_events_338495.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:53:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338495"
}
```



---

archive/issue_events_338496.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:53:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338496"
}
```



---

archive/issue_comments_373810.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor `sagenb`, you still removed the check for a working symlink. Why?",
    "created_at": "2018-05-16T10:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373810",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

For `sagenb`, you still removed the check for a working symlink. Why?



---

archive/issue_comments_373811.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe symlink wouldn't resolve because this is being installed in DESTDIR.",
    "created_at": "2018-05-16T12:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373811",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

The symlink wouldn't resolve because this is being installed in DESTDIR.



---

archive/issue_comments_373812.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe changes to Sphinx conflict with #24935. It is possible to just revert those?",
    "created_at": "2018-05-16T15:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373812",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

The changes to Sphinx conflict with #24935. It is possible to just revert those?



---

archive/issue_comments_373813.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nUnfortunately they're necessary for the package to install correctly.  You could merge this into #24935.",
    "created_at": "2018-05-16T15:13:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373813",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Unfortunately they're necessary for the package to install correctly.  You could merge this into #24935.



---

archive/issue_events_338497.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-06-01T23:40:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338497"
}
```



---

archive/issue_events_338498.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-06-01T23:40:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338498"
}
```



---

archive/issue_comments_373814.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nthere are merge conflicts",
    "created_at": "2018-06-01T23:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373814",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:21" align="right">comment:21</div>

there are merge conflicts



---

archive/issue_comments_373815.json:
```json
{
    "body": "Changed commit from **[`00bd3f3`](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)** to **[`208d754`](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)**",
    "created_at": "2018-06-02T15:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373815",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`00bd3f3`](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)** to **[`208d754`](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)**



---

archive/issue_comments_373816.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cb0a245ebd386bc1fb38d7d46d3bb548d53ad81\"><code>5cb0a24</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb\"><code>208d754</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-06-02T15:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373816",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cb0a245ebd386bc1fb38d7d46d3bb548d53ad81"><code>5cb0a24</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb"><code>208d754</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_events_338499.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-06-02T15:12:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338499"
}
```



---

archive/issue_events_338500.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-06-02T15:12:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338500"
}
```



---

archive/issue_comments_373817.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI'm surprised this hasn't been merged yet.  It really ought to be.",
    "created_at": "2018-06-02T15:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373817",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

I'm surprised this hasn't been merged yet.  It really ought to be.



---

archive/issue_comments_373818.json:
```json
{
    "body": "Work Issues: **merge conflicts**",
    "created_at": "2018-07-04T16:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373818",
    "user": "https://github.com/saraedum"
}
```

Work Issues: **merge conflicts**



---

archive/issue_comments_373819.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49aa08f9840c02b753eb5e92a3ae9ed3fbe8cee4\"><code>49aa08f</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f\"><code>449a6a2</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-07-10T16:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373819",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49aa08f9840c02b753eb5e92a3ae9ed3fbe8cee4"><code>49aa08f</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f"><code>449a6a2</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_373820.json:
```json
{
    "body": "Changed commit from **[`208d754`](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)** to **[`449a6a2`](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)**",
    "created_at": "2018-07-10T16:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373820",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`208d754`](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)** to **[`449a6a2`](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)**



---

archive/issue_comments_373821.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHere we go again...",
    "created_at": "2018-07-10T16:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373821",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Here we go again...



---

archive/issue_comments_373822.json:
```json
{
    "body": "Changed work issues from **merge conflicts** to none",
    "created_at": "2018-07-10T16:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373822",
    "user": "https://github.com/embray"
}
```

Changed work issues from **merge conflicts** to none



---

archive/issue_events_338501.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-11T13:55:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338501"
}
```



---

archive/issue_events_338502.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-11T13:55:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338502"
}
```



---

archive/issue_comments_373823.json:
```json
{
    "body": "Reviewer: **Julian R\u00fcth**",
    "created_at": "2018-07-11T13:55:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373823",
    "user": "https://github.com/saraedum"
}
```

Reviewer: **Julian RÃ¼th**



---

archive/issue_events_338503.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-15T09:47:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338503"
}
```



---

archive/issue_events_338504.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-15T09:47:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338504"
}
```



---

archive/issue_comments_373824.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSee patchbot",
    "created_at": "2018-07-15T09:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373824",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

See patchbot



---

archive/issue_comments_373825.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nApparently I had asked Jeroen to make this a prerequisite to #24935 (after all, this ticket was opened first and had no reason to wait so long to be merged).  But he forgot about that or ignored it (and I likewise forgot about it).",
    "created_at": "2018-07-16T10:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373825",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Apparently I had asked Jeroen to make this a prerequisite to #24935 (after all, this ticket was opened first and had no reason to wait so long to be merged).  But he forgot about that or ignored it (and I likewise forgot about it).



---

archive/issue_comments_373826.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1412f50557397b0b7dd78fed5d9e897e8054204\"><code>b1412f5</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887\"><code>4d20506</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-07-16T10:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373826",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1412f50557397b0b7dd78fed5d9e897e8054204"><code>b1412f5</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887"><code>4d20506</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_373827.json:
```json
{
    "body": "Changed commit from **[`449a6a2`](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)** to **[`4d20506`](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)**",
    "created_at": "2018-07-16T10:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373827",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`449a6a2`](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)** to **[`4d20506`](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)**



---

archive/issue_comments_373828.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThe `spkg-postinst` for Sphinx was simply no longer necessary so I removed it.",
    "created_at": "2018-07-16T10:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373828",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

The `spkg-postinst` for Sphinx was simply no longer necessary so I removed it.



---

archive/issue_events_338505.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-16T10:16:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338505"
}
```



---

archive/issue_events_338506.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-16T10:16:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338506"
}
```



---

archive/issue_comments_373829.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373829",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_338507.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338507"
}
```



---

archive/issue_events_338508.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338508"
}
```



---

archive/issue_events_338509.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T08:19:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338509"
}
```



---

archive/issue_events_338510.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T08:19:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338510"
}
```



---

archive/issue_comments_373830.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nYou obviously didn't try to build Sage with the ticket\n\n```\nNo record that 'sagenb' was ever installed; skipping uninstall\n./spkg-install: line 33: syntax error near unexpected token `fi'\n./spkg-install: line 33: `fi'\n```",
    "created_at": "2018-07-30T08:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373830",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

You obviously didn't try to build Sage with the ticket

```
No record that 'sagenb' was ever installed; skipping uninstall
./spkg-install: line 33: syntax error near unexpected token `fi'
./spkg-install: line 33: `fi'
```



---

archive/issue_comments_373831.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@vbraun](#comment%3A34):\n> You obviously didn't try to build Sage with the ticket\n\nThat's a bit flippant.  Of course I built Sage with this ticket.  It's been opened for 6 months and has had to be rebased many times.  Perhaps there was a small merge error along the way.  But that's not as if it was never tested...",
    "created_at": "2018-07-30T16:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373831",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@vbraun](#comment%3A34):
> You obviously didn't try to build Sage with the ticket

That's a bit flippant.  Of course I built Sage with this ticket.  It's been opened for 6 months and has had to be rebased many times.  Perhaps there was a small merge error along the way.  But that's not as if it was never tested...



---

archive/issue_comments_373832.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAlso, the ticket doesn't bump the package versions of the affected packages, so you would only see the issue if rebuilding from scratch.  The \"obviously\" is pretty unnecessary.",
    "created_at": "2018-07-30T16:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373832",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Also, the ticket doesn't bump the package versions of the affected packages, so you would only see the issue if rebuilding from scratch.  The "obviously" is pretty unnecessary.



---

archive/issue_comments_373833.json:
```json
{
    "body": "Changed commit from **[`4d20506`](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)** to **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**",
    "created_at": "2018-07-30T16:22:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373833",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4d20506`](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)** to **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**



---

archive/issue_comments_373834.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3\"><code>7643e66</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7\"><code>32f5bbe</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d\"><code>ff1ccd3</code></a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>\n",
    "created_at": "2018-07-30T16:22:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373834",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3"><code>7643e66</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7"><code>32f5bbe</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d"><code>ff1ccd3</code></a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>




---

archive/issue_events_338511.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-30T16:24:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338511"
}
```



---

archive/issue_events_338512.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-30T16:24:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338512"
}
```



---

archive/issue_comments_373835.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3\"><code>7643e66</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7\"><code>32f5bbe</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d\"><code>ff1ccd3</code></a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>\n",
    "created_at": "2018-07-30T16:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373835",
    "user": "https://github.com/embray"
}
```

<div id="comment:38"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3"><code>7643e66</code></a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7"><code>32f5bbe</code></a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d"><code>ff1ccd3</code></a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>




---

archive/issue_events_338513.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:43:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338513"
}
```



---

archive/issue_events_338514.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4e149dc54704a816a75ddcc6fe8826e8b16764cf",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-05T08:43:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24646#event-338514"
}
```



---

archive/issue_comments_373836.json:
```json
{
    "body": "Changed branch from **[u/embray/build/destdir-pip](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir-pip)** to **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**",
    "created_at": "2018-08-05T08:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24646#issuecomment-373836",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/build/destdir-pip](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir-pip)** to **[`ff1ccd3`](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)**
