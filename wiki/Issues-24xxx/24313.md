# Issue 24313: py3: fixes to sage.misc.temporary_file

archive/issues_024076.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis updates the `atomic_write` context manager to work in both \"text\" and \"binary\" modes on Python 3, and fixes a few of the module's tests so that they pass on Python 3.\n\nComponent: **python3**\n\nAuthor: **Erik Bray**\n\nBranch/Commit: **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24313_\n\n",
    "closed_at": "2018-02-09T08:03:59Z",
    "created_at": "2017-12-01T15:37:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: fixes to sage.misc.temporary_file",
    "type": "issue",
    "updated_at": "2018-02-09T08:03:59Z",
    "url": "https://github.com/sagemath/sage/issues/24313",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

This updates the `atomic_write` context manager to work in both "text" and "binary" modes on Python 3, and fixes a few of the module's tests so that they pass on Python 3.

Component: **python3**

Author: **Erik Bray**

Branch/Commit: **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**

Reviewer: **Frédéric Chapoton, Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24313_





---

archive/issue_events_334471.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T15:37:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334471"
}
```



---

archive/issue_events_334472.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T15:37:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334472"
}
```



---

archive/issue_events_334473.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T15:37:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334473"
}
```



---

archive/issue_events_334474.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T15:37:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334474"
}
```



---

archive/issue_events_334475.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T15:37:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334475"
}
```



---

archive/issue_comments_368029.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nCould you cook up doctests for\n- usage of `binary`\n- usage of `encoding`\n- checking that `binary=True` is ignored when an encoding is provided",
    "created_at": "2017-12-04T10:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368029",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2" align="right">comment:2</div>

Could you cook up doctests for
- usage of `binary`
- usage of `encoding`
- checking that `binary=True` is ignored when an encoding is provided



---

archive/issue_comments_368030.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nInstead of the `encoding` argument, I would rather allow arbitrary `**kwds`.",
    "created_at": "2017-12-04T10:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368030",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.



---

archive/issue_events_334476.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-04T10:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334476"
}
```



---

archive/issue_events_334477.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-04T10:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334477"
}
```



---

archive/issue_comments_368031.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@jdemeyer](#comment%3A3):\n> Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.\n\nCould you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter (it should, which I think is a defect, but it doesn't).  It also requires special handling depending on whether on Python 2 or 3 anyways.\n\n+1 to adding more tests though.",
    "created_at": "2017-12-04T13:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368031",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@jdemeyer](#comment%3A3):
> Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.

Could you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter (it should, which I think is a defect, but it doesn't).  It also requires special handling depending on whether on Python 2 or 3 anyways.

+1 to adding more tests though.



---

archive/issue_comments_368032.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@embray](#comment%3A4):\n> Replying to [@jdemeyer](#comment%3A3):\n> > Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.\n> \n> \n> Could you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter.\n\n1. There are several keywords which are accepted by both `open()` and `TemporaryFile()`. If you allow customizing `encoding`, I don't see why you shouldn't allow customize `newline` for example.\n\n2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.\n\n3. I find it conceptually simpler to simply pass `**kwds` unmodified instead of explicitly handling a specific `encoding` keyword.",
    "created_at": "2017-12-04T13:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368032",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@embray](#comment%3A4):
> Replying to [@jdemeyer](#comment%3A3):
> > Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.
> 
> 
> Could you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter.

1. There are several keywords which are accepted by both `open()` and `TemporaryFile()`. If you allow customizing `encoding`, I don't see why you shouldn't allow customize `newline` for example.

2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.

3. I find it conceptually simpler to simply pass `**kwds` unmodified instead of explicitly handling a specific `encoding` keyword.



---

archive/issue_comments_368033.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jdemeyer](#comment%3A5):\n> Replying to [@embray](#comment%3A4):\n> > Replying to [@jdemeyer](#comment%3A3):\n> > > Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.\n> > \n> > \n> > Could you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter.\n> \n> \n> 1. There are several keywords which are accepted by both `open()` and `TemporaryFile()`. If you allow customizing `encoding`, I don't see why you shouldn't allow customize `newline` for example.\n\nCan you suggest some need for anything besides universal newline handling in text mode?\n\n> 2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.\n\n*only* in text mode.  If you want to be able to support text and binary modes that needs to be done explicitly.  With normal `io.open` this would be done with a mode string, but that's not really applicable for `atomic_write`.\n\nI do agree there's no reason to supply the `locale.getpreferredencoding()`.  I thought that made the code and the intent clearer by explicitly stating what the default is rather than relying on the underlying implementation, but I could remove this if this is the only sticking point.\n\n> 3. I find it conceptually simpler to simply pass `**kwds` unmodified instead of explicitly handling a specific `encoding` keyword.\n\nIt really doesn't make sense in this case.  `open` and `TemporaryFile` take different arguments and their use is an implementation detail irrelevant to the API provided by `atomic_write` (which I'm trying to still trying to keep as restricted as possible to meet its narrow use case).",
    "created_at": "2017-12-04T14:19:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368033",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jdemeyer](#comment%3A5):
> Replying to [@embray](#comment%3A4):
> > Replying to [@jdemeyer](#comment%3A3):
> > > Instead of the `encoding` argument, I would rather allow arbitrary `**kwds`.
> > 
> > 
> > Could you clarify that?  I don't see how that's useful.  It should be noted that this function passes some arguments to both `TemporaryFile` and `open()`, and the former does *not* accept all the same arguments as the latter.
> 
> 
> 1. There are several keywords which are accepted by both `open()` and `TemporaryFile()`. If you allow customizing `encoding`, I don't see why you shouldn't allow customize `newline` for example.

Can you suggest some need for anything besides universal newline handling in text mode?

> 2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.

*only* in text mode.  If you want to be able to support text and binary modes that needs to be done explicitly.  With normal `io.open` this would be done with a mode string, but that's not really applicable for `atomic_write`.

I do agree there's no reason to supply the `locale.getpreferredencoding()`.  I thought that made the code and the intent clearer by explicitly stating what the default is rather than relying on the underlying implementation, but I could remove this if this is the only sticking point.

> 3. I find it conceptually simpler to simply pass `**kwds` unmodified instead of explicitly handling a specific `encoding` keyword.

It really doesn't make sense in this case.  `open` and `TemporaryFile` take different arguments and their use is an implementation detail irrelevant to the API provided by `atomic_write` (which I'm trying to still trying to keep as restricted as possible to meet its narrow use case).



---

archive/issue_comments_368034.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@embray](#comment%3A6):\n> Can you suggest some need for anything besides universal newline handling in text mode?\n\nThere is no need currently. But I think it is nice design to allow arbitrary arguments. It is narrow-minded to disallow something just because there is currently no use case.\n\n> > 2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.\n> \n> \n> *only* in text mode.\n\nOf course... what's your point? How would you use `encoding` in binary mode? I don't get what you are trying to say...\n\n> It really doesn't make sense in this case.  `open` and `TemporaryFile` take different arguments and their use is an implementation detail irrelevant to the API provided by `atomic_write`\n\nI don't really agree with that. If you are providing an API dealing with files, it makes sense to have an API which is close to what `open()` provides. And explicitly passing `**kwds` does exactly that. It makes it explicit that you're just providing a wrapper around `open()` and `TemporaryFile()`.",
    "created_at": "2017-12-04T15:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368034",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@embray](#comment%3A6):
> Can you suggest some need for anything besides universal newline handling in text mode?

There is no need currently. But I think it is nice design to allow arbitrary arguments. It is narrow-minded to disallow something just because there is currently no use case.

> > 2. Python already `encoding=locale.getpreferredencoding()` as default, there is no reason to reimplement handling that as default.
> 
> 
> *only* in text mode.

Of course... what's your point? How would you use `encoding` in binary mode? I don't get what you are trying to say...

> It really doesn't make sense in this case.  `open` and `TemporaryFile` take different arguments and their use is an implementation detail irrelevant to the API provided by `atomic_write`

I don't really agree with that. If you are providing an API dealing with files, it makes sense to have an API which is close to what `open()` provides. And explicitly passing `**kwds` does exactly that. It makes it explicit that you're just providing a wrapper around `open()` and `TemporaryFile()`.



---

archive/issue_comments_368035.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n>  If you are providing an API dealing with files, it makes sense to have an API which is close to what open() provides.\n\nNot necessarily.  `atomic_write` is not a generic file opening function.  It has only one purpose which is to write files in a narrow context.  Many of the arguments you might pass `open()` don't make sense.  If it did one might have written it that way in the first place, but you (I think?) didn't and for good reason.\n\nRight now this is only adding the bare minimum necessary to achieve the required goals--not exploding the API footprint.",
    "created_at": "2017-12-04T16:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368035",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

>  If you are providing an API dealing with files, it makes sense to have an API which is close to what open() provides.

Not necessarily.  `atomic_write` is not a generic file opening function.  It has only one purpose which is to write files in a narrow context.  Many of the arguments you might pass `open()` don't make sense.  If it did one might have written it that way in the first place, but you (I think?) didn't and for good reason.

Right now this is only adding the bare minimum necessary to achieve the required goals--not exploding the API footprint.



---

archive/issue_comments_368036.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAlso again, I'll note, that `TemporaryFile` does not accept all the arguments that `open` does in the first place (in particular it does not accept an argument for encoding error handling--which I would consider an upstream defect).",
    "created_at": "2017-12-04T16:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368036",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Also again, I'll note, that `TemporaryFile` does not accept all the arguments that `open` does in the first place (in particular it does not accept an argument for encoding error handling--which I would consider an upstream defect).



---

archive/issue_comments_368037.json:
```json
{
    "body": "Changed commit from **[`bccdf94`](https://github.com/sagemath/sagetrac-mirror/commit/bccdf943830707bf200e6ddd6a8a00da54205744)** to **[`589e7a2`](https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13)**",
    "created_at": "2018-01-17T09:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368037",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bccdf94`](https://github.com/sagemath/sagetrac-mirror/commit/bccdf943830707bf200e6ddd6a8a00da54205744)** to **[`589e7a2`](https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13)**



---

archive/issue_comments_368038.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13\"><code>589e7a2</code></a></td><td><code>Slight reworking of the arguments to atomic_write:</code></td></tr></table>\n",
    "created_at": "2018-01-17T09:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368038",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13"><code>589e7a2</code></a></td><td><code>Slight reworking of the arguments to atomic_write:</code></td></tr></table>




---

archive/issue_comments_368039.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPart of the problem here was the use of `tempfile.TemporaryFile`, which is incompatible with Jeroen's request (and in thinking about this I think the stdlib is buggy here--`TemporaryFile` should accept arbitrary kwargs to pass to `io.open`, in fact, it doesn't accept an *errors* argument which is just annoying).\n\nI reworked this a bit to just use `mkstemp` and `io.open` directly.  I think this should make Jeroen happy.",
    "created_at": "2018-01-17T09:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368039",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Part of the problem here was the use of `tempfile.TemporaryFile`, which is incompatible with Jeroen's request (and in thinking about this I think the stdlib is buggy here--`TemporaryFile` should accept arbitrary kwargs to pass to `io.open`, in fact, it doesn't accept an *errors* argument which is just annoying).

I reworked this a bit to just use `mkstemp` and `io.open` directly.  I think this should make Jeroen happy.



---

archive/issue_events_334478.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-17T09:41:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334478"
}
```



---

archive/issue_events_334479.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-17T09:41:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334479"
}
```



---

archive/issue_comments_368040.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad\"><code>9a4d548</code></a></td><td><code>Slight correction to this docstring.</code></td></tr></table>\n",
    "created_at": "2018-01-17T09:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368040",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad"><code>9a4d548</code></a></td><td><code>Slight correction to this docstring.</code></td></tr></table>




---

archive/issue_comments_368041.json:
```json
{
    "body": "Changed commit from **[`589e7a2`](https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13)** to **[`9a4d548`](https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad)**",
    "created_at": "2018-01-17T09:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368041",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`589e7a2`](https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13)** to **[`9a4d548`](https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad)**



---

archive/issue_comments_368042.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nLooks good to me. Jeroen, your opinion ?",
    "created_at": "2018-01-22T16:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368042",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

Looks good to me. Jeroen, your opinion ?



---

archive/issue_events_334480.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-22T20:42:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334480"
}
```



---

archive/issue_events_334481.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-22T20:42:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334481"
}
```



---

archive/issue_comments_368043.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment%3A11):\n> I reworked this a bit to just use `mkstemp` and `io.open` directly.  I think this should make Jeroen happy.\n\nThat's not actually what the patch does... I see `tmp_filename()` which is Sage-specific thing.\n\nAnd it's crucial that the temporary file is created in the same directory as the destination file, otherwise the move is not guaranteed to be atomic. In fact it would be good to add the doctests which shows that the file in indeed created in the right directory.",
    "created_at": "2018-01-22T20:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368043",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment%3A11):
> I reworked this a bit to just use `mkstemp` and `io.open` directly.  I think this should make Jeroen happy.

That's not actually what the patch does... I see `tmp_filename()` which is Sage-specific thing.

And it's crucial that the temporary file is created in the same directory as the destination file, otherwise the move is not guaranteed to be atomic. In fact it would be good to add the doctests which shows that the file in indeed created in the right directory.



---

archive/issue_comments_368044.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI see what you're saying--originally I did use `mkstemp` directly but then saw `tmp_filename` and thought to use that, neglecting the point about the directory.  I don't think I'll add a test for that though because as long as it's implemented correctly then that's tautological (but it would be helpful if that were documented).",
    "created_at": "2018-01-23T11:20:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368044",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

I see what you're saying--originally I did use `mkstemp` directly but then saw `tmp_filename` and thought to use that, neglecting the point about the directory.  I don't think I'll add a test for that though because as long as it's implemented correctly then that's tautological (but it would be helpful if that were documented).



---

archive/issue_comments_368045.json:
```json
{
    "body": "Changed commit from **[`9a4d548`](https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad)** to **[`c2bf3b9`](https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9)**",
    "created_at": "2018-01-23T11:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368045",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9a4d548`](https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad)** to **[`c2bf3b9`](https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9)**



---

archive/issue_comments_368046.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9\"><code>c2bf3b9</code></a></td><td><code>Actually use mkstemp directly instead of tmp_filename; create the tempfile in the same directory as the target file</code></td></tr></table>\n",
    "created_at": "2018-01-23T11:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368046",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9"><code>c2bf3b9</code></a></td><td><code>Actually use mkstemp directly instead of tmp_filename; create the tempfile in the same directory as the target file</code></td></tr></table>




---

archive/issue_events_334482.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-23T11:28:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334482"
}
```



---

archive/issue_events_334483.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-23T11:28:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334483"
}
```



---

archive/issue_comments_368047.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOK, I am essentially happy with this now. Just a few minor points:\n\n1. in the docs, use <code>\\`\\`**kwargs\\`\\`</code> instead of <code>\\`\\`kwargs\\`\\`</code>.\n\n2. add a test for `**kwargs`\n\n2. add a test for *invalid* `**kwargs`",
    "created_at": "2018-01-23T15:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368047",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

OK, I am essentially happy with this now. Just a few minor points:

1. in the docs, use <code>\`\`**kwargs\`\`</code> instead of <code>\`\`kwargs\`\`</code>.

2. add a test for `**kwargs`

2. add a test for *invalid* `**kwargs`



---

archive/issue_events_334484.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-24T13:09:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334484"
}
```



---

archive/issue_events_334485.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-24T13:09:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334485"
}
```



---

archive/issue_comments_368048.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSounds good--will do.",
    "created_at": "2018-01-26T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368048",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Sounds good--will do.



---

archive/issue_comments_368049.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242\"><code>5df54d4</code></a></td><td><code>Address some review comments:</code></td></tr></table>\n",
    "created_at": "2018-01-31T17:29:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368049",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242"><code>5df54d4</code></a></td><td><code>Address some review comments:</code></td></tr></table>




---

archive/issue_comments_368050.json:
```json
{
    "body": "Changed commit from **[`c2bf3b9`](https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9)** to **[`5df54d4`](https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242)**",
    "created_at": "2018-01-31T17:29:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368050",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c2bf3b9`](https://github.com/sagemath/sagetrac-mirror/commit/c2bf3b9585787fa1cbc40982d6fa4dfa9cfa32a9)** to **[`5df54d4`](https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242)**



---

archive/issue_events_334486.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-31T17:37:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334486"
}
```



---

archive/issue_events_334487.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-01-31T17:37:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334487"
}
```



---

archive/issue_comments_368051.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think this should do it.",
    "created_at": "2018-01-31T17:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368051",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

I think this should do it.



---

archive/issue_comments_368052.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nthe import of locale seems no longer needed",
    "created_at": "2018-02-04T19:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368052",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

the import of locale seems no longer needed



---

archive/issue_comments_368053.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-misc-tempfile)** to **[u/jdemeyer/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-misc-tempfile)**",
    "created_at": "2018-02-05T09:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368053",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-misc-tempfile)** to **[u/jdemeyer/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-misc-tempfile)**



---

archive/issue_comments_368054.json:
```json
{
    "body": "Changed commit from **[`5df54d4`](https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242)** to **[`d8170e6`](https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523)**",
    "created_at": "2018-02-05T09:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368054",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5df54d4`](https://github.com/sagemath/sagetrac-mirror/commit/5df54d44777b6855ed6c127c6eb7b65211bc9242)** to **[`d8170e6`](https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523)**



---

archive/issue_comments_368055.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523\"><code>d8170e6</code></a></td><td><code>Don't import locale</code></td></tr></table>\n",
    "created_at": "2018-02-05T09:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368055",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523"><code>d8170e6</code></a></td><td><code>Don't import locale</code></td></tr></table>




---

archive/issue_comments_368056.json:
```json
{
    "body": "Changed commit from **[`d8170e6`](https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523)** to **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**",
    "created_at": "2018-02-05T09:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368056",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d8170e6`](https://github.com/sagemath/sagetrac-mirror/commit/d8170e6038b71ff7e75060cfda5a2558bf1c6523)** to **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**



---

archive/issue_comments_368057.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4\"><code>d7d7614</code></a></td><td><code>Catch all exceptions from io.open()</code></td></tr></table>\n",
    "created_at": "2018-02-05T09:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368057",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4"><code>d7d7614</code></a></td><td><code>Catch all exceptions from io.open()</code></td></tr></table>




---

archive/issue_comments_368058.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI added 2 tiny fixes. If you agree, you (Erik or Fr\u00e9d\u00e9ric) can set it to positive_review.",
    "created_at": "2018-02-05T09:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368058",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

I added 2 tiny fixes. If you agree, you (Erik or Frédéric) can set it to positive_review.



---

archive/issue_comments_368059.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer**",
    "created_at": "2018-02-05T09:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368059",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Frédéric Chapoton, Jeroen Demeyer**



---

archive/issue_events_334488.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-05T13:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334488"
}
```



---

archive/issue_events_334489.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-05T13:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334489"
}
```



---

archive/issue_comments_368060.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-misc-tempfile)** to **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**",
    "created_at": "2018-02-09T08:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24313#issuecomment-368060",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/python3/sage-misc-tempfile](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-misc-tempfile)** to **[`d7d7614`](https://github.com/sagemath/sagetrac-mirror/commit/d7d7614c73854be5bf155f789485d4fae90edff4)**



---

archive/issue_events_334490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-09T08:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334490"
}
```



---

archive/issue_events_334491.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "38e8a65eec4c6cb182db49a4cd37da7ade52350e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-02-09T08:03:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24313",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24313#event-334491"
}
```
