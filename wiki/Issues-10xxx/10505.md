# Issue 10505: Round values returned by CPLEX when the variable's type is integer/binary

archive/issues_010452.json:
```json
{
    "body": "CPLEX is a funny guy who does not understand that 1.546846847 e-17 is not a proper value for a binary variable. As I often forgot to replace test ``== 1`` by ``> .5`` and as it is anyway what CPLEX should return, this patch rounds values given to the variables before returning them when it is sound. It amounts to copying two lines from ``is_variable_continuous`` in the ``get_variable_value`` method, and doctests pass better with CPLEX (which is not the case with the new patch for TSP #10497)\n\nNathann\n\n**Assignee:** @nathanncohen\n\n**Author:** Nathann Cohen\n\n**Reviewer:** David Coudert\n\n**Merged:** sage-4.8.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/10505\n\n",
    "closed_at": "2011-10-18T20:14:42Z",
    "created_at": "2010-12-20T16:13:04Z",
    "labels": [
        "component: linear programming",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "title": "Round values returned by CPLEX when the variable's type is integer/binary",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/10505",
    "user": "https://github.com/nathanncohen"
}
```
CPLEX is a funny guy who does not understand that 1.546846847 e-17 is not a proper value for a binary variable. As I often forgot to replace test ``== 1`` by ``> .5`` and as it is anyway what CPLEX should return, this patch rounds values given to the variables before returning them when it is sound. It amounts to copying two lines from ``is_variable_continuous`` in the ``get_variable_value`` method, and doctests pass better with CPLEX (which is not the case with the new patch for TSP #10497)

Nathann

**Assignee:** @nathanncohen

**Author:** Nathann Cohen

**Reviewer:** David Coudert

**Merged:** sage-4.8.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/10505





---

archive/issue_events_080732.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-12-20T16:14:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80732"
}
```



---

archive/issue_events_080733.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T09:08:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80733"
}
```



---

archive/issue_events_080734.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T09:08:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80734"
}
```



---

archive/issue_comments_100881.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe returned value is not of integer type (2.0 instead of 2). Should we cast it to Integer, or int, or leave it like that ?",
    "created_at": "2011-10-14T09:08:23Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100881",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>
The returned value is not of integer type (2.0 instead of 2). Should we cast it to Integer, or int, or leave it like that ?



---

archive/issue_comments_100882.json:
```json
{
    "body": "**Reviewer:** David Coudert",
    "created_at": "2011-10-14T09:08:23Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100882",
    "user": "https://github.com/dcoudert"
}
```

**Reviewer:** David Coudert



---

archive/issue_events_080735.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-10-14T09:25:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80735"
}
```



---

archive/issue_events_080736.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-10-14T09:25:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80736"
}
```



---

archive/issue_comments_100883.json:
```json
{
    "body": "<a id='comment:3'></a>\nOops... You are right !\n\nThe thing is that casting it to Integer would mean having to create a new object for each returned variable, even when using the code from the C level. And casting it to a Python int would mean that you can not divide is safely anymore (1/2 becomes 0).\n\nWhat do you think of letting it stay like that ? The goal was really to be able to test (variable == 0) without fearing that variable (declared as binary in the LP) would have 0.0000001 as a value.\n\nWe can still *really* cast the values to integer in situations where the user expect it, like in #11367 which just got reviewed.\n\nWhile I was at it, though, I noticed a mistake in the documentation generated from the mip.pyx file : the first line contained a math equation which was not properly written.. I just updated the patch to fix it ! `:-)`\n\nNathann",
    "created_at": "2011-10-14T09:25:49Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100883",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
Oops... You are right !

The thing is that casting it to Integer would mean having to create a new object for each returned variable, even when using the code from the C level. And casting it to a Python int would mean that you can not divide is safely anymore (1/2 becomes 0).

What do you think of letting it stay like that ? The goal was really to be able to test (variable == 0) without fearing that variable (declared as binary in the LP) would have 0.0000001 as a value.

We can still *really* cast the values to integer in situations where the user expect it, like in #11367 which just got reviewed.

While I was at it, though, I noticed a mistake in the documentation generated from the mip.pyx file : the first line contained a math equation which was not properly written.. I just updated the patch to fix it ! `:-)`

Nathann



---

archive/issue_comments_100884.json:
```json
{
    "body": "<a id='comment:4'></a>\nOK, you can live it like this, but it should be clearly indicated in the documentation to avoid confusion. Users can cast afterwards depending of their needs.\n\nConcerning the documentation, I don't see any improvement. In fact, most of the math equations are not properly displayed in the page. I see only the latex code (e.g., w_i \\in \\mathbb{Z}).",
    "created_at": "2011-10-14T09:43:17Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100884",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>
OK, you can live it like this, but it should be clearly indicated in the documentation to avoid confusion. Users can cast afterwards depending of their needs.

Concerning the documentation, I don't see any improvement. In fact, most of the math equations are not properly displayed in the page. I see only the latex code (e.g., w_i \in \mathbb{Z}).



---

archive/issue_events_080737.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T09:43:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80737"
}
```



---

archive/issue_events_080738.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T09:43:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80738"
}
```



---

archive/issue_comments_100885.json:
```json
{
    "body": "<a id='comment:5'></a>\n> OK, you can live it like this, but it should be clearly indicated in the documentation to avoid confusion. Users can cast afterwards depending of their needs.\n\nPatch updated. I added a note in the documentation of ``MixedIntegerLinearProgram.get_values``.\n\n> Concerning the documentation, I don't see any improvement. In fact, most of the math equations are not properly displayed in the page. I see only the latex code (e.g., w_i \\in \\mathbb{Z}). \n\nAre you talking of the HTML documentation ? The LaTeX formula will of course never appear in the console ! In my version of it, I find nothing wrong with the others formulas contained in this page. `O_o`\n\nNathann",
    "created_at": "2011-10-14T10:17:58Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100885",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>
> OK, you can live it like this, but it should be clearly indicated in the documentation to avoid confusion. Users can cast afterwards depending of their needs.

Patch updated. I added a note in the documentation of ``MixedIntegerLinearProgram.get_values``.

> Concerning the documentation, I don't see any improvement. In fact, most of the math equations are not properly displayed in the page. I see only the latex code (e.g., w_i \in \mathbb{Z}). 

Are you talking of the HTML documentation ? The LaTeX formula will of course never appear in the console ! In my version of it, I find nothing wrong with the others formulas contained in this page. `O_o`

Nathann



---

archive/issue_events_080739.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-10-14T10:17:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80739"
}
```



---

archive/issue_events_080740.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-10-14T10:17:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80740"
}
```



---

archive/attachments_014202.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10505.patch",
    "asset_url": "tarball://root/attachments/ticket10505/trac_10505.patch",
    "created_at": "2011-10-14T11:43:35Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10505/trac_10505.patch",
    "user": "https://github.com/dcoudert"
}
```



---

archive/issue_comments_100886.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Attachment:** [trac_10505.patch](https://github.com/sagemath/sage/files/ticket10505/trac_10505.patch)\n\nI'm now satisfied with this patch.",
    "created_at": "2011-10-14T11:43:35Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100886",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
**Attachment:** [trac_10505.patch](https://github.com/sagemath/sage/files/ticket10505/trac_10505.patch)

I'm now satisfied with this patch.



---

archive/issue_events_080741.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T11:43:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80741"
}
```



---

archive/issue_events_080742.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2011-10-14T11:43:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80742"
}
```



---

archive/issue_events_080743.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-16T15:39:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80743"
}
```



---

archive/issue_events_080744.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-16T15:39:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80744"
}
```



---

archive/issue_events_080745.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-18T20:14:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80745"
}
```



---

archive/issue_events_080746.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-18T20:14:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80746"
}
```



---

archive/issue_comments_100887.json:
```json
{
    "body": "**Merged:** sage-4.7.3.alpha0",
    "created_at": "2011-10-18T20:14:42Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100887",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.3.alpha0



---

archive/issue_comments_100888.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100888",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_080747.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80747"
}
```



---

archive/issue_comments_100889.json:
```json
{
    "body": "**Changing merged** from \"sage-4.7.3.alpha0\" to \"sage-4.8.alpha0\".",
    "created_at": "2011-11-03T16:16:28Z",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10505#issuecomment-100889",
    "user": "https://github.com/jdemeyer"
}
```

**Changing merged** from "sage-4.7.3.alpha0" to "sage-4.8.alpha0".



---

archive/issue_events_080748.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:16:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10505",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10505#event-80748"
}
```
