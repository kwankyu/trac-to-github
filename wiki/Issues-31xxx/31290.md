# Issue 31290: Improve error message for ecl

archive/issues_031053.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nIn case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.\n\n\n\nCC:  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe\n\nComponent: **build**\n\nAuthor: **Tobias Diez**\n\nBranch/Commit: **[public/build/ecl_error](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ecl_error) @ [`764325f`](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31290_\n\n",
    "created_at": "2021-01-25T11:44:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve error message for ecl",
    "type": "issue",
    "updated_at": "2023-01-29T23:06:23Z",
    "url": "https://github.com/sagemath/sage/issues/31290",
    "user": "https://github.com/tobiasdiez"
}
```
<div id="comment:0"></div>

In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.



CC:  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe

Component: **build**

Author: **Tobias Diez**

Branch/Commit: **[public/build/ecl_error](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ecl_error) @ [`764325f`](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)**

_Issue created by migration from https://trac.sagemath.org/ticket/31290_





---

archive/issue_events_428798.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428798"
}
```



---

archive/issue_events_428799.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428799"
}
```



---

archive/issue_events_428800.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428800"
}
```



---

archive/issue_events_428801.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428801"
}
```



---

archive/issue_events_428802.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428802"
}
```



---

archive/issue_comments_501606.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nPlease add doctests that illustrate this",
    "created_at": "2021-01-25T19:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501606",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Please add doctests that illustrate this



---

archive/issue_comments_501607.json:
```json
{
    "body": "Changed commit from **[`4334f8e`](https://github.com/sagemath/sagetrac-mirror/commit/4334f8e91bb2c526cd887d19f4239420735fa538)** to **[`764325f`](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)**",
    "created_at": "2021-01-28T16:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501607",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4334f8e`](https://github.com/sagemath/sagetrac-mirror/commit/4334f8e91bb2c526cd887d19f4239420735fa538)** to **[`764325f`](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)**



---

archive/issue_comments_501608.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb\"><code>764325f</code></a></td><td><code>Add test</code></td></tr></table>\n",
    "created_at": "2021-01-28T16:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501608",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb"><code>764325f</code></a></td><td><code>Add test</code></td></tr></table>




---

archive/issue_comments_501609.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDone",
    "created_at": "2021-01-28T16:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501609",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:4" align="right">comment:4</div>

Done



---

archive/issue_comments_501610.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThere seems to be another codepath that is not covered by doctests yet",
    "created_at": "2021-01-30T01:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501610",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

There seems to be another codepath that is not covered by doctests yet



---

archive/issue_comments_501611.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhich code do you mean?",
    "created_at": "2021-01-30T10:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501611",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:6" align="right">comment:6</div>

Which code do you mean?



---

archive/issue_comments_501612.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n3 `raise` statements are changed, 1 is tested",
    "created_at": "2021-01-30T17:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501612",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

3 `raise` statements are changed, 1 is tested



---

archive/issue_comments_501613.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.\n\nIn any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.",
    "created_at": "2021-01-30T19:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501613",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

This is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.

In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.



---

archive/issue_events_428803.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2021-01-30T19:59:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428803"
}
```



---

archive/issue_events_428804.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2021-01-30T19:59:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428804"
}
```



---

archive/issue_comments_501614.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for the feedback!\n\nReplying to [@nbruin](#comment%3A8):\n> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.\n> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. \n\nI agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.\nAs I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.\n\nWould it be ok for now, if I print the initial (python) string passed as the constructor argument?",
    "created_at": "2021-01-30T21:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501614",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for the feedback!

Replying to [@nbruin](#comment%3A8):
> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.
> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. 

I agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.
As I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.

Would it be ok for now, if I print the initial (python) string passed as the constructor argument?



---

archive/issue_comments_501615.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501615",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_428805.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428805"
}
```



---

archive/issue_events_428806.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428806"
}
```



---

archive/issue_comments_501616.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n@nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!",
    "created_at": "2021-05-18T07:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501616",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:11" align="right">comment:11</div>

@nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!



---

archive/issue_events_428807.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428807"
}
```



---

archive/issue_events_428808.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428808"
}
```



---

archive/issue_comments_501617.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-501617",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_428809.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428809"
}
```



---

archive/issue_events_428810.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428810"
}
```



---

archive/issue_events_428811.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428811"
}
```



---

archive/issue_events_428812.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428812"
}
```



---

archive/issue_events_428813.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428813"
}
```



---

archive/issue_events_428814.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428814"
}
```



---

archive/issue_events_428815.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-29T23:06:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-428815"
}
```
