# Issue 31053: MR49: Register sorted dict pprinter earlier in doctest forker

archive/issues_030816.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nMauricio Collares ([@collares](https://gitlab.com/collares)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/49:\n\n---\n\n```markdown\nCurrently, the pprinter gets registered after controller.load_environment(). This is fine if a lazy import cache exists in ~/.sage/cache, because in this case sandpile.py doesn't get immediately executed. However, if there's no such cache, then the line\n\n```\npretty.for_type(SandpileConfig, pretty.for_type(dict, None))\n```\n\nin sandpiles.py gets to run before the new dict pretty printer gets registered, causing the unsorted pretty printer to be registered for SandpileConfig (and similarly for SandpileDivisor). This leads to test failures in the absence of the lazy import cache.\n```\n\n\nComponent: **doctest framework**\n\nAuthor: **Mauricio Collares**\n\nBranch/Commit: **[`d658230`](https://github.com/sagemath/sagetrac-mirror/commit/d658230ce06ca19f4a3b3a4576297ee82f2d2151)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31053_\n\n",
    "closed_at": "2021-01-03T12:15:33Z",
    "created_at": "2020-12-15T16:28:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "MR49: Register sorted dict pprinter earlier in doctest forker",
    "type": "issue",
    "updated_at": "2021-01-03T12:15:33Z",
    "url": "https://github.com/sagemath/sage/issues/31053",
    "user": "https://github.com/sagetrac-gitlab-bot"
}
```
<div id="comment:0"></div>

Mauricio Collares ([@collares](https://gitlab.com/collares)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/49:

---

```markdown
Currently, the pprinter gets registered after controller.load_environment(). This is fine if a lazy import cache exists in ~/.sage/cache, because in this case sandpile.py doesn't get immediately executed. However, if there's no such cache, then the line

```
pretty.for_type(SandpileConfig, pretty.for_type(dict, None))
```

in sandpiles.py gets to run before the new dict pretty printer gets registered, causing the unsorted pretty printer to be registered for SandpileConfig (and similarly for SandpileDivisor). This leads to test failures in the absence of the lazy import cache.
```


Component: **doctest framework**

Author: **Mauricio Collares**

Branch/Commit: **[`d658230`](https://github.com/sagemath/sagetrac-mirror/commit/d658230ce06ca19f4a3b3a4576297ee82f2d2151)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/31053_





---

archive/issue_events_425756.json:
```json
{
    "actor": "https://github.com/sagetrac-gitlab-bot",
    "created_at": "2020-12-15T16:28:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425756"
}
```



---

archive/issue_events_425757.json:
```json
{
    "actor": "https://github.com/sagetrac-gitlab-bot",
    "created_at": "2020-12-15T16:28:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425757"
}
```



---

archive/issue_events_425758.json:
```json
{
    "actor": "https://github.com/sagetrac-gitlab-bot",
    "created_at": "2020-12-15T16:28:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425758"
}
```



---

archive/issue_events_425759.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-01-02T10:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425759"
}
```



---

archive/issue_events_425760.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-01-02T10:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425760"
}
```



---

archive/issue_comments_497701.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2021-01-02T10:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31053#issuecomment-497701",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff

``````




---

archive/issue_comments_497702.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nGood catch. LGTM",
    "created_at": "2021-01-02T10:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31053#issuecomment-497702",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

Good catch. LGTM



---

archive/issue_comments_497703.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-01-02T10:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31053#issuecomment-497703",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_425761.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-01-02T10:17:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425761"
}
```



---

archive/issue_events_425762.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-01-02T10:17:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425762"
}
```



---

archive/issue_comments_497704.json:
```json
{
    "body": "Changed branch from **[u/galois/mrs/49/register-pprinter-earlier](https://github.com/sagemath/sagetrac-mirror/tree/u/galois/mrs/49/register-pprinter-earlier)** to **[`d658230`](https://github.com/sagemath/sagetrac-mirror/commit/d658230ce06ca19f4a3b3a4576297ee82f2d2151)**",
    "created_at": "2021-01-03T12:15:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31053#issuecomment-497704",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/galois/mrs/49/register-pprinter-earlier](https://github.com/sagemath/sagetrac-mirror/tree/u/galois/mrs/49/register-pprinter-earlier)** to **[`d658230`](https://github.com/sagemath/sagetrac-mirror/commit/d658230ce06ca19f4a3b3a4576297ee82f2d2151)**



---

archive/issue_events_425763.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425763"
}
```



---

archive/issue_events_425764.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1293960eb80cb5ffd2c78b32ab237a8868a5a781",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-03T12:15:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31053",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31053#event-425764"
}
```
