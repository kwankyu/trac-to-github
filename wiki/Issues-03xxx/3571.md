# Issue 3571: ivalue field in integer_mod.pyx shouldn't be public

archive/issues_003571.json:
```json
{
    "body": "The `ivalue` field for `IntegerMod_int` is `public`, but it shouldn't be. The following is very frightening, for instance:\n\n```\nsage: R = Integers(10)\nsage: x = R(2)\nsage: x\n2\nsage: x.ivalue = 33\nsage: x\n33\nsage: R(2)\n33\n```\n\nIt's easy to make this field no longer be public, but lots of things are using the fact that it is, so one needs to go through and make everything work correctly again.\n\n**Assignee:** @craigcitro\n\nIssue created by migration from https://trac.sagemath.org/ticket/3571\n\n",
    "closed_at": "2009-01-23T09:39:41Z",
    "created_at": "2008-07-06T20:55:32Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.3",
    "title": "ivalue field in integer_mod.pyx shouldn't be public",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/3571",
    "user": "https://github.com/craigcitro"
}
```
The `ivalue` field for `IntegerMod_int` is `public`, but it shouldn't be. The following is very frightening, for instance:

```
sage: R = Integers(10)
sage: x = R(2)
sage: x
2
sage: x.ivalue = 33
sage: x
33
sage: R(2)
33
```

It's easy to make this field no longer be public, but lots of things are using the fact that it is, so one needs to go through and make everything work correctly again.

**Assignee:** @craigcitro

Issue created by migration from https://trac.sagemath.org/ticket/3571





---

archive/issue_events_019842.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2009-01-23T08:01:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19842"
}
```



---

archive/issue_comments_020321.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe attached patch fixes this issue, and in fact, gives about a 1.5-2X speedup on multiplying `IntegerMod_int`s. The interesting part is that previous to this patch, the `ivalue` field was occasionally being accessed as a Python attribute instead of a Cython attribute! That's why it broke if we made the field not `public` in the first place. Oops.\n\nBEFORE:\n\n```\nsage: R = Integers(100) ; x = R(3) ; y = R(5)\nsage: timeit('x*y')\n625 loops, best of 3: 403 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 370 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 410 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 405 ns per loop\n```\n\nAFTER:\n\n```\nsage: R = Integers(100) ; x = R(3) ; y = R(5)\nsage: timeit('x*y')\n625 loops, best of 3: 190 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 213 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 174 ns per loop\nsage: timeit('x*y')\n625 loops, best of 3: 191 ns per loop\n```",
    "created_at": "2009-01-23T08:01:48Z",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3571#issuecomment-20321",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:1'></a>
The attached patch fixes this issue, and in fact, gives about a 1.5-2X speedup on multiplying `IntegerMod_int`s. The interesting part is that previous to this patch, the `ivalue` field was occasionally being accessed as a Python attribute instead of a Cython attribute! That's why it broke if we made the field not `public` in the first place. Oops.

BEFORE:

```
sage: R = Integers(100) ; x = R(3) ; y = R(5)
sage: timeit('x*y')
625 loops, best of 3: 403 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 370 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 410 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 405 ns per loop
```

AFTER:

```
sage: R = Integers(100) ; x = R(3) ; y = R(5)
sage: timeit('x*y')
625 loops, best of 3: 190 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 213 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 174 ns per loop
sage: timeit('x*y')
625 loops, best of 3: 191 ns per loop
```



---

archive/issue_events_019843.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-23T08:09:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19843"
}
```



---

archive/issue_events_019844.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-23T08:09:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19844"
}
```



---

archive/attachments_003721.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-3571.patch",
    "asset_url": "tarball://root/attachments/ticket3571/trac-3571.patch",
    "created_at": "2009-01-23T08:09:47Z",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3571/trac-3571.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_020322.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Attachment:** [trac-3571.patch](https://github.com/sagemath/sage/files/ticket3571/trac-3571.patch)",
    "created_at": "2009-01-23T08:09:47Z",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3571#issuecomment-20322",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>
**Attachment:** [trac-3571.patch](https://github.com/sagemath/sage/files/ticket3571/trac-3571.patch)



---

archive/issue_events_019845.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-23T09:39:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19845"
}
```



---

archive/issue_events_019846.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-23T09:39:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19846"
}
```



---

archive/issue_events_019847.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-23T09:39:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19847"
}
```



---

archive/issue_events_019848.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-23T09:39:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3571#event-19848"
}
```



---

archive/issue_comments_020323.json:
```json
{
    "body": "<a id='comment:3'></a>\nMerged in Sage 3.3.alpha1\n\nCheers,\n\nMichael",
    "created_at": "2009-01-23T09:39:41Z",
    "issue": "https://github.com/sagemath/sage/issues/3571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3571#issuecomment-20323",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>
Merged in Sage 3.3.alpha1

Cheers,

Michael
