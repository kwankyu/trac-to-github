# Issue 15271: pretty_print_default fails in a terminal session

archive/issues_015034.json:
```json
{
    "body": "Calling pretty_print_default in a terminal fails:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 5.12, Release Date: 2013-10-07                        \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: pretty_print_default(True)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-b70acc55a8d2> in <module>()\n----> 1 pretty_print_default(True)\n\n/Users/ivanandres/SageStuff/sage-5.12/local/lib/python2.7/site-packages/sage/misc/latex.pyc in pretty_print_default(enable)\n   2463     \"\"\"\n   2464     import sys\n-> 2465     sys.displayhook.set_display('typeset' if enable else 'simple')\n   2466\n   2467\n\nAttributeError: 'DisplayHook' object has no attribute 'set_display'\nsage:\n```\n\nPerhaps calling pretty_print_default doesn't make much sense in the terminal, but it's used in the emacs interface to be able to display typeset output.\n\nI think doctests pass because the doctesting framework sets sys.displayhook to something else, namely `sage.misc.displayhook.DisplayHook(sys.displayhook)`.  I think the regression was introduced in #15168, and so I have cc'ed the people involved there in case they want to weigh in on how this should be fixed.\n\n**CC:**  @vbraun @ppurka @novoselt\n\nIssue created by migration from https://trac.sagemath.org/ticket/15271\n\n",
    "closed_at": "2015-04-14T08:56:58Z",
    "created_at": "2013-10-12T04:48:42Z",
    "labels": [
        "component: user interface",
        "bug",
        "wontfix"
    ],
    "title": "pretty_print_default fails in a terminal session",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/15271",
    "user": "https://github.com/gvol"
}
```
Calling pretty_print_default in a terminal fails:

```
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 5.12, Release Date: 2013-10-07                        │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: pretty_print_default(True)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-b70acc55a8d2> in <module>()
----> 1 pretty_print_default(True)

/Users/ivanandres/SageStuff/sage-5.12/local/lib/python2.7/site-packages/sage/misc/latex.pyc in pretty_print_default(enable)
   2463     """
   2464     import sys
-> 2465     sys.displayhook.set_display('typeset' if enable else 'simple')
   2466
   2467

AttributeError: 'DisplayHook' object has no attribute 'set_display'
sage:
```

Perhaps calling pretty_print_default doesn't make much sense in the terminal, but it's used in the emacs interface to be able to display typeset output.

I think doctests pass because the doctesting framework sets sys.displayhook to something else, namely `sage.misc.displayhook.DisplayHook(sys.displayhook)`.  I think the regression was introduced in #15168, and so I have cc'ed the people involved there in case they want to weigh in on how this should be fixed.

**CC:**  @vbraun @ppurka @novoselt

Issue created by migration from https://trac.sagemath.org/ticket/15271





---

archive/issue_comments_190913.json:
```json
{
    "body": "<a id='comment:1'></a>\nAs commented in the function, this should probably be removed from the global namespace. It is really not useful in the terminal.",
    "created_at": "2013-10-12T06:53:20Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190913",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:1'></a>
As commented in the function, this should probably be removed from the global namespace. It is really not useful in the terminal.



---

archive/issue_comments_190914.json:
```json
{
    "body": "<a id='comment:2'></a>\nCorrect, the terminal uses IPython's machinery instead of `sys.displayhook`. The doctests and the notebook run commands in non-ipython sessions, so our displayhook is used. IMHO the best way to switch IPython's behavior is with the `%display` magic, that is,\n\n```\nsage: %display typeset\nsage: 1+1\n<html><script type=\"math/tex\">\\newcommand{\\Bold}[1]{\\mathbf{#1}}2</script></html>\n```\nI see that we don't actually doctest that, this ought to be added to `sage/misc/sage_extension.py`",
    "created_at": "2013-10-12T11:19:56Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190914",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
Correct, the terminal uses IPython's machinery instead of `sys.displayhook`. The doctests and the notebook run commands in non-ipython sessions, so our displayhook is used. IMHO the best way to switch IPython's behavior is with the `%display` magic, that is,

```
sage: %display typeset
sage: 1+1
<html><script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}2</script></html>
```
I see that we don't actually doctest that, this ought to be added to `sage/misc/sage_extension.py`



---

archive/issue_comments_190915.json:
```json
{
    "body": "<a id='comment:3'></a>\nIf we want to fix this function, can this be made to call whatever the magic `%display typeset` runs?\n\nMaybe run the current code inside a `try: except:` construct?",
    "created_at": "2013-10-12T11:37:00Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190915",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:3'></a>
If we want to fix this function, can this be made to call whatever the magic `%display typeset` runs?

Maybe run the current code inside a `try: except:` construct?



---

archive/issue_comments_190916.json:
```json
{
    "body": "<a id='comment:4'></a>\nWe can, but imho we should just remove `pretty_print_default`.",
    "created_at": "2013-10-12T11:38:28Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190916",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
We can, but imho we should just remove `pretty_print_default`.



---

archive/issue_comments_190917.json:
```json
{
    "body": "<a id='comment:5'></a>\nLet's use this ticket for removing the function from the global namespace.",
    "created_at": "2013-10-12T11:39:25Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190917",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:5'></a>
Let's use this ticket for removing the function from the global namespace.



---

archive/issue_comments_190918.json:
```json
{
    "body": "<a id='comment:6'></a>\n@gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?",
    "created_at": "2013-10-12T11:42:16Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190918",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:6'></a>
@gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?



---

archive/issue_comments_190919.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@ppurka](#comment%3A6):\n> @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?\n\nYes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?",
    "created_at": "2013-10-12T14:07:17Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190919",
    "user": "https://github.com/gvol"
}
```

<a id='comment:7'></a>
Replying to [@ppurka](#comment%3A6):
> @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?

Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?



---

archive/issue_comments_190920.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@gvol](#comment%3A7):\n> Replying to [@ppurka](#comment%3A6):\n> > @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?\n\n> \n> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  \n\nNo. That exists from earlier, probably sage-5.11 (#12719).",
    "created_at": "2013-10-12T14:16:49Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190920",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:8'></a>
Replying to [@gvol](#comment%3A7):
> Replying to [@ppurka](#comment%3A6):
> > @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?

> 
> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  

No. That exists from earlier, probably sage-5.11 (#12719).



---

archive/issue_comments_190921.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@gvol](#comment%3A7):\n> Replying to [@ppurka](#comment%3A6):\n> > @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?\n\n> \n> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  \n\nI spoke too soon.  Using `sage.misc.displayhook.DisplayHook` makes plots not appear (in DOCTEST_MODE so they can be viewed inline as well).  I haven't had a change to debug into it yet.",
    "created_at": "2013-10-13T15:59:55Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190921",
    "user": "https://github.com/gvol"
}
```

<a id='comment:9'></a>
Replying to [@gvol](#comment%3A7):
> Replying to [@ppurka](#comment%3A6):
> > @gvol - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?

> 
> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  

I spoke too soon.  Using `sage.misc.displayhook.DisplayHook` makes plots not appear (in DOCTEST_MODE so they can be viewed inline as well).  I haven't had a change to debug into it yet.



---

archive/issue_comments_190922.json:
```json
{
    "body": "<a id='comment:10'></a>\nNo graphics is shown in `DOCTEST_MODE`, this is the expected behavior.\n\nWhats wrong with `%display typeset`?",
    "created_at": "2013-10-13T16:19:23Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190922",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
No graphics is shown in `DOCTEST_MODE`, this is the expected behavior.

Whats wrong with `%display typeset`?



---

archive/issue_events_135233.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135233"
}
```



---

archive/issue_events_135234.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135234"
}
```



---

archive/issue_events_135235.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135235"
}
```



---

archive/issue_events_135236.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135236"
}
```



---

archive/issue_comments_190923.json:
```json
{
    "body": "<a id='comment:13'></a>\nSage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.",
    "created_at": "2014-06-10T06:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190923",
    "user": "https://github.com/gvol"
}
```

<a id='comment:13'></a>
Sage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.



---

archive/issue_events_135237.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135237"
}
```



---

archive/issue_events_135238.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135238"
}
```



---

archive/issue_comments_190924.json:
```json
{
    "body": "<a id='comment:15'></a>\n> Sage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.\n\nAt least from the command line.  Possibly also `pretty_print`?  \n\nHowever, this is needed in [all_notebook.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/all_notebook.py), so don't just remove it completely!",
    "created_at": "2014-12-16T02:31:14Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190924",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
> Sage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.

At least from the command line.  Possibly also `pretty_print`?  

However, this is needed in [all_notebook.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/all_notebook.py), so don't just remove it completely!



---

archive/issue_events_135239.json:
```json
{
    "actor": "https://github.com/gvol",
    "created_at": "2015-04-14T04:53:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135239"
}
```



---

archive/issue_events_135240.json:
```json
{
    "actor": "https://github.com/gvol",
    "created_at": "2015-04-14T04:53:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135240"
}
```



---

archive/issue_comments_190925.json:
```json
{
    "body": "<a id='comment:16'></a>\npretty_print_default seems to no longer be in the global namespace in a terminal session, so I move we close this as won't fix.",
    "created_at": "2015-04-14T04:53:08Z",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15271#issuecomment-190925",
    "user": "https://github.com/gvol"
}
```

<a id='comment:16'></a>
pretty_print_default seems to no longer be in the global namespace in a terminal session, so I move we close this as won't fix.



---

archive/issue_events_135241.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T08:56:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135241"
}
```



---

archive/issue_events_135242.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T08:56:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135242"
}
```



---

archive/issue_events_135243.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T08:56:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135243"
}
```



---

archive/issue_events_135244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T08:56:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135244"
}
```



---

archive/issue_events_135245.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T08:56:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15271",
    "label": "wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15271#event-135245"
}
```
