# Issue 29320: downgrade various sagenb deps to optional

archive/issues_029083.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis includes `twisted` and `flask*` packages.\n\nCC:  @slel @kiwifb\n\nComponent: **packages: standard**\n\nKeywords: **sagenb, dependencies, optional**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**\n\nBranch: **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29320_\n\n",
    "closed_at": "2020-03-18T22:40:42Z",
    "created_at": "2020-03-12T18:22:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "downgrade various sagenb deps to optional",
    "type": "issue",
    "updated_at": "2020-05-28T17:20:48Z",
    "url": "https://github.com/sagemath/sage/issues/29320",
    "user": "https://github.com/dimpase"
}
```
<div id="comment:0"></div>

This includes `twisted` and `flask*` packages.

CC:  @slel @kiwifb

Component: **packages: standard**

Keywords: **sagenb, dependencies, optional**

Author: **Frédéric Chapoton, John Palmieri**

Branch: **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/29320_





---

archive/issue_events_400572.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T18:22:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400572"
}
```



---

archive/issue_events_400573.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T18:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400573"
}
```



---

archive/issue_events_400574.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T18:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400574"
}
```



---

archive/issue_events_400575.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T18:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400575"
}
```



---

archive/issue_events_400576.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-03-12T21:41:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400576"
}
```



---

archive/issue_comments_459997.json:
```json
{
    "body": "Commit: **[`89d2a99`](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)**",
    "created_at": "2020-03-12T21:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-459997",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`89d2a99`](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)**



---

archive/issue_comments_459998.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nhere is a branch (not tested)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3\"><code>89d2a99</code></a></td><td><code>change twisted and flask_* to optional packages</code></td></tr></table>\n",
    "created_at": "2020-03-12T21:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-459998",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

here is a branch (not tested)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3"><code>89d2a99</code></a></td><td><code>change twisted and flask_* to optional packages</code></td></tr></table>




---

archive/issue_comments_459999.json:
```json
{
    "body": "Branch: **[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)**",
    "created_at": "2020-03-12T21:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-459999",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)**



---

archive/issue_comments_460000.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to none",
    "created_at": "2020-03-12T21:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460000",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Dima Pasechnik** to none



---

archive/issue_events_400577.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T21:49:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400577"
}
```



---

archive/issue_events_400578.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T21:49:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400578"
}
```



---

archive/issue_comments_460001.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-03-12T21:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460001",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_460002.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYou beat me by 5 minutes :-) \nBut I've tested that this works.",
    "created_at": "2020-03-12T21:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460002",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

You beat me by 5 minutes :-) 
But I've tested that this works.



---

archive/issue_comments_460003.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2020-03-12T21:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460003",
    "user": "https://github.com/dimpase"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_comments_460004.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-this inculdes `twisted` and `flask*` packages\n+This includes `twisted` and `flask*` packages.\n``````\n",
    "created_at": "2020-03-13T18:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460004",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-this inculdes `twisted` and `flask*` packages
+This includes `twisted` and `flask*` packages.
``````




---

archive/issue_comments_460005.json:
```json
{
    "body": "Changed keywords from none to **sagenb, dependencies, optional**",
    "created_at": "2020-03-13T18:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460005",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **sagenb, dependencies, optional**



---

archive/issue_comments_460006.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n@kiwifb told me that terminado uses twisted, so maybe twisted should be kept as standard. (Also, it should be listed in terminado's dependencies file, if this is accurate.) Can anyone confirm?",
    "created_at": "2020-03-13T20:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460006",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

@kiwifb told me that terminado uses twisted, so maybe twisted should be kept as standard. (Also, it should be listed in terminado's dependencies file, if this is accurate.) Can anyone confirm?



---

archive/issue_events_400579.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-13T20:14:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400579"
}
```



---

archive/issue_events_400580.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-13T20:14:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400580"
}
```



---

archive/issue_comments_460007.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI should have said tornado, I misread the output of my dependency query in gentoo.  That being said terminado depends on tornado.",
    "created_at": "2020-03-13T20:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460007",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

I should have said tornado, I misread the output of my dependency query in gentoo.  That being said terminado depends on tornado.



---

archive/issue_comments_460008.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nthe tests pass, and I manually checked dependencies to make sure that this change  leads to no standard packages missing deps. If there are undeclared deps of untested standard packages, it is a bug.",
    "created_at": "2020-03-13T20:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460008",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

the tests pass, and I manually checked dependencies to make sure that this change  leads to no standard packages missing deps. If there are undeclared deps of untested standard packages, it is a bug.



---

archive/issue_comments_460009.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOther candidates for downgrade: python_openid, speaklater",
    "created_at": "2020-03-13T20:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460009",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:8" align="right">comment:8</div>

Other candidates for downgrade: python_openid, speaklater



---

archive/issue_comments_460010.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think we can downgrade tornado and terminado etc. I don't know who is using them.",
    "created_at": "2020-03-13T20:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460010",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

I think we can downgrade tornado and terminado etc. I don't know who is using them.



---

archive/issue_comments_460011.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe Jupyter notebook may use these if they are available, but I don't know any details.",
    "created_at": "2020-03-13T21:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460011",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

The Jupyter notebook may use these if they are available, but I don't know any details.



---

archive/issue_comments_460012.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment%3A10):\n> The Jupyter notebook may use these if they are available, but I don't know any details.\n\nThey are actually mandatory https://github.com/jupyter/notebook/blob/master/setup.py#L99",
    "created_at": "2020-03-13T21:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460012",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment%3A10):
> The Jupyter notebook may use these if they are available, but I don't know any details.

They are actually mandatory https://github.com/jupyter/notebook/blob/master/setup.py#L99



---

archive/issue_comments_460013.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTwisted, on the other hand, looks optional: see \"Prerequisites\" in https://www.tornadoweb.org/. Twisted is only used in `tornado.platform.twisted`: \"This module lets you run applications and libraries written for Twisted in a Tornado application.\"",
    "created_at": "2020-03-13T21:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460013",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Twisted, on the other hand, looks optional: see "Prerequisites" in https://www.tornadoweb.org/. Twisted is only used in `tornado.platform.twisted`: "This module lets you run applications and libraries written for Twisted in a Tornado application."



---

archive/issue_comments_460014.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSo it looks to me like `python_openid`, `speaklater`, and `twisted` could all be removed. Re `twisted` especially, we should not only build and run tests, but also make sure the Jupyter notebook works.",
    "created_at": "2020-03-13T21:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460014",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

So it looks to me like `python_openid`, `speaklater`, and `twisted` could all be removed. Re `twisted` especially, we should not only build and run tests, but also make sure the Jupyter notebook works.



---

archive/issue_comments_460015.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment%3A7):\n> the tests pass\n\nNot for me:\n\n```\n$ ./sage -t src/sage/combinat/root_system/cartan_type.py\nRunning doctests with ID 2020-03-13-16-27-46-31297653.\nGit branch: t/29320/29320\nUsing --optional=build,dochtml,sage\nDoctesting 1 file.\nsage -t --warn-long 69.1 src/sage/combinat/root_system/cartan_type.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/cartan_type.py\", line 3069, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__\nFailed example:\n    pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/persist.pyx\", line 548, in sage.misc.persist.unpickle_global (build/cythonized/sage/misc/persist.c:5033)\n        __import__(module)\n    ModuleNotFoundError: No module named 'twisted'\n\n...\n```",
    "created_at": "2020-03-13T23:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460015",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment%3A7):
> the tests pass

Not for me:

```
$ ./sage -t src/sage/combinat/root_system/cartan_type.py
Running doctests with ID 2020-03-13-16-27-46-31297653.
Git branch: t/29320/29320
Using --optional=build,dochtml,sage
Doctesting 1 file.
sage -t --warn-long 69.1 src/sage/combinat/root_system/cartan_type.py
**********************************************************************
File "src/sage/combinat/root_system/cartan_type.py", line 3069, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__
Failed example:
    pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/persist.pyx", line 548, in sage.misc.persist.unpickle_global (build/cythonized/sage/misc/persist.c:5033)
        __import__(module)
    ModuleNotFoundError: No module named 'twisted'

...
```



---

archive/issue_comments_460016.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIn brief testing, though, the Jupyter notebook looks okay.",
    "created_at": "2020-03-13T23:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460016",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

In brief testing, though, the Jupyter notebook looks okay.



---

archive/issue_comments_460017.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI propose these changes:\n\n```diff\ndiff --git a/build/pkgs/python_openid/type b/build/pkgs/python_openid/type\nindex a6a7b9cd72..134d9bc32d 100644\n--- a/build/pkgs/python_openid/type\n+++ b/build/pkgs/python_openid/type\n@@ -1 +1 @@\n-standard\n+optional\ndiff --git a/build/pkgs/speaklater/type b/build/pkgs/speaklater/type\nindex a6a7b9cd72..134d9bc32d 100644\n--- a/build/pkgs/speaklater/type\n+++ b/build/pkgs/speaklater/type\n@@ -1 +1 @@\n-standard\n+optional\ndiff --git a/build/pkgs/twisted/type b/build/pkgs/twisted/type\nindex 134d9bc32d..a6a7b9cd72 100644\n--- a/build/pkgs/twisted/type\n+++ b/build/pkgs/twisted/type\n@@ -1 +1 @@\n-optional\n+standard\n```",
    "created_at": "2020-03-13T23:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460017",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

I propose these changes:

```diff
diff --git a/build/pkgs/python_openid/type b/build/pkgs/python_openid/type
index a6a7b9cd72..134d9bc32d 100644
--- a/build/pkgs/python_openid/type
+++ b/build/pkgs/python_openid/type
@@ -1 +1 @@
-standard
+optional
diff --git a/build/pkgs/speaklater/type b/build/pkgs/speaklater/type
index a6a7b9cd72..134d9bc32d 100644
--- a/build/pkgs/speaklater/type
+++ b/build/pkgs/speaklater/type
@@ -1 +1 @@
-standard
+optional
diff --git a/build/pkgs/twisted/type b/build/pkgs/twisted/type
index 134d9bc32d..a6a7b9cd72 100644
--- a/build/pkgs/twisted/type
+++ b/build/pkgs/twisted/type
@@ -1 +1 @@
-optional
+standard
```



---

archive/issue_comments_460018.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment%3A14):\n> Replying to [@dimpase](#comment%3A7):\n> > the tests pass\n> \n> \n> Not for me:\n> \n> ```\n> $ ./sage -t src/sage/combinat/root_system/cartan_type.py\n> ...\n> ```\n\nAdmittedly, this is a doctest for a sort of stupid function: \"Implements the unpickling of Cartan types pickled by Sage <= 4.0.\"",
    "created_at": "2020-03-13T23:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460018",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment%3A14):
> Replying to [@dimpase](#comment%3A7):
> > the tests pass
> 
> 
> Not for me:
> 
> ```
> $ ./sage -t src/sage/combinat/root_system/cartan_type.py
> ...
> ```

Admittedly, this is a doctest for a sort of stupid function: "Implements the unpickling of Cartan types pickled by Sage <= 4.0."



---

archive/issue_comments_460019.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jhpalmieri](#comment%3A17):\n> Replying to [@jhpalmieri](#comment%3A14):\n> > Replying to [@dimpase](#comment%3A7):\n> > > the tests pass\n> > \n> > \n> > Not for me:\n> > \n> > ```\n> > $ ./sage -t src/sage/combinat/root_system/cartan_type.py\n> > ...\n> > ```\n> \n> \n> Admittedly, this is a doctest for a sort of stupid function: \"Implements the unpickling of Cartan types pickled by Sage <= 4.0.\"\n\nOops, I overlooked this, I thought that this must be irrelevant.\n\nLet's just tag it `# optional - twisted`. I don't see a need to keep `twisted` standard just cause of this.",
    "created_at": "2020-03-13T23:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460019",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jhpalmieri](#comment%3A17):
> Replying to [@jhpalmieri](#comment%3A14):
> > Replying to [@dimpase](#comment%3A7):
> > > the tests pass
> > 
> > 
> > Not for me:
> > 
> > ```
> > $ ./sage -t src/sage/combinat/root_system/cartan_type.py
> > ...
> > ```
> 
> 
> Admittedly, this is a doctest for a sort of stupid function: "Implements the unpickling of Cartan types pickled by Sage <= 4.0."

Oops, I overlooked this, I thought that this must be irrelevant.

Let's just tag it `# optional - twisted`. I don't see a need to keep `twisted` standard just cause of this.



---

archive/issue_comments_460020.json:
```json
{
    "body": "Changed branch from **[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)** to **[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)**",
    "created_at": "2020-03-14T01:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460020",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)** to **[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)**



---

archive/issue_comments_460021.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOkay, ready for review. Please check the functionality of the Jupyter notebook; do we lose anything when we build without twisted?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d\"><code>d93d9d1</code></a></td><td><code>trac 29320: make python_openid and speaklater optional.</code></td></tr></table>\n",
    "created_at": "2020-03-14T01:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460021",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Okay, ready for review. Please check the functionality of the Jupyter notebook; do we lose anything when we build without twisted?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d"><code>d93d9d1</code></a></td><td><code>trac 29320: make python_openid and speaklater optional.</code></td></tr></table>




---

archive/issue_comments_460022.json:
```json
{
    "body": "Changed commit from **[`89d2a99`](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)** to **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**",
    "created_at": "2020-03-14T01:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460022",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`89d2a99`](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)** to **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**



---

archive/issue_events_400581.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-14T01:03:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400581"
}
```



---

archive/issue_events_400582.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-14T01:03:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400582"
}
```



---

archive/issue_comments_460023.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nLooking at:\n\n```\n$ cat build/pkgs/sagenb/dependencies \n$(STARTED) | pip babel flask flask_autoindex flask_babel flask_oldsessions flask_openid mathjax twisted sphinx\n\n----------\nAll lines of this file are ignored except the first.\nIt is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.\n```\n\nAre there other dependencies to be removed from being standard? like babel ?",
    "created_at": "2020-03-15T08:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460023",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:22" align="right">comment:22</div>

Looking at:

```
$ cat build/pkgs/sagenb/dependencies 
$(STARTED) | pip babel flask flask_autoindex flask_babel flask_oldsessions flask_openid mathjax twisted sphinx

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
```

Are there other dependencies to be removed from being standard? like babel ?



---

archive/issue_comments_460024.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n`babel` should actually be in the list removed from standard I believe. Thanks for bringing it up. `twisted` seems a bit ambiguous but `mathjax` and `sphinx` should definitely stay standard.",
    "created_at": "2020-03-15T08:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460024",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

`babel` should actually be in the list removed from standard I believe. Thanks for bringing it up. `twisted` seems a bit ambiguous but `mathjax` and `sphinx` should definitely stay standard.



---

archive/issue_comments_460025.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n`babel` is listed as a dependency of Sphinx, so it should be kept.",
    "created_at": "2020-03-15T18:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460025",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

`babel` is listed as a dependency of Sphinx, so it should be kept.



---

archive/issue_comments_460026.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment%3A24):\n> `babel` is listed as a dependency of Sphinx, so it should be kept.\n\nAh! Sorry, my mistake.",
    "created_at": "2020-03-15T18:57:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460026",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment%3A24):
> `babel` is listed as a dependency of Sphinx, so it should be kept.

Ah! Sorry, my mistake.



---

archive/issue_comments_460027.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nLooks good, but we need to take care of the dependency of that pickle on twisted (on a followup ticket).",
    "created_at": "2020-03-16T16:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460027",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Looks good, but we need to take care of the dependency of that pickle on twisted (on a followup ticket).



---

archive/issue_comments_460028.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**",
    "created_at": "2020-03-16T16:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460028",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, John Palmieri**



---

archive/issue_events_400583.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-16T16:08:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400583"
}
```



---

archive/issue_events_400584.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-16T16:08:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400584"
}
```



---

archive/issue_comments_460029.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI don't understand pickling, but I am tempted to make this change:\n\n```diff\ndiff --git a/src/sage/combinat/root_system/cartan_type.py b/src/sage/combinat/root_system/cartan_type.py\nindex 202e1abe11..3cac952462 100644\n--- a/src/sage/combinat/root_system/cartan_type.py\n+++ b/src/sage/combinat/root_system/cartan_type.py\n@@ -3066,10 +3066,10 @@ class CartanType_simple_finite(object):\n \n             sage: pg_CartanType_simple_finite = unpickle_global('sage.combinat.root_system.cartan_type', 'CartanType_simple_finite')\n             sage: si1 = unpickle_newobj(pg_CartanType_simple_finite, ())\n-            sage: pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')\n+            sage: from sage.misc.fpickle import unpickleModule\n             sage: pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\n             sage: si2 = pg_make_integer('4')\n-            sage: unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})\n+            sage: unpickle_build(si1, {'tools':unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})\n \n             sage: si1\n             ['A', 4]\n```\nI'm building and running tests now.",
    "created_at": "2020-03-16T21:11:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460029",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

I don't understand pickling, but I am tempted to make this change:

```diff
diff --git a/src/sage/combinat/root_system/cartan_type.py b/src/sage/combinat/root_system/cartan_type.py
index 202e1abe11..3cac952462 100644
--- a/src/sage/combinat/root_system/cartan_type.py
+++ b/src/sage/combinat/root_system/cartan_type.py
@@ -3066,10 +3066,10 @@ class CartanType_simple_finite(object):
 
             sage: pg_CartanType_simple_finite = unpickle_global('sage.combinat.root_system.cartan_type', 'CartanType_simple_finite')
             sage: si1 = unpickle_newobj(pg_CartanType_simple_finite, ())
-            sage: pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')
+            sage: from sage.misc.fpickle import unpickleModule
             sage: pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
             sage: si2 = pg_make_integer('4')
-            sage: unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})
+            sage: unpickle_build(si1, {'tools':unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})
 
             sage: si1
             ['A', 4]
```
I'm building and running tests now.



---

archive/issue_comments_460030.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSee #29348 for the pickling issue.",
    "created_at": "2020-03-16T22:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460030",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

See #29348 for the pickling issue.



---

archive/issue_events_400585.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-18T22:40:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400585"
}
```



---

archive/issue_events_400586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a0ee3398205e4d646a56387f74628b9bcc2c22a6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-18T22:40:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-400586"
}
```



---

archive/issue_comments_460031.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)** to **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**",
    "created_at": "2020-03-18T22:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460031",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)** to **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)**



---

archive/issue_comments_460032.json:
```json
{
    "body": "Changed commit from **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)** to none",
    "created_at": "2020-05-28T17:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460032",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`d93d9d1`](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)** to none



---

archive/issue_comments_460033.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nFollowup at #29752: werkzeug can be optional, too.",
    "created_at": "2020-05-28T17:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-460033",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Followup at #29752: werkzeug can be optional, too.
