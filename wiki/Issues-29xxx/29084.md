# Issue 29084: Make fflas_ffpack detect and use system openblas on Arch

archive/issues_028847.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThe fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n\nDepends on #29051\nDepends on #29071\n\nCC:  @dimpase @videlec\n\nComponent: **build**\n\nAuthor: **Antonio Rojas**\n\nBranch/Commit: **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**\n\nReviewer: **Dima Pasechnik, Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29084_\n\n",
    "closed_at": "2020-01-31T23:49:27Z",
    "created_at": "2020-01-26T18:18:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make fflas_ffpack detect and use system openblas on Arch",
    "type": "issue",
    "updated_at": "2020-01-31T23:49:27Z",
    "url": "https://github.com/sagemath/sage/issues/29084",
    "user": "https://github.com/antonio-rojas"
}
```
<div id="comment:0"></div>

The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.

Depends on #29051
Depends on #29071

CC:  @dimpase @videlec

Component: **build**

Author: **Antonio Rojas**

Branch/Commit: **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**

Reviewer: **Dima Pasechnik, Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29084_





---

archive/issue_events_397148.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:18:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397148"
}
```



---

archive/issue_events_397149.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:18:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397149"
}
```



---

archive/issue_comments_455237.json:
```json
{
    "body": "Branch: **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)**",
    "created_at": "2020-01-26T18:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455237",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)**



---

archive/issue_comments_455238.json:
```json
{
    "body": "Dependencies: **#29071**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455238",
    "user": "https://github.com/antonio-rojas"
}
```

Dependencies: **#29071**



---

archive/issue_events_397150.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397150"
}
```



---

archive/issue_comments_455239.json:
```json
{
    "body": "Commit: **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455239",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**



---

archive/issue_events_397151.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397151"
}
```



---

archive/issue_comments_455240.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0\"><code>06f46eb</code></a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr></table>\n",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455240",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0"><code>06f46eb</code></a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr></table>




---

archive/issue_comments_455241.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n``````\n",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455241",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.
``````




---

archive/issue_comments_455242.json:
```json
{
    "body": "Author: **Antonio Rojas**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455242",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas**



---

archive/issue_events_397152.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397152"
}
```



---

archive/issue_comments_455243.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nlooks good to me.",
    "created_at": "2020-01-28T09:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455243",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

looks good to me.



---

archive/issue_comments_455244.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-01-28T09:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455244",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_397153.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T09:52:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397153"
}
```



---

archive/issue_events_397154.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T09:52:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397154"
}
```



---

archive/issue_comments_455245.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nplesase also see [#29088 comment:13](https://github.com/sagemath/sage/issues/29088#comment:13) - it might be relevant to Arch in particular.",
    "created_at": "2020-01-28T10:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455245",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

plesase also see [#29088 comment:13](https://github.com/sagemath/sage/issues/29088#comment:13) - it might be relevant to Arch in particular.



---

archive/issue_events_397155.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:26:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397155"
}
```



---

archive/issue_events_397156.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:26:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397156"
}
```



---

archive/issue_comments_455246.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIs this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.",
    "created_at": "2020-01-28T16:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455246",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.



---

archive/issue_comments_455247.json:
```json
{
    "body": "Changed dependencies from **#29071** to **#29051, #29071**",
    "created_at": "2020-01-28T16:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455247",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29071** to **#29051, #29071**



---

archive/issue_events_397157.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-28T16:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397157"
}
```



---

archive/issue_events_397158.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-28T16:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397158"
}
```



---

archive/issue_comments_455248.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mkoeppe](#comment%3A5):\n> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n\nYes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.",
    "created_at": "2020-01-28T16:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455248",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mkoeppe](#comment%3A5):
> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.

Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.



---

archive/issue_comments_455249.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@antonio-rojas](#comment%3A7):\n> Replying to [@mkoeppe](#comment%3A5):\n> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n> \n> \n> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.\n\nThanks for the explanation. How does one recognize this situation in the logs? \n\nIn https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\nPart of the fflas configure log:\n\n```\n-----------------------------------------------\n     START  FFLAS-FFPACK CONFIG                \n-----------------------------------------------\nchecking for OpenMP... yes\nDetecting SIMD instruction set\nSSE enabled\nSSE2 enabled\nSSE3 enabled\nSSSE3 enabled\nSSE4.1 enabled\nSSE4.2 enabled\nAVX enabled\nAVX2 enabled\nAVX512F enabled\nAVX512VL enabled\nAVX512DQ enabled\nFMA3 enabled\nFMA4 disabled\n-----------------------------------------------\n...\nchecking for GIVARO usability... yes\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... yes (lapack)\nchecking if this is OpenBLAS... yes\nchecking for OPENBLAS numthreads... none specified (using default value 1)\n```",
    "created_at": "2020-01-28T21:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455249",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@antonio-rojas](#comment%3A7):
> Replying to [@mkoeppe](#comment%3A5):
> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.
> 
> 
> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.

Thanks for the explanation. How does one recognize this situation in the logs? 

In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

Part of the fflas configure log:

```
-----------------------------------------------
     START  FFLAS-FFPACK CONFIG                
-----------------------------------------------
checking for OpenMP... yes
Detecting SIMD instruction set
SSE enabled
SSE2 enabled
SSE3 enabled
SSSE3 enabled
SSE4.1 enabled
SSE4.2 enabled
AVX enabled
AVX2 enabled
AVX512F enabled
AVX512VL enabled
AVX512DQ enabled
FMA3 enabled
FMA4 disabled
-----------------------------------------------
...
checking for GIVARO usability... yes
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... yes (lapack)
checking if this is OpenBLAS... yes
checking for OPENBLAS numthreads... none specified (using default value 1)
```



---

archive/issue_comments_455250.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mkoeppe](#comment%3A8):\n\n> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\nThat build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n\nIf you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print\n\n`checking if this is OpenBLAS... no`\n\nand with this patch it should print\n\n`checking if this is OpenBLAS... yes`",
    "created_at": "2020-01-28T22:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455250",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mkoeppe](#comment%3A8):

> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.

If you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print

`checking if this is OpenBLAS... no`

and with this patch it should print

`checking if this is OpenBLAS... yes`



---

archive/issue_comments_455251.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThank you!",
    "created_at": "2020-01-28T23:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Thank you!



---

archive/issue_comments_455252.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@antonio-rojas](#comment%3A9):\n> Replying to [@mkoeppe](#comment%3A8):\n> \n> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n> \n> \n> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n> \n> If you have Arch openblas, lapack and cblas packages installed, ...\n\nThanks. I have added these packages now to the \"standard\" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner\non the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, \n`archlinux-latest-standard` no longer decides to build openblas.\n\nNow I see in `fflas-ffpack` config:\n\n```\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... yes\n```\n\nWithout the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)\n\n```\nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... no\n```\n-- like you said. Great!",
    "created_at": "2020-01-29T02:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455252",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@antonio-rojas](#comment%3A9):
> Replying to [@mkoeppe](#comment%3A8):
> 
> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949
> 
> 
> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.
> 
> If you have Arch openblas, lapack and cblas packages installed, ...

Thanks. I have added these packages now to the "standard" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner
on the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, 
`archlinux-latest-standard` no longer decides to build openblas.

Now I see in `fflas-ffpack` config:

```
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... yes
```

Without the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)

```
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... no
```
-- like you said. Great!



---

archive/issue_events_397159.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T02:46:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397159"
}
```



---

archive/issue_events_397160.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T02:46:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397160"
}
```



---

archive/issue_comments_455253.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHowever, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.",
    "created_at": "2020-01-29T02:46:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455253",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.



---

archive/issue_comments_455254.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWhich run are you referring to?",
    "created_at": "2020-01-29T07:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455254",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Which run are you referring to?



---

archive/issue_comments_455255.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@mkoeppe](#comment%3A12):\n> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. \n\nThe error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?",
    "created_at": "2020-01-29T07:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455255",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@mkoeppe](#comment%3A12):
> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. 

The error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?



---

archive/issue_comments_455256.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWithout the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, \n- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true \n\nWith the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, \n- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true",
    "created_at": "2020-01-29T14:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455256",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Without the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, 
- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true 

With the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, 
- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true



---

archive/issue_comments_455257.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMy guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\nWould using `pkg-config --cflags-only-I ` be enough to take care of archlinux?",
    "created_at": "2020-01-29T14:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455257",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?



---

archive/issue_comments_455258.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\n> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?\n\nThat's not the case, the output of pkg-config --cflags can be seen in the logs:\n\n```\nUsing --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '\n```\n\nThat being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.",
    "created_at": "2020-01-29T14:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455258",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment%3A16):
> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?

That's not the case, the output of pkg-config --cflags can be seen in the logs:

```
Using --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '
```

That being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.



---

archive/issue_comments_455259.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI think \n\n```\n2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'\n2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'\n2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'\n```\nin the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage",
    "created_at": "2020-01-29T14:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455259",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

I think 

```
2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'
2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'
2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'
```
in the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage



---

archive/issue_comments_455260.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIt's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.",
    "created_at": "2020-01-29T14:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455260",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.



---

archive/issue_comments_455261.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@mkoeppe](#comment%3A19):\n> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. \n\nabsolutely.",
    "created_at": "2020-01-29T15:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455261",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@mkoeppe](#comment%3A19):
> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. 

absolutely.



---

archive/issue_comments_455262.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm setting this ticket back to \"positive review\" and will open a separate issue for this.",
    "created_at": "2020-01-29T15:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455262",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm setting this ticket back to "positive review" and will open a separate issue for this.



---

archive/issue_events_397161.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T15:04:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397161"
}
```



---

archive/issue_events_397162.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T15:04:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397162"
}
```



---

archive/issue_comments_455263.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThanks everyone for your patience!",
    "created_at": "2020-01-29T15:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455263",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Thanks everyone for your patience!



---

archive/issue_comments_455264.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment%3A21):\n> I'm setting this ticket back to \"positive review\" and will open a separate issue for this.\n\nThis is now #29102: fflas_ffpack installation error on new CPUs with old compilers",
    "created_at": "2020-01-29T15:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455264",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment%3A21):
> I'm setting this ticket back to "positive review" and will open a separate issue for this.

This is now #29102: fflas_ffpack installation error on new CPUs with old compilers



---

archive/issue_comments_455265.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**",
    "created_at": "2020-01-29T15:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455265",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**



---

archive/issue_comments_455266.json:
```json
{
    "body": "Changed branch from **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)** to **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**",
    "created_at": "2020-01-31T23:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-455266",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)** to **[`06f46eb`](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**



---

archive/issue_events_397163.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397163"
}
```



---

archive/issue_events_397164.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b38e091a96610f8a13d00959c8d56f924b08ca39",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T23:49:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-397164"
}
```
