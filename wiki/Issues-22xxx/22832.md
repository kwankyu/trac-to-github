# Issue 22832: Add an option to the test runner to exit immediately upon the first failure

archive/issues_022595.json:
```json
{
    "body": "Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.\n\nI've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.\n\n**Branch/Commit:** [c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/22832\n\n",
    "closed_at": "2017-04-23T12:57:20Z",
    "created_at": "2017-04-19T11:41:36Z",
    "labels": [
        "component: doctest framework",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "Add an option to the test runner to exit immediately upon the first failure",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/22832",
    "user": "https://github.com/embray"
}
```
Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.

I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.

**Branch/Commit:** [c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)

**Reviewer:** Jeroen Demeyer

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/22832





---

archive/issue_comments_342983.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c12a4d387fcce94dca376cea02d763f49a8c3760\">c12a4d3</a></td><td><code>Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65\">2f359e8</a></td><td><code>Make --fail-once work with parallel doctests.</code></td></tr></table>\n",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342983",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c12a4d387fcce94dca376cea02d763f49a8c3760">c12a4d3</a></td><td><code>Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65">2f359e8</a></td><td><code>Make --fail-once work with parallel doctests.</code></td></tr></table>




---

archive/issue_comments_342984.json:
```json
{
    "body": "**Commit:** [2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342984",
    "user": "https://github.com/embray"
}
```

**Commit:** [2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)



---

archive/issue_comments_342985.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342985",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_events_205432.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-19T11:42:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205432"
}
```



---

archive/issue_comments_342986.json:
```json
{
    "body": "**Branch:** [u/embray/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/tests/fail-once)",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342986",
    "user": "https://github.com/embray"
}
```

**Branch:** [u/embray/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/tests/fail-once)



---

archive/issue_comments_342987.json:
```json
{
    "body": "Replying to [ticket:22832 embray]:\n> Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n\nObvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.",
    "created_at": "2017-04-19T12:32:02Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342987",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22832 embray]:
> Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.

Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.



---

archive/issue_events_205433.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-19T12:42:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205433"
}
```



---

archive/issue_events_205434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-19T12:42:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205434"
}
```



---

archive/issue_comments_342988.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm making some changes, hang on...",
    "created_at": "2017-04-19T12:42:18Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342988",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
I'm making some changes, hang on...



---

archive/issue_comments_342989.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/tests/fail-once)\" to \"[u/jdemeyer/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/tests/fail-once)\".",
    "created_at": "2017-04-19T15:00:48Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342989",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/embray/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/tests/fail-once)" to "[u/jdemeyer/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/tests/fail-once)".



---

archive/issue_comments_342990.json:
```json
{
    "body": "**Changing commit** from \"[2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)\" to \"[c2bff84e640507306d52b108e3ee440eb555ddba](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)\".",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342990",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)" to "[c2bff84e640507306d52b108e3ee440eb555ddba](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)".



---

archive/issue_comments_342991.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n+Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.\n \n I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.\n``````\n",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342991",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.
+Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.
 
 I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.
``````




---

archive/issue_events_205435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-19T15:03:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205435"
}
```



---

archive/issue_events_205436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-19T15:03:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205436"
}
```



---

archive/issue_comments_342992.json:
```json
{
    "body": "<a id='comment:5'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f26f64e6aecc9c86280164ba34e1bf02a4cb379b\">f26f64e</a></td><td><code>Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e9a80cc857e33069a642656c3138dbfa4e30058\">2e9a80c</a></td><td><code>Make --fail-once work with parallel doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba\">c2bff84</a></td><td><code>Rename --fail-once to --exitfirst; minor fixes; add test</code></td></tr></table>\n",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342992",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f26f64e6aecc9c86280164ba34e1bf02a4cb379b">f26f64e</a></td><td><code>Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e9a80cc857e33069a642656c3138dbfa4e30058">2e9a80c</a></td><td><code>Make --fail-once work with parallel doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba">c2bff84</a></td><td><code>Rename --fail-once to --exitfirst; minor fixes; add test</code></td></tr></table>




---

archive/issue_comments_342993.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342993",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_205437.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-20T09:09:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205437"
}
```



---

archive/issue_events_205438.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-20T09:09:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205438"
}
```



---

archive/issue_comments_342994.json:
```json
{
    "body": "<a id='comment:6'></a>\nI'm fine with that, thanks.",
    "created_at": "2017-04-20T09:09:00Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342994",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I'm fine with that, thanks.



---

archive/issue_comments_342995.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@jdemeyer](#comment%3A2):\n> Replying to [ticket:22832 embray]:\n> > Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n\n> \n> Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.\n\nI personally find \"fail once\" to be clearer than \"exit first\"--\"Exit first what?\" is what it makes me ask.  That said, the documentation makes it clear enough, and I don't mind the consistency.",
    "created_at": "2017-04-20T09:22:10Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342995",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Replying to [@jdemeyer](#comment%3A2):
> Replying to [ticket:22832 embray]:
> > Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.

> 
> Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.

I personally find "fail once" to be clearer than "exit first"--"Exit first what?" is what it makes me ask.  That said, the documentation makes it clear enough, and I don't mind the consistency.



---

archive/issue_comments_342996.json:
```json
{
    "body": "<a id='comment:8'></a>\nOops, one little nitpick--you forgot to remove the line `fail_immediately=False` after renaming it to `abort_now` everywhere else.",
    "created_at": "2017-04-20T09:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342996",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Oops, one little nitpick--you forgot to remove the line `fail_immediately=False` after renaming it to `abort_now` everywhere else.



---

archive/issue_events_205439.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-20T09:31:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205439"
}
```



---

archive/issue_events_205440.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-20T09:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205440"
}
```



---

archive/issue_comments_342997.json:
```json
{
    "body": "**Changing commit** from \"[c2bff84e640507306d52b108e3ee440eb555ddba](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)\" to \"[c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)\".",
    "created_at": "2017-04-20T09:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c2bff84e640507306d52b108e3ee440eb555ddba](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)" to "[c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)".



---

archive/issue_comments_342998.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90\">c6a5b40</a></td><td><code>Remove forgotten line</code></td></tr></table>\n",
    "created_at": "2017-04-20T09:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90">c6a5b40</a></td><td><code>Remove forgotten line</code></td></tr></table>




---

archive/issue_events_205441.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-20T09:36:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205441"
}
```



---

archive/issue_events_205442.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-20T09:36:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205442"
}
```



---

archive/issue_events_205443.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205443"
}
```



---

archive/issue_events_205444.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2b708d613c57ea09ecb56b926b1737e894b57603",
    "created_at": "2017-04-23T12:57:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22832#event-205444"
}
```



---

archive/issue_comments_342999.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/tests/fail-once)\" to \"[c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)\".",
    "created_at": "2017-04-23T12:57:20Z",
    "issue": "https://github.com/sagemath/sage/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22832#issuecomment-342999",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/tests/fail-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/tests/fail-once)" to "[c6a5b40146506795873a1cb7b64e645258251a90](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)".
