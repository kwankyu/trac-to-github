# Issue 32190: Add hashing to class functions

archive/issues_031953.json:
```json
{
    "body": "It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.\n\n**Assignee:** @trevorkarn\n\n**CC:**  @tscrim @trevorkarn\n\n**Keywords:** gsoc2021 class-function hash\n\n**Branch/Commit:** [cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Trevor K. Karn\n\nIssue created by migration from https://trac.sagemath.org/ticket/32190\n\n",
    "closed_at": "2021-07-24T15:27:47Z",
    "created_at": "2021-07-12T19:02:00Z",
    "labels": [
        "component: algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "title": "Add hashing to class functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/32190",
    "user": "https://github.com/trevorkarn"
}
```
It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.

**Assignee:** @trevorkarn

**CC:**  @tscrim @trevorkarn

**Keywords:** gsoc2021 class-function hash

**Branch/Commit:** [cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)

**Reviewer:** Travis Scrimshaw

**Author:** Trevor K. Karn

Issue created by migration from https://trac.sagemath.org/ticket/32190





---

archive/issue_comments_521330.json:
```json
{
    "body": "**Branch:** [u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)",
    "created_at": "2021-07-12T19:02:25Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521330",
    "user": "https://github.com/trevorkarn"
}
```

**Branch:** [u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)



---

archive/issue_comments_521331.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-12T19:09:36Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_comments_521332.json:
```json
{
    "body": "**Commit:** [0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)",
    "created_at": "2021-07-12T19:09:36Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)



---

archive/issue_events_291604.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:19:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "rename": {
        "from": "Add hash to class functions",
        "to": "Add `CachedRepresentation` to class functions"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291604"
}
```



---

archive/issue_comments_521333.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-12T19:19:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521333",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_comments_521334.json:
```json
{
    "body": "**Assignee:** @trevorkarn",
    "created_at": "2021-07-12T19:19:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521334",
    "user": "https://github.com/trevorkarn"
}
```

**Assignee:** @trevorkarn



---

archive/issue_comments_521335.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put ``ClassFunction``s into the category framework. In the mean time we implement a hash function to ``ClassFunction_gap`` and ``ClassFunction_libgap``\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-12T19:19:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521335",
    "user": "https://github.com/trevorkarn"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put ``ClassFunction``s into the category framework. In the mean time we implement a hash function to ``ClassFunction_gap`` and ``ClassFunction_libgap``
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
``````




---

archive/issue_comments_521336.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498\">a602e4e</a></td><td><code>Add CachedRepresentation to ClassFunction_gap</code></td></tr></table>\n",
    "created_at": "2021-07-12T21:39:01Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521336",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498">a602e4e</a></td><td><code>Add CachedRepresentation to ClassFunction_gap</code></td></tr></table>




---

archive/issue_events_291605.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T21:39:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291605"
}
```



---

archive/issue_comments_521337.json:
```json
{
    "body": "**Changing commit** from \"[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)\" to \"[a602e4e05d00a4877b0759d942cda0fe3f597498](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)\".",
    "created_at": "2021-07-12T21:39:01Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521337",
    "user": "https://github.com/trevorkarn"
}
```

**Changing commit** from "[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)" to "[a602e4e05d00a4877b0759d942cda0fe3f597498](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)".



---

archive/issue_comments_521338.json:
```json
{
    "body": "**Changing branch** from \"[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)\" to \"[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)\".",
    "created_at": "2021-07-12T21:39:01Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521338",
    "user": "https://github.com/trevorkarn"
}
```

**Changing branch** from "[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)" to "[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)".



---

archive/issue_comments_521339.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't see why making this a `CachedRepresentation` is needed to do that. All you would need is the equality comparison and a `__hash__`. Can you explain the reasoning in a bit more detail?",
    "created_at": "2021-07-12T22:45:08Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521339",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I don't see why making this a `CachedRepresentation` is needed to do that. All you would need is the equality comparison and a `__hash__`. Can you explain the reasoning in a bit more detail?



---

archive/issue_comments_521340.json:
```json
{
    "body": "<a id='comment:6'></a>\nMy main reasoning was that I wanted to pass an instance of `ClassFunction` as an argument of `FiniteDimensionalTwistedInvariantModule.__init__` of #32145 and when doing doctesting I was getting errors which seemed to be because of cacheing (`FiniteDimensionalTwistedInvariantModule` inherits from `UniqueRepresentation` via `SubmoduleWithBasis`). It did work to fix it with a hash (c.f. commit \u200b0cdd853 on branch u/tkarn/class_function_hash-32190) but I didn't see anywhere else in source code that directly implemented a `__hash__` and so I thought `CachedRepresentation` seemed like the right way to do it following the general Sage conventions.",
    "created_at": "2021-07-13T16:00:43Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521340",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:6'></a>
My main reasoning was that I wanted to pass an instance of `ClassFunction` as an argument of `FiniteDimensionalTwistedInvariantModule.__init__` of #32145 and when doing doctesting I was getting errors which seemed to be because of cacheing (`FiniteDimensionalTwistedInvariantModule` inherits from `UniqueRepresentation` via `SubmoduleWithBasis`). It did work to fix it with a hash (c.f. commit â€‹0cdd853 on branch u/tkarn/class_function_hash-32190) but I didn't see anywhere else in source code that directly implemented a `__hash__` and so I thought `CachedRepresentation` seemed like the right way to do it following the general Sage conventions.



---

archive/issue_comments_521341.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks for your frank reply. See [documentation](https://doc.sagemath.org/html/en/reference/structure/sage/structure/unique_representation.html#sage.structure.unique_representation.CachedRepresentation). The classes `CachedRepresentation` and `UniqueRepresentation` are to establish nonlocal objects. They introduce extra overhead, with possible savings when objects get created with equivalent construction parameters repeatedly, but they do that at the cost of modified semantics (you should really not change anything on these objects, because your changes may affect unrelated code). Oddly enough, `CachedRepresentation` does *not* define equality or hashing behaviour, so it shouldn't even do what you're using it for.",
    "created_at": "2021-07-13T16:53:00Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521341",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>
Thanks for your frank reply. See [documentation](https://doc.sagemath.org/html/en/reference/structure/sage/structure/unique_representation.html#sage.structure.unique_representation.CachedRepresentation). The classes `CachedRepresentation` and `UniqueRepresentation` are to establish nonlocal objects. They introduce extra overhead, with possible savings when objects get created with equivalent construction parameters repeatedly, but they do that at the cost of modified semantics (you should really not change anything on these objects, because your changes may affect unrelated code). Oddly enough, `CachedRepresentation` does *not* define equality or hashing behaviour, so it shouldn't even do what you're using it for.



---

archive/issue_comments_521342.json:
```json
{
    "body": "<a id='comment:8'></a>\nThank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?",
    "created_at": "2021-07-13T18:59:32Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521342",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:8'></a>
Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?



---

archive/issue_comments_521343.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-13T19:07:32Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521343",
    "user": "https://github.com/trevorkarn"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
``````




---

archive/issue_events_291606.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "rename": {
        "from": "Add `CachedRepresentation` to class functions",
        "to": "Add hashing to class functions"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291606"
}
```



---

archive/issue_comments_521344.json:
```json
{
    "body": "**Changing branch** from \"[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)\" to \"[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)\".",
    "created_at": "2021-07-13T19:07:32Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521344",
    "user": "https://github.com/trevorkarn"
}
```

**Changing branch** from "[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)" to "[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)".



---

archive/issue_comments_521345.json:
```json
{
    "body": "**Changing commit** from \"[a602e4e05d00a4877b0759d942cda0fe3f597498](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)\" to \"[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)\".",
    "created_at": "2021-07-13T19:07:32Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521345",
    "user": "https://github.com/trevorkarn"
}
```

**Changing commit** from "[a602e4e05d00a4877b0759d942cda0fe3f597498](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)" to "[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)".



---

archive/issue_events_291607.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291607"
}
```



---

archive/issue_events_291608.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291608"
}
```



---

archive/issue_comments_521346.json:
```json
{
    "body": "<a id='comment:9'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-13T19:07:32Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521346",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:9'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_comments_521347.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@trevorkarn](#comment%3A8):\n> Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?\n\nThat's just a python thing: hashable objects must be comparable for equality, and items that compare equal should have identical hashes. Without that, dictionary lookup and sets don't work properly (and hashable objects must play nice with sets and dictionaries -- that's what hashing is for). Because hash and equality need to be coordinated, it's normally not even possible in python to inherit one but not the other.\n\n(sage actually violates the python hash contract, because `1 == GF(5)(1) == 6`. This causes trouble, but it is required to have `==` work properly with coercion, which was felt important for a CAS)",
    "created_at": "2021-07-13T20:48:30Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521347",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:10'></a>
Replying to [@trevorkarn](#comment%3A8):
> Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?

That's just a python thing: hashable objects must be comparable for equality, and items that compare equal should have identical hashes. Without that, dictionary lookup and sets don't work properly (and hashable objects must play nice with sets and dictionaries -- that's what hashing is for). Because hash and equality need to be coordinated, it's normally not even possible in python to inherit one but not the other.

(sage actually violates the python hash contract, because `1 == GF(5)(1) == 6`. This causes trouble, but it is required to have `==` work properly with coercion, which was felt important for a CAS)



---

archive/issue_comments_521348.json:
```json
{
    "body": "<a id='comment:11'></a>\nThat makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error \n\n```div\n  {{{\nTypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be \ncombined with @richcmp_method\n  }}}\n```\n\nDoes that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?",
    "created_at": "2021-07-13T22:21:42Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521348",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:11'></a>
That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error 

```div
  {{{
TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be 
combined with @richcmp_method
  }}}
```

Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?



---

archive/issue_comments_521349.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22\">d2f7011</a></td><td><code>Add test for __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-13T22:25:06Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22">d2f7011</a></td><td><code>Add test for __hash__</code></td></tr></table>




---

archive/issue_comments_521350.json:
```json
{
    "body": "**Changing commit** from \"[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)\" to \"[d2f701149d765e18eb37fc5956dd3058b610be22](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)\".",
    "created_at": "2021-07-13T22:25:06Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0cdd853d451b14249211b1e3586be4ddcf7bdb35](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)" to "[d2f701149d765e18eb37fc5956dd3058b610be22](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)".



---

archive/issue_events_291609.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T22:25:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291609"
}
```



---

archive/issue_events_291610.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T22:25:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291610"
}
```



---

archive/issue_comments_521351.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@trevorkarn](#comment%3A11):\n> That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error \n> \n> ```div\n>   {{{\n> TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be \n> combined with @richcmp_method\n>   }}}\n> ```\n> \n> Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?\n\nYes, that's correct. The `_richcmp_` covers all comparison operators, in particular `==`.\n\nI would propose a slightly different hash function:\n\n```python\ndef __hash__(self):\n    return hash((self._group, self.values())\n```\nThese are the two things that are checked for equality, but you get distinct hashes for all of the class functions. Right now, all class functions have the same repr, so they all have the same hash (which is less than ideal).\n\nIt might also be good to put the `__hash__` method below the `__richcmp__` as typically the `__init__` is the first method.",
    "created_at": "2021-07-14T02:21:56Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521351",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [@trevorkarn](#comment%3A11):
> That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error 
> 
> ```div
>   {{{
> TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be 
> combined with @richcmp_method
>   }}}
> ```
> 
> Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?

Yes, that's correct. The `_richcmp_` covers all comparison operators, in particular `==`.

I would propose a slightly different hash function:

```python
def __hash__(self):
    return hash((self._group, self.values())
```
These are the two things that are checked for equality, but you get distinct hashes for all of the class functions. Right now, all class functions have the same repr, so they all have the same hash (which is less than ideal).

It might also be good to put the `__hash__` method below the `__richcmp__` as typically the `__init__` is the first method.



---

archive/issue_events_291611.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T12:02:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291611"
}
```



---

archive/issue_events_291612.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T12:02:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291612"
}
```



---

archive/issue_comments_521352.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4\">6834c91</a></td><td><code>Base `__hash__` off of self._group, self.values()</code></td></tr></table>\n",
    "created_at": "2021-07-14T15:44:55Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4">6834c91</a></td><td><code>Base `__hash__` off of self._group, self.values()</code></td></tr></table>




---

archive/issue_comments_521353.json:
```json
{
    "body": "**Changing commit** from \"[d2f701149d765e18eb37fc5956dd3058b610be22](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)\" to \"[6834c91fbe9d19b8ec3a13e377a64a85d94db7d4](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)\".",
    "created_at": "2021-07-14T15:44:55Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d2f701149d765e18eb37fc5956dd3058b610be22](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)" to "[6834c91fbe9d19b8ec3a13e377a64a85d94db7d4](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)".



---

archive/issue_events_291613.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T15:45:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291613"
}
```



---

archive/issue_events_291614.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T15:45:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291614"
}
```



---

archive/issue_comments_521354.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-14T15:45:55Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521354",
    "user": "https://github.com/trevorkarn"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.
``````




---

archive/issue_comments_521355.json:
```json
{
    "body": "**Changing commit** from \"[6834c91fbe9d19b8ec3a13e377a64a85d94db7d4](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)\" to \"[cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)\".",
    "created_at": "2021-07-14T23:14:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6834c91fbe9d19b8ec3a13e377a64a85d94db7d4](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)" to "[cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)".



---

archive/issue_comments_521356.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a\">cdd59ab</a></td><td><code>Remove .values()</code></td></tr></table>\n",
    "created_at": "2021-07-14T23:14:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a">cdd59ab</a></td><td><code>Remove .values()</code></td></tr></table>




---

archive/issue_comments_521357.json:
```json
{
    "body": "<a id='comment:20'></a>\nLGTM. Thank you.",
    "created_at": "2021-07-14T23:16:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521357",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
LGTM. Thank you.



---

archive/issue_comments_521358.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2021-07-14T23:16:58Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521358",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_291615.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-14T23:16:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291615"
}
```



---

archive/issue_events_291616.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-14T23:16:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291616"
}
```



---

archive/issue_events_291617.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-24T15:27:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291617"
}
```



---

archive/issue_events_291618.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "064f0c6c6b2e2457ef911810311b4e090d297b26",
    "created_at": "2021-07-24T15:27:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-291618"
}
```



---

archive/issue_comments_521359.json:
```json
{
    "body": "**Changing branch** from \"[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)\" to \"[cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)\".",
    "created_at": "2021-07-24T15:27:47Z",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-521359",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)" to "[cdd59ab74c88fe95d8e19aab6d0495ab74a9050a](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)".
