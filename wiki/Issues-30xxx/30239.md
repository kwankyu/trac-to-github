# Issue 30239: TensorField.__call__ alters zero

archive/issues_030002.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n\n```\nsage: M = Manifold(3, 'M', start_index=1)\nsage: X.<x,y,z> = M.chart()\nsage: omega = M.diff_form(1, 'omega')\nsage: omega[:] = [0, 0, 0]\nsage: omega(X.frame()[1])\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\nsage: M.zero_scalar_field()\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n```\n\n\nDepends on #30266\nDepends on #30291\n\nCC:  @egourgoulhon @tscrim @mkoeppe\n\nComponent: **manifolds**\n\nAuthor: **Michael Jung**\n\nBranch/Commit: **[u/gh-mjungmath/tensorfield___call___alters_zero](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/tensorfield___call___alters_zero) @ [`9f63351`](https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405)**\n\nReviewer: **Eric Gourgoulhon**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30239_\n\n",
    "created_at": "2020-07-28T13:46:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20info"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "TensorField.__call__ alters zero",
    "type": "issue",
    "updated_at": "2023-01-29T23:06:23Z",
    "url": "https://github.com/sagemath/sage/issues/30239",
    "user": "https://github.com/mjungmath"
}
```
<div id="comment:0"></div>


```
sage: M = Manifold(3, 'M', start_index=1)
sage: X.<x,y,z> = M.chart()
sage: omega = M.diff_form(1, 'omega')
sage: omega[:] = [0, 0, 0]
sage: omega(X.frame()[1])
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
sage: M.zero_scalar_field()
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
```


Depends on #30266
Depends on #30291

CC:  @egourgoulhon @tscrim @mkoeppe

Component: **manifolds**

Author: **Michael Jung**

Branch/Commit: **[u/gh-mjungmath/tensorfield___call___alters_zero](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/tensorfield___call___alters_zero) @ [`9f63351`](https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405)**

Reviewer: **Eric Gourgoulhon**

_Issue created by migration from https://trac.sagemath.org/ticket/30239_





---

archive/issue_events_413991.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-28T13:46:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413991"
}
```



---

archive/issue_events_413992.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-28T13:46:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
    "label_color": "0000ff",
    "label_name": "c: manifolds",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413992"
}
```



---

archive/issue_events_413993.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-28T13:46:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413993"
}
```



---

archive/issue_events_413994.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-28T13:46:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413994"
}
```



---

archive/issue_comments_479486.json:
```json
{
    "body": "Branch: **[u/gh-mjungmath/tensorfield___call___alters_zero](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/tensorfield___call___alters_zero)**",
    "created_at": "2020-07-28T14:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479486",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[u/gh-mjungmath/tensorfield___call___alters_zero](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/tensorfield___call___alters_zero)**



---

archive/issue_comments_479487.json:
```json
{
    "body": "Commit: **[`51ba4e3`](https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af)**",
    "created_at": "2020-07-28T14:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479487",
    "user": "https://github.com/mjungmath"
}
```

Commit: **[`51ba4e3`](https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af)**



---

archive/issue_events_413995.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-28T14:37:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413995"
}
```



---

archive/issue_comments_479488.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af\"><code>51ba4e3</code></a></td><td><code>Trac #30239: comp zero check for __call__</code></td></tr></table>\n",
    "created_at": "2020-07-28T14:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479488",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af"><code>51ba4e3</code></a></td><td><code>Trac #30239: comp zero check for __call__</code></td></tr></table>




---

archive/issue_comments_479489.json:
```json
{
    "body": "Author: **Michael Jung**",
    "created_at": "2020-07-28T18:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479489",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Michael Jung**



---

archive/issue_comments_479490.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nGood catch!\n\nHowever the proposed fix \n\n```\n            if omega == 0 or vv == 0:\n                return self.base_ring().zero()\n```\nis not acceptable, because the comparison with `0` can be very slow for complicated expressions. \nAlso, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\nFWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).",
    "created_at": "2020-07-28T18:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479490",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:4" align="right">comment:4</div>

Good catch!

However the proposed fix 

```
            if omega == 0 or vv == 0:
                return self.base_ring().zero()
```
is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 
Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).



---

archive/issue_comments_479491.json:
```json
{
    "body": "Changed author from **Michael Jung** to none",
    "created_at": "2020-07-28T18:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479491",
    "user": "https://github.com/egourgoulhon"
}
```

Changed author from **Michael Jung** to none



---

archive/issue_events_413996.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-07-28T18:14:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413996"
}
```



---

archive/issue_events_413997.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-07-28T18:14:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413997"
}
```



---

archive/issue_comments_479492.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSorry the author name was deleted by mistake.",
    "created_at": "2020-07-28T18:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479492",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:5" align="right">comment:5</div>

Sorry the author name was deleted by mistake.



---

archive/issue_comments_479493.json:
```json
{
    "body": "Author: **Michael Jung**",
    "created_at": "2020-07-28T18:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479493",
    "user": "https://github.com/egourgoulhon"
}
```

Author: **Michael Jung**



---

archive/issue_comments_479494.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n sage: omega[:] = [0, 0, 0]\n sage: omega(X.frame()[1])\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n-M.zero_scalar_field()\n+sage: M.zero_scalar_field()\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n ```\n \n``````\n",
    "created_at": "2020-07-28T18:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479494",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 sage: omega[:] = [0, 0, 0]
 sage: omega(X.frame()[1])
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
-M.zero_scalar_field()
+sage: M.zero_scalar_field()
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
 ```
 
``````




---

archive/issue_comments_479495.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@egourgoulhon](#comment%3A4):\n> Good catch!\n> \n> However the proposed fix \n> \n> ```\n>             if omega == 0 or vv == 0:\n>                 return self.base_ring().zero()\n> ```\n> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. \n\nI was afraid that you say that. :D\nI haven't found a fast check for components. Is there any?\n\n> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n\nI suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.",
    "created_at": "2020-07-28T18:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479495",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@egourgoulhon](#comment%3A4):
> Good catch!
> 
> However the proposed fix 
> 
> ```
>             if omega == 0 or vv == 0:
>                 return self.base_ring().zero()
> ```
> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 

I was afraid that you say that. :D
I haven't found a fast check for components. Is there any?

> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 

I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.



---

archive/issue_comments_479496.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mjungmath](#comment%3A7):\n>\n> I was afraid that you say that. :D\n> I haven't found a fast check for components. Is there any?\n>\n\nNo, `is_trivial_zero` is not implemented there. \n\n> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n> \n> \n> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.\n\nYou are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.",
    "created_at": "2020-07-30T18:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479496",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mjungmath](#comment%3A7):
>
> I was afraid that you say that. :D
> I haven't found a fast check for components. Is there any?
>

No, `is_trivial_zero` is not implemented there. 

> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 
> 
> 
> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.

You are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.



---

archive/issue_comments_479497.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70\"><code>78a50eb</code></a></td><td><code>Trac #30329: is zero check</code></td></tr></table>\n",
    "created_at": "2020-07-30T19:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479497",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70"><code>78a50eb</code></a></td><td><code>Trac #30329: is zero check</code></td></tr></table>




---

archive/issue_comments_479498.json:
```json
{
    "body": "Changed commit from **[`51ba4e3`](https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af)** to **[`78a50eb`](https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70)**",
    "created_at": "2020-07-30T19:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479498",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`51ba4e3`](https://github.com/sagemath/sagetrac-mirror/commit/51ba4e31bed6a7c1febd9fa270a1b56f929064af)** to **[`78a50eb`](https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70)**



---

archive/issue_events_413998.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-30T19:31:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413998"
}
```



---

archive/issue_events_413999.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-30T19:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-413999"
}
```



---

archive/issue_comments_479499.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat about this?",
    "created_at": "2020-07-30T19:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479499",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:10" align="right">comment:10</div>

What about this?



---

archive/issue_comments_479500.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7\"><code>3344505</code></a></td><td><code>Trac #30239: one check for (0,1) tensors</code></td></tr></table>\n",
    "created_at": "2020-07-30T19:35:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479500",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7"><code>3344505</code></a></td><td><code>Trac #30239: one check for (0,1) tensors</code></td></tr></table>




---

archive/issue_comments_479501.json:
```json
{
    "body": "Changed commit from **[`78a50eb`](https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70)** to **[`3344505`](https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7)**",
    "created_at": "2020-07-30T19:35:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479501",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`78a50eb`](https://github.com/sagemath/sagetrac-mirror/commit/78a50ebde64cfc196e0995427ec6574eebeeff70)** to **[`3344505`](https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7)**



---

archive/issue_comments_479502.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution",
    "created_at": "2020-07-30T19:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479502",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution



---

archive/issue_comments_479503.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon**",
    "created_at": "2020-07-30T21:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479503",
    "user": "https://github.com/egourgoulhon"
}
```

Reviewer: **Eric Gourgoulhon**



---

archive/issue_comments_479504.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...",
    "created_at": "2020-07-30T21:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479504",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:13" align="right">comment:13</div>

Thanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...



---

archive/issue_events_414000.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-07-31T20:45:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414000"
}
```



---

archive/issue_events_414001.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-07-31T20:45:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414001"
}
```



---

archive/issue_comments_479505.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.",
    "created_at": "2020-07-31T20:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479505",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:14" align="right">comment:14</div>

There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.



---

archive/issue_comments_479506.json:
```json
{
    "body": "Dependencies: **#30261**",
    "created_at": "2020-08-01T11:13:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479506",
    "user": "https://github.com/mjungmath"
}
```

Dependencies: **#30261**



---

archive/issue_comments_479507.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b\"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca\"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87\"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2\"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab\"><code>aebaded</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/504e84ed8bef36401ad97dff920ba4874001e666\"><code>504e84e</code></a></td><td><code>Trac #30239: Merge branch 't/30266/immutability_for_scalar_fields' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745\"><code>d58d291</code></a></td><td><code>Trac #30266: hash function condition + treatment of restrictions</code></td></tr></table>\n",
    "created_at": "2020-08-01T14:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479507",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab"><code>aebaded</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/504e84ed8bef36401ad97dff920ba4874001e666"><code>504e84e</code></a></td><td><code>Trac #30239: Merge branch 't/30266/immutability_for_scalar_fields' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745"><code>d58d291</code></a></td><td><code>Trac #30266: hash function condition + treatment of restrictions</code></td></tr></table>




---

archive/issue_comments_479508.json:
```json
{
    "body": "Changed commit from **[`3344505`](https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7)** to **[`d58d291`](https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745)**",
    "created_at": "2020-08-01T14:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479508",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3344505`](https://github.com/sagemath/sagetrac-mirror/commit/3344505b364c014baee19c2f4da41c8a7d2bd2f7)** to **[`d58d291`](https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745)**



---

archive/issue_comments_479509.json:
```json
{
    "body": "Changed commit from **[`d58d291`](https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745)** to **[`061b89f`](https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7)**",
    "created_at": "2020-08-01T14:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479509",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d58d291`](https://github.com/sagemath/sagetrac-mirror/commit/d58d291b8bad3a28aae9be2c426f0aa47370f745)** to **[`061b89f`](https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7)**



---

archive/issue_comments_479510.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7\"><code>061b89f</code></a></td><td><code>Trac #30266: minor doctest improvement</code></td></tr></table>\n",
    "created_at": "2020-08-01T14:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479510",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7"><code>061b89f</code></a></td><td><code>Trac #30266: minor doctest improvement</code></td></tr></table>




---

archive/issue_comments_479511.json:
```json
{
    "body": "Changed commit from **[`061b89f`](https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7)** to **[`0ec99d4`](https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)**",
    "created_at": "2020-08-01T23:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479511",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`061b89f`](https://github.com/sagemath/sagetrac-mirror/commit/061b89fc7ced8730d2cd33a13065189872a78ff7)** to **[`0ec99d4`](https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)**



---

archive/issue_comments_479512.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b\"><code>5c7fd6e</code></a></td><td><code>Trac #30266: immutability of restrictions + hash function improved</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ba0865c69cd0ab466d8fe1aca1983c0006fc42b\"><code>7ba0865</code></a></td><td><code>Trac #30266: merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d\"><code>0ec99d4</code></a></td><td><code>Trac #30266: check by name</code></td></tr></table>\n",
    "created_at": "2020-08-01T23:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479512",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b"><code>5c7fd6e</code></a></td><td><code>Trac #30266: immutability of restrictions + hash function improved</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ba0865c69cd0ab466d8fe1aca1983c0006fc42b"><code>7ba0865</code></a></td><td><code>Trac #30266: merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d"><code>0ec99d4</code></a></td><td><code>Trac #30266: check by name</code></td></tr></table>




---

archive/issue_comments_479513.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87fb4114bbd0e49215328035098fee5716b95b59\"><code>87fb411</code></a></td><td><code>Trac #30266: ValueError replaced by AssertionError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4\"><code>43ec497</code></a></td><td><code>Trac #30239: referenced before assignment error fixed</code></td></tr></table>\n",
    "created_at": "2020-08-01T23:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479513",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87fb4114bbd0e49215328035098fee5716b95b59"><code>87fb411</code></a></td><td><code>Trac #30266: ValueError replaced by AssertionError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4"><code>43ec497</code></a></td><td><code>Trac #30239: referenced before assignment error fixed</code></td></tr></table>




---

archive/issue_comments_479514.json:
```json
{
    "body": "Changed commit from **[`0ec99d4`](https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)** to **[`43ec497`](https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4)**",
    "created_at": "2020-08-01T23:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479514",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0ec99d4`](https://github.com/sagemath/sagetrac-mirror/commit/0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)** to **[`43ec497`](https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4)**



---

archive/issue_events_414002.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T23:22:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414002"
}
```



---

archive/issue_events_414003.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T23:22:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414003"
}
```



---

archive/issue_comments_479515.json:
```json
{
    "body": "Changed dependencies from **#30261** to **#30266**",
    "created_at": "2020-08-01T23:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479515",
    "user": "https://github.com/mjungmath"
}
```

Changed dependencies from **#30261** to **#30266**



---

archive/issue_comments_479516.json:
```json
{
    "body": "Changed commit from **[`43ec497`](https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4)** to **[`a9cb6b3`](https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d)**",
    "created_at": "2020-08-02T09:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479516",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`43ec497`](https://github.com/sagemath/sagetrac-mirror/commit/43ec4976081482b1ce467f0ca83e0c73192039f4)** to **[`a9cb6b3`](https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d)**



---

archive/issue_comments_479517.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d\"><code>a9cb6b3</code></a></td><td><code>Trac #30239: doctest fixed</code></td></tr></table>\n",
    "created_at": "2020-08-02T09:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479517",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d"><code>a9cb6b3</code></a></td><td><code>Trac #30239: doctest fixed</code></td></tr></table>




---

archive/issue_comments_479518.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@egourgoulhon](#comment%3A14):\n> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. \n\nBoth have been fixed. Wait for green bot.",
    "created_at": "2020-08-02T09:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479518",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@egourgoulhon](#comment%3A14):
> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. 

Both have been fixed. Wait for green bot.



---

archive/issue_comments_479519.json:
```json
{
    "body": "Changed commit from **[`a9cb6b3`](https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d)** to **[`731043f`](https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641)**",
    "created_at": "2020-08-02T09:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479519",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a9cb6b3`](https://github.com/sagemath/sagetrac-mirror/commit/a9cb6b3697e6852fb6d4924e273419bded123a9d)** to **[`731043f`](https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641)**



---

archive/issue_comments_479520.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641\"><code>731043f</code></a></td><td><code>Trac #30239: check by name for general tensor field action</code></td></tr></table>\n",
    "created_at": "2020-08-02T09:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479520",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641"><code>731043f</code></a></td><td><code>Trac #30239: check by name for general tensor field action</code></td></tr></table>




---

archive/issue_comments_479521.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nLGTM. Waiting for a positive review of the dependency (#30266).",
    "created_at": "2020-08-03T08:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479521",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:25" align="right">comment:25</div>

LGTM. Waiting for a positive review of the dependency (#30266).



---

archive/issue_comments_479522.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc\"><code>1848091</code></a></td><td><code>Trac #30239: try-finally instead of try-except</code></td></tr></table>\n",
    "created_at": "2020-08-03T22:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479522",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc"><code>1848091</code></a></td><td><code>Trac #30239: try-finally instead of try-except</code></td></tr></table>




---

archive/issue_comments_479523.json:
```json
{
    "body": "Changed commit from **[`731043f`](https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641)** to **[`1848091`](https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc)**",
    "created_at": "2020-08-03T22:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479523",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`731043f`](https://github.com/sagemath/sagetrac-mirror/commit/731043f54230845c930a4fae1e3241ead02ce641)** to **[`1848091`](https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc)**



---

archive/issue_comments_479524.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nWhat about `try...finally` instead of `try...except`? I think this should be even faster, right?",
    "created_at": "2020-08-03T23:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479524",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:27" align="right">comment:27</div>

What about `try...finally` instead of `try...except`? I think this should be even faster, right?



---

archive/issue_comments_479525.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI doubt it. Plus it makes the code a little harder to understand IMO.",
    "created_at": "2020-08-03T23:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479525",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

I doubt it. Plus it makes the code a little harder to understand IMO.



---

archive/issue_comments_479526.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nYou're right, there is no difference. And I agree with you regarding the readability. I'll change it back.",
    "created_at": "2020-08-04T00:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479526",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:29" align="right">comment:29</div>

You're right, there is no difference. And I agree with you regarding the readability. I'll change it back.



---

archive/issue_comments_479527.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a\"><code>4756bc3</code></a></td><td><code>Revert \"Trac #30239: try-finally instead of try-except\"</code></td></tr></table>\n",
    "created_at": "2020-08-04T00:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479527",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a"><code>4756bc3</code></a></td><td><code>Revert "Trac #30239: try-finally instead of try-except"</code></td></tr></table>




---

archive/issue_comments_479528.json:
```json
{
    "body": "Changed commit from **[`1848091`](https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc)** to **[`4756bc3`](https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a)**",
    "created_at": "2020-08-04T00:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479528",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1848091`](https://github.com/sagemath/sagetrac-mirror/commit/18480912b7409ca8a0584eccd7ed2ba44c826adc)** to **[`4756bc3`](https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a)**



---

archive/issue_comments_479529.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThere we go.",
    "created_at": "2020-08-04T00:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479529",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:31" align="right">comment:31</div>

There we go.



---

archive/issue_comments_479530.json:
```json
{
    "body": "Changed commit from **[`4756bc3`](https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a)** to **[`0638207`](https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d)**",
    "created_at": "2020-08-05T12:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479530",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4756bc3`](https://github.com/sagemath/sagetrac-mirror/commit/4756bc31feaec758d7a1fe50d2b5edc28a71202a)** to **[`0638207`](https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d)**



---

archive/issue_comments_479531.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abda8ec2450d2565d0355b15ab968cf78eb36b9a\"><code>abda8ec</code></a></td><td><code>Merge branch 'develop' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d\"><code>0638207</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr></table>\n",
    "created_at": "2020-08-05T12:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479531",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abda8ec2450d2565d0355b15ab968cf78eb36b9a"><code>abda8ec</code></a></td><td><code>Merge branch 'develop' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d"><code>0638207</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr></table>




---

archive/issue_comments_479532.json:
```json
{
    "body": "Changed dependencies from **#30266** to **#30266, #30291**",
    "created_at": "2020-08-05T12:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479532",
    "user": "https://github.com/mjungmath"
}
```

Changed dependencies from **#30266** to **#30266, #30291**



---

archive/issue_comments_479533.json:
```json
{
    "body": "Changed commit from **[`0638207`](https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d)** to **[`5c14b39`](https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)**",
    "created_at": "2020-08-05T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479533",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0638207`](https://github.com/sagemath/sagetrac-mirror/commit/06382070ef75723a2643da5968c86bb5e271806d)** to **[`5c14b39`](https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)**



---

archive/issue_comments_479534.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2446f7ecf68fe4034c8f92f6248cd877b2efe6f3\"><code>2446f7e</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bd82e47382226353261431b505dc3c557e13c47\"><code>4bd82e4</code></a></td><td><code>Trac #30291: patchbot doctest fixed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2ba1e8f7caa423a0af58e1e73af8e424701eb5a\"><code>b2ba1e8</code></a></td><td><code>Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e\"><code>5c14b39</code></a></td><td><code>Trac #30239: doctest adapted</code></td></tr></table>\n",
    "created_at": "2020-08-05T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479534",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2446f7ecf68fe4034c8f92f6248cd877b2efe6f3"><code>2446f7e</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bd82e47382226353261431b505dc3c557e13c47"><code>4bd82e4</code></a></td><td><code>Trac #30291: patchbot doctest fixed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2ba1e8f7caa423a0af58e1e73af8e424701eb5a"><code>b2ba1e8</code></a></td><td><code>Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e"><code>5c14b39</code></a></td><td><code>Trac #30239: doctest adapted</code></td></tr></table>




---

archive/issue_comments_479535.json:
```json
{
    "body": "Changed commit from **[`5c14b39`](https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)** to **[`9f63351`](https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405)**",
    "created_at": "2020-08-05T22:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479535",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5c14b39`](https://github.com/sagemath/sagetrac-mirror/commit/5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)** to **[`9f63351`](https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405)**



---

archive/issue_comments_479536.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2416d871c6980f4503f8fef8b9a088d2dbc0f2d4\"><code>2416d87</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f079381070e497259564eba16d8887c8dc85efe\"><code>4f07938</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3faa75a183dd6e6ff81d8aab176d7783aeaf867e\"><code>3faa75a</code></a></td><td><code>Trac #30266: hash function condition + treatment of restrictions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f812586e8b14181f84ce361c1eba8b8410417b17\"><code>f812586</code></a></td><td><code>Trac #30266: minor doctest improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02726e2524ca81b800ba9a0a5a05e9c399d2e942\"><code>02726e2</code></a></td><td><code>Trac #30266: check by name</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81e67cff20e7869abfe8aa3492b5ec8cbc399f85\"><code>81e67cf</code></a></td><td><code>Trac #30266: ValueError replaced by AssertionError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf4fce56feed7c77064a1d6d9ddf20a28a927a2f\"><code>cf4fce5</code></a></td><td><code>Trac #30239: use try-except block for immutable elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f3b69f6159dbdc127070fce043a3428e09326c0\"><code>4f3b69f</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d8720d24a1a42bee0610f45b6241747fed2d4db\"><code>9d8720d</code></a></td><td><code>Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405\"><code>9f63351</code></a></td><td><code>Trac #30239: doctest outputs adapted</code></td></tr></table>\n",
    "created_at": "2020-08-05T22:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479536",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2416d871c6980f4503f8fef8b9a088d2dbc0f2d4"><code>2416d87</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f079381070e497259564eba16d8887c8dc85efe"><code>4f07938</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3faa75a183dd6e6ff81d8aab176d7783aeaf867e"><code>3faa75a</code></a></td><td><code>Trac #30266: hash function condition + treatment of restrictions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f812586e8b14181f84ce361c1eba8b8410417b17"><code>f812586</code></a></td><td><code>Trac #30266: minor doctest improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02726e2524ca81b800ba9a0a5a05e9c399d2e942"><code>02726e2</code></a></td><td><code>Trac #30266: check by name</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81e67cff20e7869abfe8aa3492b5ec8cbc399f85"><code>81e67cf</code></a></td><td><code>Trac #30266: ValueError replaced by AssertionError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf4fce56feed7c77064a1d6d9ddf20a28a927a2f"><code>cf4fce5</code></a></td><td><code>Trac #30239: use try-except block for immutable elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f3b69f6159dbdc127070fce043a3428e09326c0"><code>4f3b69f</code></a></td><td><code>Trac 30291: simple checks for trivial cases in `_mul_`, `_add_` and _div_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d8720d24a1a42bee0610f45b6241747fed2d4db"><code>9d8720d</code></a></td><td><code>Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f633512058835c3a37c353cbc6a735ac021e405"><code>9f63351</code></a></td><td><code>Trac #30239: doctest outputs adapted</code></td></tr></table>




---

archive/issue_events_414004.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-05T22:52:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414004"
}
```



---

archive/issue_events_414005.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-05T22:52:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414005"
}
```



---

archive/issue_comments_479537.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nChanging the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.\n\nIf I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.\n\nSo, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.\n\nIf we decide for the \"return-copy-behavior\", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.",
    "created_at": "2020-08-05T22:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479537",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:36" align="right">comment:36</div>

Changing the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.

If I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.

So, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.

If we decide for the "return-copy-behavior", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.



---

archive/issue_comments_479538.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nFWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.",
    "created_at": "2020-08-05T23:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479538",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.



---

archive/issue_comments_479539.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@mkoeppe](#comment%3A37):\n> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.\n\nThat's good to know. Thanks. Do you also have an opinion which behavior is more suitable?",
    "created_at": "2020-08-06T07:39:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479539",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@mkoeppe](#comment%3A37):
> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.

That's good to know. Thanks. Do you also have an opinion which behavior is more suitable?



---

archive/issue_comments_479540.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI've opened another ticket #30302 for this discussion.",
    "created_at": "2020-08-06T10:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479540",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:39" align="right">comment:39</div>

I've opened another ticket #30302 for this discussion.



---

archive/issue_events_414006.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414006"
}
```



---

archive/issue_events_414007.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414007"
}
```



---

archive/issue_events_414008.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414008"
}
```



---

archive/issue_events_414009.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414009"
}
```



---

archive/issue_comments_479541.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nMoving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479541",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_479542.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479542",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_414010.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414010"
}
```



---

archive/issue_events_414011.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414011"
}
```



---

archive/issue_comments_479543.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30239#issuecomment-479543",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_414012.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414012"
}
```



---

archive/issue_events_414013.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414013"
}
```



---

archive/issue_events_414014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414014"
}
```



---

archive/issue_events_414015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414015"
}
```



---

archive/issue_events_414016.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414016"
}
```



---

archive/issue_events_414017.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414017"
}
```



---

archive/issue_events_414018.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-29T23:06:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30239",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30239#event-414018"
}
```
