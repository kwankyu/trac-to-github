# Issue 30035: Invariants of Ternary Cubic Forms do not live in the base ring

archive/issues_029798.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nIt seems that invariants of ternary cubic forms (and I assume other kinds of forms, but I didn't try) live in the polynomial ring, not in the base ring. Therefore, I get this, which shouldn't happen:\n\n\n```\nR.<a,b,c> = QQ[]\nRR.<x,y,z> = QQ[]\n\nf = 1994893*a^3 + 4498037*a^2*b + 3358044*a*b^2 + 830875*b^3 + 7859654*a^2*c + 11828845*a*b*c + 4420000*b^2*c + 10319781*a*c^2 + 7775375*b*c^2 + 4515625*c^3\nff = x^3 + 11*x^2*y - 14*x*y^2 + y^3 + 11*x^2*z + 135*x*y*z - 160*y^2*z - 14*x*z^2 + 3*y*z^2 + z^3\n\n\nT = invariant_theory.ternary_cubic(f)\nTT = invariant_theory.ternary_cubic(ff)\n\nT.S_invariant(); TT.S_invariant(); T.S_invariant() == TT.S_invariant();  T.S_invariant() == QQ(TT.S_invariant())\n```\n\nproduces outputs of -705911761/1296, -705911761/1296, False, True.\n\n\nCC:  @mstreng @sagetrac-kohel @sagetrac-florian @JRSijsling @jnoordsij\n\nComponent: **algebra**\n\nKeywords: **invariant theory**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30035_\n\n",
    "closed_at": "2020-08-23T16:28:01Z",
    "created_at": "2020-07-01T01:42:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Invariants of Ternary Cubic Forms do not live in the base ring",
    "type": "issue",
    "updated_at": "2020-08-23T16:28:01Z",
    "url": "https://github.com/sagemath/sage/issues/30035",
    "user": "https://github.com/davidac897"
}
```
<div id="comment:0"></div>

It seems that invariants of ternary cubic forms (and I assume other kinds of forms, but I didn't try) live in the polynomial ring, not in the base ring. Therefore, I get this, which shouldn't happen:


```
R.<a,b,c> = QQ[]
RR.<x,y,z> = QQ[]

f = 1994893*a^3 + 4498037*a^2*b + 3358044*a*b^2 + 830875*b^3 + 7859654*a^2*c + 11828845*a*b*c + 4420000*b^2*c + 10319781*a*c^2 + 7775375*b*c^2 + 4515625*c^3
ff = x^3 + 11*x^2*y - 14*x*y^2 + y^3 + 11*x^2*z + 135*x*y*z - 160*y^2*z - 14*x*z^2 + 3*y*z^2 + z^3


T = invariant_theory.ternary_cubic(f)
TT = invariant_theory.ternary_cubic(ff)

T.S_invariant(); TT.S_invariant(); T.S_invariant() == TT.S_invariant();  T.S_invariant() == QQ(TT.S_invariant())
```

produces outputs of -705911761/1296, -705911761/1296, False, True.


CC:  @mstreng @sagetrac-kohel @sagetrac-florian @JRSijsling @jnoordsij

Component: **algebra**

Keywords: **invariant theory**

Author: **Frédéric Chapoton**

Branch/Commit: **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**

Reviewer: **Sébastien Labbé**

_Issue created by migration from https://trac.sagemath.org/ticket/30035_





---

archive/issue_events_411055.json:
```json
{
    "actor": "https://github.com/davidac897",
    "created_at": "2020-07-01T01:42:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411055"
}
```



---

archive/issue_events_411056.json:
```json
{
    "actor": "https://github.com/davidac897",
    "created_at": "2020-07-01T01:42:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411056"
}
```



---

archive/issue_events_411057.json:
```json
{
    "actor": "https://github.com/davidac897",
    "created_at": "2020-07-01T01:42:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411057"
}
```



---

archive/issue_events_411058.json:
```json
{
    "actor": "https://github.com/davidac897",
    "created_at": "2020-07-01T01:42:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411058"
}
```



---

archive/issue_comments_475417.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe problem comes from `scaled_coeffs`:\n\n```\nsage: [parent(u) for u in T.scaled_coeffs()]\n[Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field]\n```\nand then from `coeffs`\n\n```\nsage: [parent(u) for u in T.coeffs()]\n[Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field]\n```\nwhich calls\n`_extract_coefficients`",
    "created_at": "2020-07-01T08:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475417",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

The problem comes from `scaled_coeffs`:

```
sage: [parent(u) for u in T.scaled_coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```
and then from `coeffs`

```
sage: [parent(u) for u in T.coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```
which calls
`_extract_coefficients`



---

archive/issue_comments_475418.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis seems from deep inside the invariant code. The choice not to separate true variables of the cubic forms and variables for the coefficients seems to be very wrong, and a serious flaw in the design.",
    "created_at": "2020-07-01T09:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475418",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

This seems from deep inside the invariant code. The choice not to separate true variables of the cubic forms and variables for the coefficients seems to be very wrong, and a serious flaw in the design.



---

archive/issue_comments_475419.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77\"><code>cfc52e9</code></a></td><td><code>fix base_ring for some invariants</code></td></tr></table>\n",
    "created_at": "2020-07-01T10:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475419",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77"><code>cfc52e9</code></a></td><td><code>fix base_ring for some invariants</code></td></tr></table>




---

archive/issue_comments_475420.json:
```json
{
    "body": "Branch: **[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)**",
    "created_at": "2020-07-01T10:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475420",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)**



---

archive/issue_comments_475421.json:
```json
{
    "body": "Commit: **[`cfc52e9`](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)**",
    "created_at": "2020-07-01T10:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475421",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`cfc52e9`](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)**



---

archive/issue_comments_475422.json:
```json
{
    "body": "Changed author from **jnoordsij** to **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2020-07-01T10:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475422",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **jnoordsij** to **Frédéric Chapoton**



---

archive/issue_events_411059.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-07-01T10:30:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411059"
}
```



---

archive/issue_comments_475423.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis still needs a doctest.",
    "created_at": "2020-07-01T10:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475423",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

This still needs a doctest.



---

archive/issue_comments_475424.json:
```json
{
    "body": "Changed commit from **[`cfc52e9`](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)** to **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**",
    "created_at": "2020-07-01T12:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475424",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cfc52e9`](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)** to **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**



---

archive/issue_comments_475425.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729\"><code>7c7fc38</code></a></td><td><code>trac 30035 add indirect doctest</code></td></tr></table>\n",
    "created_at": "2020-07-01T12:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475425",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729"><code>7c7fc38</code></a></td><td><code>trac 30035 add indirect doctest</code></td></tr></table>




---

archive/issue_comments_475426.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nnow with doctest",
    "created_at": "2020-07-01T12:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475426",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

now with doctest



---

archive/issue_comments_475427.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\ngreen bot, needs review",
    "created_at": "2020-07-01T19:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475427",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

green bot, needs review



---

archive/issue_comments_475428.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGREEN BOT, **please review** !",
    "created_at": "2020-08-13T11:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475428",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

GREEN BOT, **please review** !



---

archive/issue_comments_475429.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-08-14T12:23:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475429",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_events_411060.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-14T12:23:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411060"
}
```



---

archive/issue_events_411061.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-14T12:23:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411061"
}
```



---

archive/issue_events_411062.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-23T16:28:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411062"
}
```



---

archive/issue_events_411063.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7237719dcdcd9634001276ef3f72dc9b0d8edb7e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-23T16:28:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30035#event-411063"
}
```



---

archive/issue_comments_475430.json:
```json
{
    "body": "Changed branch from **[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)** to **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**",
    "created_at": "2020-08-23T16:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30035#issuecomment-475430",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)** to **[`7c7fc38`](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)**
