# Issue 25858: mpir build failures with some Haswell CPUs

archive/issues_025621.json:
```json
{
    "body": "See https://github.com/wbhart/mpir/pull/252\n\n**Branch/Commit:** [50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)\n\n**Upstream:** Fixed upstream, but not in a stable release.\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/25858\n\n",
    "closed_at": "2018-08-05T08:16:11Z",
    "created_at": "2018-07-13T13:12:43Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "title": "mpir build failures with some Haswell CPUs",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25858",
    "user": "https://github.com/embray"
}
```
See https://github.com/wbhart/mpir/pull/252

**Branch/Commit:** [50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)

**Upstream:** Fixed upstream, but not in a stable release.

**Reviewer:** Travis Scrimshaw

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/25858





---

archive/issue_comments_400058.json:
```json
{
    "body": "**Commit:** [50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)",
    "created_at": "2018-07-13T13:49:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400058",
    "user": "https://github.com/embray"
}
```

**Commit:** [50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)



---

archive/issue_comments_400059.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3\">50c1e0a</a></td><td><code>add a hand-customized version of the patch from the upstream PR which only patches the configure script and the relevant .c sources</code></td></tr></table>\n",
    "created_at": "2018-07-13T13:49:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400059",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3">50c1e0a</a></td><td><code>add a hand-customized version of the patch from the upstream PR which only patches the configure script and the relevant .c sources</code></td></tr></table>




---

archive/issue_comments_400060.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2018-07-13T13:49:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400060",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_comments_400061.json:
```json
{
    "body": "**Branch:** [u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)",
    "created_at": "2018-07-13T13:49:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400061",
    "user": "https://github.com/embray"
}
```

**Branch:** [u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)



---

archive/issue_events_231716.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:49:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231716"
}
```



---

archive/issue_comments_400062.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-07-13T14:40:36Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400062",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_400063.json:
```json
{
    "body": "<a id='comment:2'></a>\nYou can set this to a positive review if upstream accepts the PR.",
    "created_at": "2018-07-13T14:40:36Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400063",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
You can set this to a positive review if upstream accepts the PR.



---

archive/issue_comments_400064.json:
```json
{
    "body": "<a id='comment:3'></a>\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400064",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_231717.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231717"
}
```



---

archive/issue_events_231718.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231718"
}
```



---

archive/issue_comments_400065.json:
```json
{
    "body": "<a id='comment:4'></a>\nGot confirmation from Odile that this patch works.\n\nIf possible I'd like to get this in 8.3 actually, but admittedly adding a patch to MPIR is a big rebuild, and it also affects only a few rare machines and has an easy workaround e.g. building MPIR with `--build=skylake` or some other earlier architecture.",
    "created_at": "2018-07-23T10:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400065",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Got confirmation from Odile that this patch works.

If possible I'd like to get this in 8.3 actually, but admittedly adding a patch to MPIR is a big rebuild, and it also affects only a few rare machines and has an easy workaround e.g. building MPIR with `--build=skylake` or some other earlier architecture.



---

archive/issue_events_231719.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-23T10:08:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231719"
}
```



---

archive/issue_events_231720.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-23T10:08:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231720"
}
```



---

archive/issue_events_231721.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231721"
}
```



---

archive/issue_events_231722.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231722"
}
```



---

archive/issue_events_231723.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231723"
}
```



---

archive/issue_events_231724.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231724"
}
```



---

archive/issue_comments_400066.json:
```json
{
    "body": "<a id='comment:5'></a>\nI am much more split on this ticket (than the one that only affects Cygwin) as it could have more unintended side-effects. I am slightly on the side of waiting until 8.4 and having this go through beta cycles. If we get posts on sage-devel, you have at least seen the error and know the workaround. Plus this will only affect people building it from source on these rare machines, so the chances of someone being afflicted are marginal.",
    "created_at": "2018-07-23T10:59:42Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400066",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I am much more split on this ticket (than the one that only affects Cygwin) as it could have more unintended side-effects. I am slightly on the side of waiting until 8.4 and having this go through beta cycles. If we get posts on sage-devel, you have at least seen the error and know the workaround. Plus this will only affect people building it from source on these rare machines, so the chances of someone being afflicted are marginal.



---

archive/issue_comments_400067.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Developers acknowledge bug.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2018-07-23T13:59:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400067",
    "user": "https://github.com/embray"
}
```

**Changing upstream** from "Reported upstream. Developers acknowledge bug." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_400068.json:
```json
{
    "body": "<a id='comment:6'></a>\nI agree, it's pretty marginal.",
    "created_at": "2018-07-23T13:59:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400068",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I agree, it's pretty marginal.



---

archive/issue_events_231725.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:16:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231725"
}
```



---

archive/issue_events_231726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5add43b99bdc9971ea1191bc8ec05ed9688ae3d3",
    "created_at": "2018-08-05T08:16:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-231726"
}
```



---

archive/issue_comments_400069.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)\" to \"[50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)\".",
    "created_at": "2018-08-05T08:16:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-400069",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)" to "[50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)".
