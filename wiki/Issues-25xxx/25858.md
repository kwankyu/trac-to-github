# Issue 25858: mpir build failures with some Haswell CPUs

archive/issues_025621.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nSee https://github.com/wbhart/mpir/pull/252\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nComponent: **packages: standard**\n\nAuthor: **Erik Bray**\n\nBranch/Commit: **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25858_\n\n",
    "closed_at": "2018-08-05T08:16:11Z",
    "created_at": "2018-07-13T13:12:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "mpir build failures with some Haswell CPUs",
    "type": "issue",
    "updated_at": "2018-08-05T08:16:11Z",
    "url": "https://github.com/sagemath/sage/issues/25858",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

See https://github.com/wbhart/mpir/pull/252

Upstream: **Fixed upstream, but not in a stable release.**

Component: **packages: standard**

Author: **Erik Bray**

Branch/Commit: **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/25858_





---

archive/issue_events_354609.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:12:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354609"
}
```



---

archive/issue_events_354610.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:12:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354610"
}
```



---

archive/issue_events_354611.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:12:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354611"
}
```



---

archive/issue_events_354612.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:12:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354612"
}
```



---

archive/issue_comments_397458.json:
```json
{
    "body": "Commit: **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**",
    "created_at": "2018-07-13T13:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397458",
    "user": "https://github.com/embray"
}
```

Commit: **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**



---

archive/issue_comments_397459.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3\"><code>50c1e0a</code></a></td><td><code>add a hand-customized version of the patch from the upstream PR which only patches the configure script and the relevant .c sources</code></td></tr></table>\n",
    "created_at": "2018-07-13T13:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397459",
    "user": "https://github.com/embray"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3"><code>50c1e0a</code></a></td><td><code>add a hand-customized version of the patch from the upstream PR which only patches the configure script and the relevant .c sources</code></td></tr></table>




---

archive/issue_comments_397460.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2018-07-13T13:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397460",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_397461.json:
```json
{
    "body": "Branch: **[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)**",
    "created_at": "2018-07-13T13:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397461",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)**



---

archive/issue_events_354613.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-13T13:49:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354613"
}
```



---

archive/issue_comments_397462.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-07-13T14:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397462",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_397463.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYou can set this to a positive review if upstream accepts the PR.",
    "created_at": "2018-07-13T14:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397463",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

You can set this to a positive review if upstream accepts the PR.



---

archive/issue_comments_397464.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397464",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_354614.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354614"
}
```



---

archive/issue_events_354615.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354615"
}
```



---

archive/issue_comments_397465.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nGot confirmation from Odile that this patch works.\n\nIf possible I'd like to get this in 8.3 actually, but admittedly adding a patch to MPIR is a big rebuild, and it also affects only a few rare machines and has an easy workaround e.g. building MPIR with `--build=skylake` or some other earlier architecture.",
    "created_at": "2018-07-23T10:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397465",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Got confirmation from Odile that this patch works.

If possible I'd like to get this in 8.3 actually, but admittedly adding a patch to MPIR is a big rebuild, and it also affects only a few rare machines and has an easy workaround e.g. building MPIR with `--build=skylake` or some other earlier architecture.



---

archive/issue_events_354616.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-23T10:08:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354616"
}
```



---

archive/issue_events_354617.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-23T10:08:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354617"
}
```



---

archive/issue_events_354618.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354618"
}
```



---

archive/issue_events_354619.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354619"
}
```



---

archive/issue_events_354620.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354620"
}
```



---

archive/issue_events_354621.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T10:59:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354621"
}
```



---

archive/issue_comments_397466.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI am much more split on this ticket (than the one that only affects Cygwin) as it could have more unintended side-effects. I am slightly on the side of waiting until 8.4 and having this go through beta cycles. If we get posts on sage-devel, you have at least seen the error and know the workaround. Plus this will only affect people building it from source on these rare machines, so the chances of someone being afflicted are marginal.",
    "created_at": "2018-07-23T10:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397466",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I am much more split on this ticket (than the one that only affects Cygwin) as it could have more unintended side-effects. I am slightly on the side of waiting until 8.4 and having this go through beta cycles. If we get posts on sage-devel, you have at least seen the error and know the workaround. Plus this will only affect people building it from source on these rare machines, so the chances of someone being afflicted are marginal.



---

archive/issue_comments_397467.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2018-07-23T13:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397467",
    "user": "https://github.com/embray"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_397468.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI agree, it's pretty marginal.",
    "created_at": "2018-07-23T13:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397468",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I agree, it's pretty marginal.



---

archive/issue_events_354622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:16:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354622"
}
```



---

archive/issue_events_354623.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5add43b99bdc9971ea1191bc8ec05ed9688ae3d3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-05T08:16:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25858#event-354623"
}
```



---

archive/issue_comments_397469.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)** to **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**",
    "created_at": "2018-08-05T08:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25858#issuecomment-397469",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-25858](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-25858)** to **[`50c1e0a`](https://github.com/sagemath/sagetrac-mirror/commit/50c1e0aba2d0f5ca0be0a21cf4bd16d6d8a49bf3)**
