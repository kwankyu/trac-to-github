# Issue 20166: Implement non-recursive iterator for (weighted) integer vectors

archive/issues_019929.json:
```json
{
    "body": "By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 20.8 ms per loop\nsage: I = WeightedIntegerVectors(12, [4,1,2,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 291 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 556 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 56.4 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop, best of 3: 443 ms per loop\n```\nversus the current version:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 50.3 ms per loop\nsage: %timeit list(I.__iter__())\nThe slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 3: 301 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 554 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 68.1 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop , best of 3: 528 ms per loop\n```\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat @fchapoton @videlec\n\n**Branch:** [6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/20166\n\n",
    "closed_at": "2016-04-17T11:27:32Z",
    "created_at": "2016-03-05T14:45:49Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "title": "Implement non-recursive iterator for (weighted) integer vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/20166",
    "user": "https://github.com/tscrim"
}
```
By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 20.8 ms per loop
sage: I = WeightedIntegerVectors(12, [4,1,2,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 291 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 556 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 56.4 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop, best of 3: 443 ms per loop
```
versus the current version:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 50.3 ms per loop
sage: %timeit list(I.__iter__())
The slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 301 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 554 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 68.1 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop , best of 3: 528 ms per loop
```

**Assignee:** sage-combinat

**CC:**  sage-combinat @fchapoton @videlec

**Branch:** [6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)

**Reviewer:** Vincent Delecroix

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/20166





---

archive/issue_comments_292386.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5ed6dc5dac4a5c93465b2fcd179975deddd0583\">f5ed6dc</a></td><td><code>Implemented a non-recursive iterator for integer vectors.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c\">1df837d</a></td><td><code>Implemented a non-recursive iterator for (weighted) integer vectors.</code></td></tr></table>\n",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292386",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5ed6dc5dac4a5c93465b2fcd179975deddd0583">f5ed6dc</a></td><td><code>Implemented a non-recursive iterator for integer vectors.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c">1df837d</a></td><td><code>Implemented a non-recursive iterator for (weighted) integer vectors.</code></td></tr></table>




---

archive/issue_comments_292387.json:
```json
{
    "body": "**Commit:** [1df837d59345c9a06e113657c6fc35ef8561a69c](https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c)",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292387",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [1df837d59345c9a06e113657c6fc35ef8561a69c](https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c)



---

archive/issue_comments_292388.json:
```json
{
    "body": "**Branch:** [public/combinat/integer_vectors_iterator-20166](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/integer_vectors_iterator-20166)",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292388",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/combinat/integer_vectors_iterator-20166](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/integer_vectors_iterator-20166)



---

archive/issue_events_182599.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-05T14:47:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182599"
}
```



---

archive/issue_comments_292389.json:
```json
{
    "body": "**Changing commit** from \"[1df837d59345c9a06e113657c6fc35ef8561a69c](https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c)\" to \"[36222eb9333ea8b7ba3266b5dc26e54511074c37](https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37)\".",
    "created_at": "2016-04-10T08:57:37Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1df837d59345c9a06e113657c6fc35ef8561a69c](https://github.com/sagemath/sagetrac-mirror/commit/1df837d59345c9a06e113657c6fc35ef8561a69c)" to "[36222eb9333ea8b7ba3266b5dc26e54511074c37](https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37)".



---

archive/issue_comments_292390.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f1ec77d5390ac80af4cf43c1038810a6c8f43e2\">3f1ec77</a></td><td><code>Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37\">36222eb</a></td><td><code>If checking mod == 0, then make sure to do the division.</code></td></tr></table>\n",
    "created_at": "2016-04-10T08:57:37Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f1ec77d5390ac80af4cf43c1038810a6c8f43e2">3f1ec77</a></td><td><code>Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37">36222eb</a></td><td><code>If checking mod == 0, then make sure to do the division.</code></td></tr></table>




---

archive/issue_comments_292391.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/087548974f1b52ca22ace93170af8dc48d1890bf\">0875489</a></td><td><code>Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e\">39642ea</a></td><td><code>Make sure for the iterator that k is an int.</code></td></tr></table>\n",
    "created_at": "2016-04-15T16:05:34Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/087548974f1b52ca22ace93170af8dc48d1890bf">0875489</a></td><td><code>Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e">39642ea</a></td><td><code>Make sure for the iterator that k is an int.</code></td></tr></table>




---

archive/issue_comments_292392.json:
```json
{
    "body": "**Changing commit** from \"[36222eb9333ea8b7ba3266b5dc26e54511074c37](https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37)\" to \"[39642ea067ed12f8e0fd28f8da481720d7c5778e](https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e)\".",
    "created_at": "2016-04-15T16:05:34Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[36222eb9333ea8b7ba3266b5dc26e54511074c37](https://github.com/sagemath/sagetrac-mirror/commit/36222eb9333ea8b7ba3266b5dc26e54511074c37)" to "[39642ea067ed12f8e0fd28f8da481720d7c5778e](https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e)".



---

archive/issue_events_182600.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-15T16:06:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182600"
}
```



---

archive/issue_events_182601.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-15T16:06:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182601"
}
```



---

archive/issue_comments_292393.json:
```json
{
    "body": "**Changing commit** from \"[39642ea067ed12f8e0fd28f8da481720d7c5778e](https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e)\" to \"[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)\".",
    "created_at": "2016-04-16T14:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[39642ea067ed12f8e0fd28f8da481720d7c5778e](https://github.com/sagemath/sagetrac-mirror/commit/39642ea067ed12f8e0fd28f8da481720d7c5778e)" to "[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)".



---

archive/issue_comments_292394.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28\">6a4acb5</a></td><td><code>Trac 20166: change order + optimisation</code></td></tr></table>\n",
    "created_at": "2016-04-16T14:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28">6a4acb5</a></td><td><code>Trac 20166: change order + optimisation</code></td></tr></table>




---

archive/issue_comments_292395.json:
```json
{
    "body": "<a id='comment:6'></a>\nUp to twice faster than your version ;-)\n\n- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).\n\n- it is always good to avoid coercion `int / ZZ`.\n\nIt is good to go for me",
    "created_at": "2016-04-16T14:05:48Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292395",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Up to twice faster than your version ;-)

- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).

- it is always good to avoid coercion `int / ZZ`.

It is good to go for me



---

archive/issue_comments_292396.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2016-04-16T14:06:29Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292396",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_events_182602.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-16T18:45:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182602"
}
```



---

archive/issue_events_182603.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-16T18:45:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182603"
}
```



---

archive/issue_comments_292397.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM. Thank you!",
    "created_at": "2016-04-16T18:45:09Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292397",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
LGTM. Thank you!



---

archive/issue_comments_292398.json:
```json
{
    "body": "**Changing branch** from \"[public/combinat/integer_vectors_iterator-20166](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/integer_vectors_iterator-20166)\" to \"[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)\".",
    "created_at": "2016-04-17T11:27:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292398",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/combinat/integer_vectors_iterator-20166](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/integer_vectors_iterator-20166)" to "[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)".



---

archive/issue_events_182604.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-17T11:27:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182604"
}
```



---

archive/issue_events_182605.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e52ce1d78386034096a4df1c6da602803184e4f5",
    "created_at": "2016-04-17T11:27:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20166#event-182605"
}
```



---

archive/issue_comments_292399.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think this causes the problem at #20491.",
    "created_at": "2016-04-23T23:35:34Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292399",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
I think this causes the problem at #20491.



---

archive/issue_comments_292400.json:
```json
{
    "body": "**Changing commit** from \"[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)\" to \"\".",
    "created_at": "2016-04-23T23:35:34Z",
    "issue": "https://github.com/sagemath/sage/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20166#issuecomment-292400",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[6a4acb53d3eb196e2d508b32508d57888884dc28](https://github.com/sagemath/sagetrac-mirror/commit/6a4acb53d3eb196e2d508b32508d57888884dc28)" to "".
