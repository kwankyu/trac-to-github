# Issue 13799: cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin

archive/issues_013595.json:
```json
{
    "body": "As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.\n\nUse spkg at\nhttp://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n\nIt adds back the glpk needed dependencies removed at #13160.\n\n**CC:**  jpflori\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Author:** Jean-Pierre Flori\n\n**Merged:** sage-5.6.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/13799\n\n",
    "closed_at": "2012-12-27T10:24:09Z",
    "created_at": "2012-12-05T13:16:40Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.6",
    "title": "cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13799",
    "user": "https://github.com/kcrisman"
}
```
As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.

Use spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.

**CC:**  jpflori

**Reviewer:** Karl-Dieter Crisman

**Author:** Jean-Pierre Flori

**Merged:** sage-5.6.beta2

Issue created by migration from https://trac.sagemath.org/ticket/13799





---

archive/issue_comments_164901.json:
```json
{
    "body": "<a id='comment:1'></a>\nI guess overlinking was so muchfixed in #13160 it became underlinking.",
    "created_at": "2012-12-05T15:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164901",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>
I guess overlinking was so muchfixed in #13160 it became underlinking.



---

archive/issue_comments_164902.json:
```json
{
    "body": "<a id='comment:2'></a>\nMaybe.  We do \n\n```\n # Set to 1 if you are installing the glpk module.\n-BUILD_GLPK = 0 \n+BUILD_GLPK = 1 \n```\nin setup.py.patch, and got rid of \n\n```\n- if BUILD_GLPK:\n--    glpk = Extension('glpk', libraries = ['glpk'],\n-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n-         include_dirs = [ GLPK_INC_DIR ],\n--        library_dirs = [ GLPK_LIB_DIR ],\n-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n-         sources = ['C/glpk.c'] )\n-     extmods += [glpk];\n- \n```\nbut Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe \n\n```\n\n # Directory containing libglpk (used only when BUILD_GLPK = 1).\n-GLPK_LIB_DIR = '/usr/lib'\n+GLPK_LIB_DIR = SAGE_LIB\n \n # Directory containing glpk.h (used only when BUILD_GLPK = 1).\n-GLPK_INC_DIR = '/usr/include'\n+GLPK_INC_DIR = SAGE_INCLUDE\n```\nis sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).",
    "created_at": "2012-12-05T18:29:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164902",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
Maybe.  We do 

```
 # Set to 1 if you are installing the glpk module.
-BUILD_GLPK = 0 
+BUILD_GLPK = 1 
```
in setup.py.patch, and got rid of 

```
- if BUILD_GLPK:
--    glpk = Extension('glpk', libraries = ['glpk'],
-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
-         include_dirs = [ GLPK_INC_DIR ],
--        library_dirs = [ GLPK_LIB_DIR ],
-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],
-         sources = ['C/glpk.c'] )
-     extmods += [glpk];
- 
```
but Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe 

```

 # Directory containing libglpk (used only when BUILD_GLPK = 1).
-GLPK_LIB_DIR = '/usr/lib'
+GLPK_LIB_DIR = SAGE_LIB
 
 # Directory containing glpk.h (used only when BUILD_GLPK = 1).
-GLPK_INC_DIR = '/usr/include'
+GLPK_INC_DIR = SAGE_INCLUDE
```
is sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).



---

archive/issue_comments_164903.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.\nYour second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).\nI've got a quite working spkg, but will only post it tomorrow, too late for today.",
    "created_at": "2012-12-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164903",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>
The fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.
Your second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).
I've got a quite working spkg, but will only post it tomorrow, too late for today.



---

archive/issue_comments_164904.json:
```json
{
    "body": "<a id='comment:4'></a>\nSorry, the \"second\" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add\n\n```diff\n+ if BUILD_GLPK:\n+-    glpk = Extension('glpk', libraries = ['glpk'],\n++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n+         include_dirs = [ GLPK_INC_DIR ],\n+-        library_dirs = [ GLPK_LIB_DIR ],\n++        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n+         sources = ['C/glpk.c'] )\n+     extmods += [glpk];\n+ \n```\nback in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.",
    "created_at": "2012-12-06T01:38:09Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164904",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
Sorry, the "second" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add

```diff
+ if BUILD_GLPK:
+-    glpk = Extension('glpk', libraries = ['glpk'],
++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
+         include_dirs = [ GLPK_INC_DIR ],
+-        library_dirs = [ GLPK_LIB_DIR ],
++        library_dirs = libdirs + [ GLPK_LIB_DIR ],
+         sources = ['C/glpk.c'] )
+     extmods += [glpk];
+ 
```
back in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.



---

archive/issue_comments_164905.json:
```json
{
    "body": "**Author:** Jean-Pierre Flori",
    "created_at": "2012-12-06T09:58:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164905",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Author:** Jean-Pierre Flori



---

archive/issue_events_119062.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-12-06T09:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119062"
}
```



---

archive/issue_comments_164906.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.\n+\n+Use spkg at\n+http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n+\n+It adds back the glpk needed dependencies removed at #13160.\n``````\n",
    "created_at": "2012-12-06T09:58:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164906",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,6 @@
 As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.
+
+Use spkg at
+http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg
+
+It adds back the glpk needed dependencies removed at #13160.
``````




---

archive/issue_comments_164907.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've uploaded a working spkg at\nhttp://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n\nIt adds back the glpk needed dependencies removed at #13160.",
    "created_at": "2012-12-06T09:58:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164907",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
I've uploaded a working spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.



---

archive/issue_comments_164908.json:
```json
{
    "body": "<a id='comment:6'></a>\nJust FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.\n\nBy the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.",
    "created_at": "2012-12-06T15:47:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164908",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
Just FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.

By the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.



---

archive/issue_events_119063.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-06T15:47:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119063"
}
```



---

archive/issue_events_119064.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-06T15:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119064"
}
```



---

archive/issue_comments_164909.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2012-12-06T15:47:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164909",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_events_119065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-16T15:17:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119065"
}
```



---

archive/issue_events_119066.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-16T15:17:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119066"
}
```



---

archive/issue_comments_164910.json:
```json
{
    "body": "<a id='comment:7'></a>\n`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after\n\n```\n== Changelog ==\n```",
    "created_at": "2012-12-16T15:17:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164910",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after

```
== Changelog ==
```



---

archive/issue_comments_164911.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2012-12-17T09:37:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164911",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg diff, for review only.



---

archive/attachments_019303.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "cvxopt-1.1.5.p0.diff",
    "asset_url": "tarball://root/attachments/ticket13799/cvxopt-1.1.5.p0.diff",
    "created_at": "2012-12-17T09:38:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13799/cvxopt-1.1.5.p0.diff",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```



---

archive/issue_comments_164912.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Attachment:** [cvxopt-1.1.5.p0.diff](https://github.com/sagemath/sage/files/ticket13799/cvxopt-1.1.5.p0.diff)\n\nThe newly uploaded spkg should be fine.",
    "created_at": "2012-12-17T09:38:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164912",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
**Attachment:** [cvxopt-1.1.5.p0.diff](https://github.com/sagemath/sage/files/ticket13799/cvxopt-1.1.5.p0.diff)

The newly uploaded spkg should be fine.



---

archive/issue_events_119067.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-12-17T09:52:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119067"
}
```



---

archive/issue_events_119068.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-12-17T09:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119068"
}
```



---

archive/issue_events_119069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-17T10:00:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119069"
}
```



---

archive/issue_events_119070.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-17T10:00:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119070"
}
```



---

archive/issue_comments_164913.json:
```json
{
    "body": "**Merged:** sage-5.6.beta2",
    "created_at": "2012-12-27T10:24:09Z",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-164913",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.6.beta2



---

archive/issue_events_119071.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:24:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119071"
}
```



---

archive/issue_events_119072.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:24:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-119072"
}
```
