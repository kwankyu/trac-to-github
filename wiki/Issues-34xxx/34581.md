# Issue 34581: Implement substitution in InfinitePolynomialRing

archive/issues_034344.json:
```json
{
    "body": "Add the ability to substitute variables in `InfinitePolynomialRing`.\n\n```\nsage: R.<z> = InfinitePolynomialRing(QQ)\nsage: f = z[1] + z[1]*z[2]*z[3]\nsage: f.subs({z[1]:z[0]})\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nInput In [3], in <cell line: 1>()\n----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})\n\nFile ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()\n    828 if str(gen) in kwds:\n    829     variables.append(kwds[str(gen)])\n--> 830 elif in_dict and gen in in_dict:\n    831     variables.append(in_dict[gen])\n    832 else:\n\nTypeError: unhashable type: 'InfinitePolynomialGen'\n```\n\n**CC:**  @tscrim @mwhansen @simon-king-jena\n\n**Keywords:** polynomial infinite substitution subs\n\n**Branch:** [u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)\n\n**Commit:** [0082d0327f68c2f0c6987d85d106b6f75a16982a](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)\n\n**Author:** Trevor K. Karn\n\nIssue created by migration from https://trac.sagemath.org/ticket/34581\n\n",
    "created_at": "2022-09-24T15:32:40Z",
    "labels": [
        "component: algebra",
        "enhancement",
        "needs review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Implement substitution in InfinitePolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/34581",
    "user": "https://github.com/trevorkarn"
}
```
Add the ability to substitute variables in `InfinitePolynomialRing`.

```
sage: R.<z> = InfinitePolynomialRing(QQ)
sage: f = z[1] + z[1]*z[2]*z[3]
sage: f.subs({z[1]:z[0]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})

File ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()
    828 if str(gen) in kwds:
    829     variables.append(kwds[str(gen)])
--> 830 elif in_dict and gen in in_dict:
    831     variables.append(in_dict[gen])
    832 else:

TypeError: unhashable type: 'InfinitePolynomialGen'
```

**CC:**  @tscrim @mwhansen @simon-king-jena

**Keywords:** polynomial infinite substitution subs

**Branch:** [u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)

**Commit:** [0082d0327f68c2f0c6987d85d106b6f75a16982a](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)

**Author:** Trevor K. Karn

Issue created by migration from https://trac.sagemath.org/ticket/34581





---

archive/issue_comments_561214.json:
```json
{
    "body": "**Commit:** [2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)",
    "created_at": "2022-09-24T17:06:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561214",
    "user": "https://github.com/trevorkarn"
}
```

**Commit:** [2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)



---

archive/issue_comments_561215.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8\">2ec0f39</a></td><td><code>Add subs method</code></td></tr></table>\n",
    "created_at": "2022-09-24T17:06:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561215",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8">2ec0f39</a></td><td><code>Add subs method</code></td></tr></table>




---

archive/issue_comments_561216.json:
```json
{
    "body": "**Branch:** [u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)",
    "created_at": "2022-09-24T17:06:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561216",
    "user": "https://github.com/trevorkarn"
}
```

**Branch:** [u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)



---

archive/issue_events_309212.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T17:06:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-309212"
}
```



---

archive/issue_comments_561217.json:
```json
{
    "body": "<a id='comment:2'></a>\nThere are some bad behaviors that this implements:\n\n- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.\n- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.\n\nThe \"standard\" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.\n\n```\nsage: f(x_10=f)\nKeyError\nsage: f(x_2=f)\nx_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1\nsage: x[12]  # make it big enough\nx_12\nsage: f(x_10=f)\nx_3*x_2*x_1 + x_1\n```\nProbably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.",
    "created_at": "2022-09-25T00:34:05Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561217",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
There are some bad behaviors that this implements:

- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.
- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.

The "standard" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.

```
sage: f(x_10=f)
KeyError
sage: f(x_2=f)
x_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1
sage: x[12]  # make it big enough
x_12
sage: f(x_10=f)
x_3*x_2*x_1 + x_1
```
Probably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.



---

archive/issue_events_309213.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-25T00:34:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-309213"
}
```



---

archive/issue_events_309214.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-25T00:34:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-309214"
}
```



---

archive/issue_comments_561218.json:
```json
{
    "body": "<a id='comment:3'></a>\nbeware of #34542",
    "created_at": "2022-09-25T07:00:06Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561218",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
beware of #34542



---

archive/issue_comments_561219.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!",
    "created_at": "2022-10-02T16:44:53Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561219",
    "user": "https://github.com/mathzeta"
}
```

<a id='comment:4'></a>
This might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!



---

archive/issue_comments_561220.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74911139ceef9b690bd0c1369acc523a5802248f\">7491113</a></td><td><code>Add subs method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162\">623021f</a></td><td><code>Punt to call and add doctests</code></td></tr></table>\n",
    "created_at": "2022-12-30T01:18:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74911139ceef9b690bd0c1369acc523a5802248f">7491113</a></td><td><code>Add subs method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162">623021f</a></td><td><code>Punt to call and add doctests</code></td></tr></table>




---

archive/issue_comments_561221.json:
```json
{
    "body": "**Changing commit** from \"[2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)\" to \"[623021f3c1fedd3040046b704ab9edccec3b0162](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)\".",
    "created_at": "2022-12-30T01:18:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)" to "[623021f3c1fedd3040046b704ab9edccec3b0162](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)".



---

archive/issue_comments_561222.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt looks like `__call__` took care of everything, so the `.subs()` method now does all of the preparsing and passes to `__call__`. I don't like the variable name `fixed`, but it is consistent with `MPolynomial_libsingular.subs()`.",
    "created_at": "2022-12-30T01:22:34Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561222",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:6'></a>
It looks like `__call__` took care of everything, so the `.subs()` method now does all of the preparsing and passes to `__call__`. I don't like the variable name `fixed`, but it is consistent with `MPolynomial_libsingular.subs()`.



---

archive/issue_comments_561223.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a\">0082d03</a></td><td><code>PEP8 compliance</code></td></tr></table>\n",
    "created_at": "2022-12-30T01:24:27Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a">0082d03</a></td><td><code>PEP8 compliance</code></td></tr></table>




---

archive/issue_comments_561224.json:
```json
{
    "body": "**Changing commit** from \"[623021f3c1fedd3040046b704ab9edccec3b0162](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)\" to \"[0082d0327f68c2f0c6987d85d106b6f75a16982a](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)\".",
    "created_at": "2022-12-30T01:24:27Z",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-561224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[623021f3c1fedd3040046b704ab9edccec3b0162](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)" to "[0082d0327f68c2f0c6987d85d106b6f75a16982a](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)".



---

archive/issue_events_309215.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-12-30T01:25:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-309215"
}
```



---

archive/issue_events_309216.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-12-30T01:25:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-309216"
}
```
