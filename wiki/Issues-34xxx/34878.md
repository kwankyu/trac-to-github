# Issue 34878: MixedIntegerLinearProgram.add_constraint: Option to return row indices, fix handling of empty constraints

archive/issues_034641.json:
```json
{
    "body": "(from [#21003 comment:136](https://github.com/sagemath/sage/issues/21003#comment:136))\n\n... for use with methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.\n\nIf a backend does not map a constraint to a unique new row (or `check_redundant=True` and the constraint is discarded by the frontend), the method may return `None`.\n\nWe also fix a longstanding bug in how empty constraints are handled in `add_constraint`. \n\nThe changed interface (an optional return value) is backward-compatible with user code.\n\nWe also add a Feature CVXOPT so that the backend gets tested again.\n\n**CC:**  @mantepse @dimpase\n\n**Branch:** [u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index)\n\n**Commit:** [3b929f89b56dd1347df6a125460262cfaae62eca](https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca)\n\n**Reviewer:** Martin Rubey, Matthias Koeppe\n\n**Author:** Matthias Koeppe, Martin Rubey\n\nIssue created by migration from https://trac.sagemath.org/ticket/34878\n\n",
    "created_at": "2022-12-23T22:44:06Z",
    "labels": [
        "component: linear programming",
        "enhancement",
        "positive review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "MixedIntegerLinearProgram.add_constraint: Option to return row indices, fix handling of empty constraints",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/34878",
    "user": "https://github.com/mkoeppe"
}
```
(from [#21003 comment:136](https://github.com/sagemath/sage/issues/21003#comment:136))

... for use with methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.

If a backend does not map a constraint to a unique new row (or `check_redundant=True` and the constraint is discarded by the frontend), the method may return `None`.

We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. 

The changed interface (an optional return value) is backward-compatible with user code.

We also add a Feature CVXOPT so that the backend gets tested again.

**CC:**  @mantepse @dimpase

**Branch:** [u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index)

**Commit:** [3b929f89b56dd1347df6a125460262cfaae62eca](https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca)

**Reviewer:** Martin Rubey, Matthias Koeppe

**Author:** Matthias Koeppe, Martin Rubey

Issue created by migration from https://trac.sagemath.org/ticket/34878





---

archive/issue_comments_564371.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index)",
    "created_at": "2022-12-27T06:03:43Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564371",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index)



---

archive/issue_comments_564372.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2022-12-27T06:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564372",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_564373.json:
```json
{
    "body": "**Commit:** [7ad324ffec72c9310e8bf51df84438512c7f895e](https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e)",
    "created_at": "2022-12-27T06:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564373",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [7ad324ffec72c9310e8bf51df84438512c7f895e](https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e)



---

archive/issue_comments_564374.json:
```json
{
    "body": "<a id='comment:2'></a>\nDoctests need adjusting because of the extra output\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e\">7ad324f</a></td><td><code>MixedIntegerLinearProgram.add_constraint: Return row index</code></td></tr></table>\n",
    "created_at": "2022-12-27T06:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564374",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Doctests need adjusting because of the extra output

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e">7ad324f</a></td><td><code>MixedIntegerLinearProgram.add_constraint: Return row index</code></td></tr></table>




---

archive/issue_comments_564375.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825\">9daa44c</a></td><td><code>src/sage/numerical/mip.pyx: Update doctests for .add_constraint returning the row index</code></td></tr></table>\n",
    "created_at": "2022-12-28T00:45:09Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825">9daa44c</a></td><td><code>src/sage/numerical/mip.pyx: Update doctests for .add_constraint returning the row index</code></td></tr></table>




---

archive/issue_comments_564376.json:
```json
{
    "body": "**Changing commit** from \"[7ad324ffec72c9310e8bf51df84438512c7f895e](https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e)\" to \"[9daa44cbebde11538ce6da624887fa74c14e7825](https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825)\".",
    "created_at": "2022-12-28T00:45:09Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7ad324ffec72c9310e8bf51df84438512c7f895e](https://github.com/sagemath/sagetrac-mirror/commit/7ad324ffec72c9310e8bf51df84438512c7f895e)" to "[9daa44cbebde11538ce6da624887fa74c14e7825](https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825)".



---

archive/issue_comments_564377.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc01716f6774bd433b30babd322a9f0db521b7e0\">bc01716</a></td><td><code>MixedIntegerLinearProgram.add_constraint: Do not refuse to add empty constraints; they could be infeasible or we may need their row index for later</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66\">e154d29</a></td><td><code>src/sage/numerical/backends: Update doctests</code></td></tr></table>\n",
    "created_at": "2022-12-28T01:34:36Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc01716f6774bd433b30babd322a9f0db521b7e0">bc01716</a></td><td><code>MixedIntegerLinearProgram.add_constraint: Do not refuse to add empty constraints; they could be infeasible or we may need their row index for later</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66">e154d29</a></td><td><code>src/sage/numerical/backends: Update doctests</code></td></tr></table>




---

archive/issue_comments_564378.json:
```json
{
    "body": "**Changing commit** from \"[9daa44cbebde11538ce6da624887fa74c14e7825](https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825)\" to \"[e154d2999bef790a92b69524e967cd5feb8d4b66](https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66)\".",
    "created_at": "2022-12-28T01:34:36Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9daa44cbebde11538ce6da624887fa74c14e7825](https://github.com/sagemath/sagetrac-mirror/commit/9daa44cbebde11538ce6da624887fa74c14e7825)" to "[e154d2999bef790a92b69524e967cd5feb8d4b66](https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66)".



---

archive/issue_comments_564379.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/166b1d3a0d4471a866281bac0a6fa5b56f0f4c4b\">166b1d3</a></td><td><code>src/sage/numerical/backends/cvxopt_backend.pyx: Update doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa\">8adca04</a></td><td><code>src/sage/features/mip_backends.py: Add CVXOPT feature</code></td></tr></table>\n",
    "created_at": "2022-12-28T02:15:33Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/166b1d3a0d4471a866281bac0a6fa5b56f0f4c4b">166b1d3</a></td><td><code>src/sage/numerical/backends/cvxopt_backend.pyx: Update doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa">8adca04</a></td><td><code>src/sage/features/mip_backends.py: Add CVXOPT feature</code></td></tr></table>




---

archive/issue_comments_564380.json:
```json
{
    "body": "**Changing commit** from \"[e154d2999bef790a92b69524e967cd5feb8d4b66](https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66)\" to \"[8adca04fcff46fbbd3bfe357e8d1955081b671aa](https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa)\".",
    "created_at": "2022-12-28T02:15:33Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564380",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e154d2999bef790a92b69524e967cd5feb8d4b66](https://github.com/sagemath/sagetrac-mirror/commit/e154d2999bef790a92b69524e967cd5feb8d4b66)" to "[8adca04fcff46fbbd3bfe357e8d1955081b671aa](https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa)".



---

archive/issue_events_310508.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T02:24:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310508"
}
```



---

archive/issue_comments_564381.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,7 @@\n \n If a backend does not map a constraint to a unique new row (or `check_redundant=True` and the constraint is discarded by the frontend), the method may return `None`.\n \n+We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. \n+\n+The changed interface (a return value) is backward-compatible with user code, but lots of doctests need to be changed. To make sure that also CVXOPT backend is tested when cvxopt is installed, we add it as a Feature.\n+\n``````\n",
    "created_at": "2022-12-28T02:24:26Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564381",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,7 @@
 
 If a backend does not map a constraint to a unique new row (or `check_redundant=True` and the constraint is discarded by the frontend), the method may return `None`.
 
+We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. 
+
+The changed interface (a return value) is backward-compatible with user code, but lots of doctests need to be changed. To make sure that also CVXOPT backend is tested when cvxopt is installed, we add it as a Feature.
+
``````




---

archive/issue_events_310509.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T02:24:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310509"
}
```



---

archive/issue_events_310510.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T02:24:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "rename": {
        "from": "MixedIntegerLinearProgram.add_constraint: Return row index",
        "to": "MixedIntegerLinearProgram.add_constraint: Return row index, fix handing of empty constraints"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310510"
}
```



---

archive/issue_events_310511.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T02:24:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "rename": {
        "from": "MixedIntegerLinearProgram.add_constraint: Return row index, fix handing of empty constraints",
        "to": "MixedIntegerLinearProgram.add_constraint: Return row index, fix handling of empty constraints"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310511"
}
```



---

archive/issue_comments_564382.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm sorry to comment late.  I have two (quite orthogonal) suggestions:\n\n* I think that `add_constraint` should return a list of constraints added, or `None`.\n    * `None` should be returned if and only if the backend does not provide a means to remove this constraint again.  \n    * The empty list should be returned if and only if the constraint was redundant.\n    * Otherwise, removing the constraints using `remove_constraint` yields the original MILP.\n* possibly, it would make sense to return this list only on demand, eg., have a flag `return_indices`.  I am guessing that this would be better for interactive use, and it also means that only very few doctests would have to be modified.",
    "created_at": "2022-12-28T06:50:44Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564382",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:8'></a>
I'm sorry to comment late.  I have two (quite orthogonal) suggestions:

* I think that `add_constraint` should return a list of constraints added, or `None`.
    * `None` should be returned if and only if the backend does not provide a means to remove this constraint again.  
    * The empty list should be returned if and only if the constraint was redundant.
    * Otherwise, removing the constraints using `remove_constraint` yields the original MILP.
* possibly, it would make sense to return this list only on demand, eg., have a flag `return_indices`.  I am guessing that this would be better for interactive use, and it also means that only very few doctests would have to be modified.



---

archive/issue_comments_564383.json:
```json
{
    "body": "<a id='comment:9'></a>\nThat would be fine with me. Do you want to push a branch that does this?",
    "created_at": "2022-12-28T07:22:58Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564383",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
That would be fine with me. Do you want to push a branch that does this?



---

archive/issue_comments_564384.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes, I can do this.",
    "created_at": "2022-12-28T07:36:14Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564384",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:10'></a>
Yes, I can do this.



---

archive/issue_comments_564385.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index)\" to \"[u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index)\".",
    "created_at": "2022-12-28T09:50:00Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564385",
    "user": "https://github.com/mantepse"
}
```

**Changing branch** from "[u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/mixedintegerlinearprogram_add_constraint__return_row_index)" to "[u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index)".



---

archive/issue_comments_564386.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31\">cfe24fe</a></td><td><code>add a doctest for adding and removing constraints</code></td></tr></table>\n",
    "created_at": "2022-12-28T10:08:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31">cfe24fe</a></td><td><code>add a doctest for adding and removing constraints</code></td></tr></table>




---

archive/issue_comments_564387.json:
```json
{
    "body": "**Changing commit** from \"[8adca04fcff46fbbd3bfe357e8d1955081b671aa](https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa)\" to \"[cfe24fe41656e678df6014c11eed35e4cdf6da31](https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31)\".",
    "created_at": "2022-12-28T10:08:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8adca04fcff46fbbd3bfe357e8d1955081b671aa](https://github.com/sagemath/sagetrac-mirror/commit/8adca04fcff46fbbd3bfe357e8d1955081b671aa)" to "[cfe24fe41656e678df6014c11eed35e4cdf6da31](https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31)".



---

archive/issue_comments_564388.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7\">6c34bc3</a></td><td><code>make linter happy</code></td></tr></table>\n",
    "created_at": "2022-12-28T10:12:50Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7">6c34bc3</a></td><td><code>make linter happy</code></td></tr></table>




---

archive/issue_comments_564389.json:
```json
{
    "body": "**Changing commit** from \"[cfe24fe41656e678df6014c11eed35e4cdf6da31](https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31)\" to \"[6c34bc3273b821304b9d8403bf936a5f9add88a7](https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7)\".",
    "created_at": "2022-12-28T10:12:50Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cfe24fe41656e678df6014c11eed35e4cdf6da31](https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31)" to "[6c34bc3273b821304b9d8403bf936a5f9add88a7](https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7)".



---

archive/issue_comments_564390.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca\">3b929f8</a></td><td><code>forgot newline in docstring</code></td></tr></table>\n",
    "created_at": "2022-12-28T10:14:26Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca">3b929f8</a></td><td><code>forgot newline in docstring</code></td></tr></table>




---

archive/issue_comments_564391.json:
```json
{
    "body": "**Changing commit** from \"[6c34bc3273b821304b9d8403bf936a5f9add88a7](https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7)\" to \"[3b929f89b56dd1347df6a125460262cfaae62eca](https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca)\".",
    "created_at": "2022-12-28T10:14:26Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6c34bc3273b821304b9d8403bf936a5f9add88a7](https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7)" to "[3b929f89b56dd1347df6a125460262cfaae62eca](https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca)".



---

archive/issue_comments_564392.json:
```json
{
    "body": "<a id='comment:15'></a>\nPlease review!\n\nIn particular, whether\n\n```\n        The row indices of the constraints added, if\n        ``return_indices`` is true and the backend guarantees that\n        removing them again yields the original MIP, ``None``\n        otherwise.\n```\nis correct, i.e., there are currently no backends that do anything bad.",
    "created_at": "2022-12-28T10:16:08Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564392",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>
Please review!

In particular, whether

```
        The row indices of the constraints added, if
        ``return_indices`` is true and the backend guarantees that
        removing them again yields the original MIP, ``None``
        otherwise.
```
is correct, i.e., there are currently no backends that do anything bad.



---

archive/issue_comments_564393.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, Martin Rubey\".",
    "created_at": "2022-12-28T10:58:35Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564393",
    "user": "https://github.com/mantepse"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, Martin Rubey".



---

archive/issue_comments_564394.json:
```json
{
    "body": "**Reviewer:** Martin Rubey, Matthias Koeppe",
    "created_at": "2022-12-28T10:58:35Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564394",
    "user": "https://github.com/mantepse"
}
```

**Reviewer:** Martin Rubey, Matthias Koeppe



---

archive/issue_comments_564395.json:
```json
{
    "body": "<a id='comment:17'></a>\nLGTM, thanks!",
    "created_at": "2022-12-28T18:27:35Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
LGTM, thanks!



---

archive/issue_events_310512.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T18:27:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310512"
}
```



---

archive/issue_events_310513.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T18:27:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310513"
}
```



---

archive/issue_comments_564396.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n \n We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. \n \n-The changed interface (a return value) is backward-compatible with user code, but lots of doctests need to be changed. To make sure that also CVXOPT backend is tested when cvxopt is installed, we add it as a Feature.\n+The changed interface (a return value) is backward-compatible with user code.\n \n``````\n",
    "created_at": "2022-12-28T18:28:58Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564396",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 
 We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. 
 
-The changed interface (a return value) is backward-compatible with user code, but lots of doctests need to be changed. To make sure that also CVXOPT backend is tested when cvxopt is installed, we add it as a Feature.
+The changed interface (a return value) is backward-compatible with user code.
 
``````




---

archive/issue_events_310514.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-28T18:28:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "rename": {
        "from": "MixedIntegerLinearProgram.add_constraint: Return row index, fix handling of empty constraints",
        "to": "MixedIntegerLinearProgram.add_constraint: Option to return row indices, fix handling of empty constraints"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34878#event-310514"
}
```



---

archive/issue_comments_564397.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,5 +6,6 @@\n \n We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. \n \n-The changed interface (a return value) is backward-compatible with user code.\n+The changed interface (an optional return value) is backward-compatible with user code.\n \n+We also add a Feature CVXOPT so that the backend gets tested again.\n``````\n",
    "created_at": "2022-12-28T18:31:04Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564397",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,5 +6,6 @@
 
 We also fix a longstanding bug in how empty constraints are handled in `add_constraint`. 
 
-The changed interface (a return value) is backward-compatible with user code.
+The changed interface (an optional return value) is backward-compatible with user code.
 
+We also add a Feature CVXOPT so that the backend gets tested again.
``````




---

archive/issue_comments_564398.json:
```json
{
    "body": "<a id='comment:20'></a>\nThank you!\n\nActually, it would be practical if the following too would also work, don't you think  (Ideally also with `False`, or `True` as argument)?\n\nIf you agree, it won't be hard to fix.  I don't know whether one can add these as constraints to all backends, but we could simply ignore the first and raise a `MIPSolverException` for the second.\n\nThis would make (my) user code much more readable.\n\n```\nsage: p = MixedIntegerLinearProgram(solver='GLPK')\nsage: p.add_constraint(p.linear_functions_parent()(0 <= 0))\nValueError                                Traceback (most recent call last)\n...\nValueError: at least one of \"max\" or \"min\" must be set\n\nsage: p.add_constraint(p.linear_functions_parent()(1 <= 0))\nValueError                                Traceback (most recent call last)\n...\nValueError: at least one of \"max\" or \"min\" must be set\n```",
    "created_at": "2022-12-28T19:12:16Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564398",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:20'></a>
Thank you!

Actually, it would be practical if the following too would also work, don't you think  (Ideally also with `False`, or `True` as argument)?

If you agree, it won't be hard to fix.  I don't know whether one can add these as constraints to all backends, but we could simply ignore the first and raise a `MIPSolverException` for the second.

This would make (my) user code much more readable.

```
sage: p = MixedIntegerLinearProgram(solver='GLPK')
sage: p.add_constraint(p.linear_functions_parent()(0 <= 0))
ValueError                                Traceback (most recent call last)
...
ValueError: at least one of "max" or "min" must be set

sage: p.add_constraint(p.linear_functions_parent()(1 <= 0))
ValueError                                Traceback (most recent call last)
...
ValueError: at least one of "max" or "min" must be set
```



---

archive/issue_comments_564399.json:
```json
{
    "body": "<a id='comment:21'></a>\nYou probably mean `linear_constraints_parent` here",
    "created_at": "2022-12-28T19:14:20Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564399",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
You probably mean `linear_constraints_parent` here



---

archive/issue_comments_564400.json:
```json
{
    "body": "<a id='comment:22'></a>\nIt would be OK with me for\n- p.add_constraint(True) to add the trivial constraint \"0 <= 0\"\n- p.add_constraint(False) to add the infeasible constraint \"0 <= -1\"",
    "created_at": "2022-12-28T19:16:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564400",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
It would be OK with me for
- p.add_constraint(True) to add the trivial constraint "0 <= 0"
- p.add_constraint(False) to add the infeasible constraint "0 <= -1"



---

archive/issue_comments_564401.json:
```json
{
    "body": "<a id='comment:23'></a>\nOh, thanks, yes, you are right.  Here we currently have\n\n```\nsage: p.add_constraint(p.linear_constraints_parent()(1 <= 0))\nsage: p\nMixed Integer Program (no objective, 0 variables, 0 constraints)\nsage: p.show()\nMaximization:\n  \n\nConstraints:\nVariables:\nsage: p.linear_constraints_parent()(1 <= 0)\ntrivial constraint starting with 0\nsage: p.linear_constraints_parent()(0 <= 0)\ntrivial constraint starting with 1\n```",
    "created_at": "2022-12-28T19:29:18Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564401",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:23'></a>
Oh, thanks, yes, you are right.  Here we currently have

```
sage: p.add_constraint(p.linear_constraints_parent()(1 <= 0))
sage: p
Mixed Integer Program (no objective, 0 variables, 0 constraints)
sage: p.show()
Maximization:
  

Constraints:
Variables:
sage: p.linear_constraints_parent()(1 <= 0)
trivial constraint starting with 0
sage: p.linear_constraints_parent()(0 <= 0)
trivial constraint starting with 1
```



---

archive/issue_comments_564402.json:
```json
{
    "body": "<a id='comment:24'></a>\n\"trivial constraint starting with\" is, of course, ridiculous wording. We should revise this.",
    "created_at": "2022-12-28T19:44:50Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564402",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
"trivial constraint starting with" is, of course, ridiculous wording. We should revise this.



---

archive/issue_comments_564403.json:
```json
{
    "body": "<a id='comment:25'></a>\nI am away for a few hours now :-)",
    "created_at": "2022-12-28T19:52:28Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564403",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:25'></a>
I am away for a few hours now :-)



---

archive/issue_comments_564404.json:
```json
{
    "body": "<a id='comment:26'></a>\nI've opened #34882 for this.",
    "created_at": "2022-12-28T20:05:01Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564404",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
I've opened #34882 for this.



---

archive/issue_comments_564405.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks! However, I think the other two are bugs and should be fixed here.",
    "created_at": "2022-12-28T22:59:41Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564405",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:27'></a>
Thanks! However, I think the other two are bugs and should be fixed here.



---

archive/issue_comments_564406.json:
```json
{
    "body": "<a id='comment:28'></a>\nWhich two?",
    "created_at": "2022-12-28T23:06:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564406",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Which two?



---

archive/issue_comments_564407.json:
```json
{
    "body": "<a id='comment:29'></a>\nNote that there's the coercion route bool -> int -> ZZ",
    "created_at": "2022-12-28T23:09:38Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564407",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Note that there's the coercion route bool -> int -> ZZ



---

archive/issue_comments_564408.json:
```json
{
    "body": "<a id='comment:30'></a>\n\n```\nsage: p = MixedIntegerLinearProgram(solver='GLPK')\nsage: p.add_constraint(p.linear_constraints_parent()(1 <= 0))\nsage: p.solve()\n0.0\n```\nbecause it is actually not adding a constraint.",
    "created_at": "2022-12-28T23:19:19Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564408",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:30'></a>

```
sage: p = MixedIntegerLinearProgram(solver='GLPK')
sage: p.add_constraint(p.linear_constraints_parent()(1 <= 0))
sage: p.solve()
0.0
```
because it is actually not adding a constraint.



---

archive/issue_comments_564409.json:
```json
{
    "body": "<a id='comment:31'></a>\nthat's bool -> int -> ZZ -> linear_function_parent -> linear_constraints_parent, not a bug",
    "created_at": "2022-12-28T23:30:00Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564409",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
that's bool -> int -> ZZ -> linear_function_parent -> linear_constraints_parent, not a bug



---

archive/issue_comments_564410.json:
```json
{
    "body": "<a id='comment:32'></a>\n-> #34882",
    "created_at": "2022-12-28T23:30:45Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564410",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
-> #34882



---

archive/issue_comments_564411.json:
```json
{
    "body": "<a id='comment:33'></a>\nThe problem is that for `f = p.linear_constraints_parent()(1 <= 0)` we have neither have `f.equations()` nor `f.inequalities()`.\n\nThe following does work (also for GLPK):\n\n```\nsage: p = MixedIntegerLinearProgram(solver='SCIP')\nsage: f = p.linear_functions_parent()(1 - 0)\nsage: p.add_constraint(f, max=0, return_indices=True)\n[0]\nsage: p.show()\nMaximization:\n  \n\nConstraints:\n  c1: <= -1.0\nVariables:\n```\nI am not sure how reliable this is.  Also, shouldn't the max be shown?",
    "created_at": "2022-12-28T23:32:00Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564411",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:33'></a>
The problem is that for `f = p.linear_constraints_parent()(1 <= 0)` we have neither have `f.equations()` nor `f.inequalities()`.

The following does work (also for GLPK):

```
sage: p = MixedIntegerLinearProgram(solver='SCIP')
sage: f = p.linear_functions_parent()(1 - 0)
sage: p.add_constraint(f, max=0, return_indices=True)
[0]
sage: p.show()
Maximization:
  

Constraints:
  c1: <= -1.0
Variables:
```
I am not sure how reliable this is.  Also, shouldn't the max be shown?



---

archive/issue_comments_564412.json:
```json
{
    "body": "<a id='comment:34'></a>\nAh, sorry, now I see.  Sorry.",
    "created_at": "2022-12-28T23:33:16Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564412",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:34'></a>
Ah, sorry, now I see.  Sorry.



---

archive/issue_comments_564413.json:
```json
{
    "body": "<a id='comment:35'></a>\nI agree that changing the display of the empty linear form in \" <= -1.0\" to 0 would be an improvement",
    "created_at": "2022-12-28T23:35:19Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564413",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
I agree that changing the display of the empty linear form in " <= -1.0" to 0 would be an improvement



---

archive/issue_comments_564414.json:
```json
{
    "body": "<a id='comment:36'></a>\nSo actually we should also try to do something sensible with `p.linear_constraints_parent()(False)`.",
    "created_at": "2022-12-28T23:35:55Z",
    "issue": "https://github.com/sagemath/sage/issues/34878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34878#issuecomment-564414",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:36'></a>
So actually we should also try to do something sensible with `p.linear_constraints_parent()(False)`.
