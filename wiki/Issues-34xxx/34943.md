# Issue 34943: classes for graphs and lattices

archive/issues_034706.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nWe have\n\n```\nsage: P = Posets(5); P\nPosets containing 5 elements\nsage: P.cardinality()\n63\nsage: next(iter(P))\nFinite poset containing 5 elements\n```\n\nIt would be nice to have the same for graphs and finite lattices.  For lattices, we have\n\n```\nsage: FiniteLatticePosets()\nCategory of finite lattice posets\nsage: from sage.databases.findstat import _finite_lattices\nsage: next(_finite_lattices(4))\nFinite lattice containing 4 elements\n```\nBesides, a fast iterator for finite lattices was proposed in #20516.\n\nFor graphs, we have an iterator.  Besides, it would be even nicer if we could generate the graphs so that they are immutable.  A subclass for connected graphs would be extra cool.\n\nCC:  @jm58660 @fchapoton\n\nComponent: **combinatorics**\n\nBranch/Commit: **[u/mantepse/classes_for_graphs_and_lattices](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/classes_for_graphs_and_lattices) @ [`c84d0a1`](https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34943_\n\n",
    "created_at": "2023-01-27T10:02:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "classes for graphs and lattices",
    "type": "issue",
    "updated_at": "2023-01-29T23:06:23Z",
    "url": "https://github.com/sagemath/sage/issues/34943",
    "user": "https://github.com/mantepse"
}
```
<div id="comment:0"></div>

We have

```
sage: P = Posets(5); P
Posets containing 5 elements
sage: P.cardinality()
63
sage: next(iter(P))
Finite poset containing 5 elements
```

It would be nice to have the same for graphs and finite lattices.  For lattices, we have

```
sage: FiniteLatticePosets()
Category of finite lattice posets
sage: from sage.databases.findstat import _finite_lattices
sage: next(_finite_lattices(4))
Finite lattice containing 4 elements
```
Besides, a fast iterator for finite lattices was proposed in #20516.

For graphs, we have an iterator.  Besides, it would be even nicer if we could generate the graphs so that they are immutable.  A subclass for connected graphs would be extra cool.

CC:  @jm58660 @fchapoton

Component: **combinatorics**

Branch/Commit: **[u/mantepse/classes_for_graphs_and_lattices](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/classes_for_graphs_and_lattices) @ [`c84d0a1`](https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22)**

_Issue created by migration from https://trac.sagemath.org/ticket/34943_





---

archive/issue_events_473078.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2023-01-27T10:02:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34943#event-473078"
}
```



---

archive/issue_events_473079.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2023-01-27T10:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34943#event-473079"
}
```



---

archive/issue_events_473080.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2023-01-27T10:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34943#event-473080"
}
```



---

archive/issue_events_473081.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2023-01-27T10:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34943#event-473081"
}
```



---

archive/issue_comments_562786.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nActually `graphs()` has parameter `copy`. Could it be removed and have `immutable` instead?\n\nOtherwise someone should just add the code from #20516, maybe as an internal function first.",
    "created_at": "2023-01-27T10:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562786",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:2" align="right">comment:2</div>

Actually `graphs()` has parameter `copy`. Could it be removed and have `immutable` instead?

Otherwise someone should just add the code from #20516, maybe as an internal function first.



---

archive/issue_comments_562787.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI agree that this might be a good solution.  Like so:\n\n```diff\ndiff --git a/src/sage/graphs/graph_generators.py b/src/sage/graphs/graph_generators.py\nindex df88bbe2713..7195a1a4866 100644\n--- a/src/sage/graphs/graph_generators.py\n+++ b/src/sage/graphs/graph_generators.py\n@@ -780,6 +780,7 @@ class GraphGenerators():\n                 degree_sequence is None and not loops and augment == 'edges' and\n                 sparse and copy):\n             for g in graphs.nauty_geng(vertices):\n+                g._immutable = True\n                 yield g\n             return\n```\nI ran the tests in `graphs` and `combinat` without any failures.  I guess that nobody will actually try to modify a graph generated using `graphs(5)`, and if this is desired, making a mutable copy should not be a problem.\n\n\nHowever, the current documentation suggests a different philosophy.\n\n```\n    - ``copy`` (boolean) -- If set to ``True`` (default)\n      this method makes copies of the graphs before returning\n      them. If set to ``False`` the method returns the graph it\n      is working on. The second alternative is faster, but modifying\n      any of the graph instances returned by the method may break\n      the function's behaviour, as it is using these graphs to\n      compute the next ones: only use ``copy = False`` when\n      you stick to *reading* the graphs returned.\n```\nUnfortunately, the `copy` keyword is not used at all in the entire sage library (with one trivial exception in `findstat.py` - it is not even doctested.  So I have no idea what the intended use is.",
    "created_at": "2023-01-27T11:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562787",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

I agree that this might be a good solution.  Like so:

```diff
diff --git a/src/sage/graphs/graph_generators.py b/src/sage/graphs/graph_generators.py
index df88bbe2713..7195a1a4866 100644
--- a/src/sage/graphs/graph_generators.py
+++ b/src/sage/graphs/graph_generators.py
@@ -780,6 +780,7 @@ class GraphGenerators():
                 degree_sequence is None and not loops and augment == 'edges' and
                 sparse and copy):
             for g in graphs.nauty_geng(vertices):
+                g._immutable = True
                 yield g
             return
```
I ran the tests in `graphs` and `combinat` without any failures.  I guess that nobody will actually try to modify a graph generated using `graphs(5)`, and if this is desired, making a mutable copy should not be a problem.


However, the current documentation suggests a different philosophy.

```
    - ``copy`` (boolean) -- If set to ``True`` (default)
      this method makes copies of the graphs before returning
      them. If set to ``False`` the method returns the graph it
      is working on. The second alternative is faster, but modifying
      any of the graph instances returned by the method may break
      the function's behaviour, as it is using these graphs to
      compute the next ones: only use ``copy = False`` when
      you stick to *reading* the graphs returned.
```
Unfortunately, the `copy` keyword is not used at all in the entire sage library (with one trivial exception in `findstat.py` - it is not even doctested.  So I have no idea what the intended use is.



---

archive/issue_comments_562788.json:
```json
{
    "body": "Branch: **[u/mantepse/classes_for_graphs_and_lattices](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/classes_for_graphs_and_lattices)**",
    "created_at": "2023-01-27T14:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562788",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/classes_for_graphs_and_lattices](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/classes_for_graphs_and_lattices)**



---

archive/issue_comments_562789.json:
```json
{
    "body": "Commit: **[`c84d0a1`](https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22)**",
    "created_at": "2023-01-27T15:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562789",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`c84d0a1`](https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22)**



---

archive/issue_comments_562790.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22\"><code>c84d0a1</code></a></td><td><code>infrastructure for lattice posets</code></td></tr></table>\n",
    "created_at": "2023-01-27T15:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562790",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c84d0a1267c4627a5991bd4c795a9e7232696b22"><code>c84d0a1</code></a></td><td><code>infrastructure for lattice posets</code></td></tr></table>




---

archive/issue_comments_562791.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI set up the infrastructure.  It remains to decide the immutability issue, and incorporate #20516.\n\nIn principle, #20516 could also be done later.",
    "created_at": "2023-01-27T15:44:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34943#issuecomment-562791",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">comment:6</div>

I set up the infrastructure.  It remains to decide the immutability issue, and incorporate #20516.

In principle, #20516 could also be done later.



---

archive/issue_events_473082.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-29T23:06:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34943",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34943#event-473082"
}
```
