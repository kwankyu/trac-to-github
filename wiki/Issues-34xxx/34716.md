# Issue 34716: fix assertion failure in _discrete_log_pgroup() when group is trivial

archive/issues_034479.json:
```json
{
    "body": "As of Sage 9.7, this causes an assertion failure:\n\n```sage\nsage: E = EllipticCurve(GF(487^2), [311,205])\nsage: G = E.abelian_group().torsion_subgroup(42)\nsage: P, Q = G.torsion_subgroup(6).gens()\nsage: G.discrete_log(2*P + 3*Q, [P, Q])\n```\n\nThe reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.\n\n**Branch/Commit:** [93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)\n\n**Reviewer:** Kwankyu Lee\n\n**Author:** Lorenz Panny\n\nIssue created by migration from https://trac.sagemath.org/ticket/34716\n\n",
    "closed_at": "2022-11-07T20:25:22Z",
    "created_at": "2022-11-02T17:01:49Z",
    "labels": [
        "component: group theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "fix assertion failure in _discrete_log_pgroup() when group is trivial",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/34716",
    "user": "https://github.com/yyyyx4"
}
```
As of Sage 9.7, this causes an assertion failure:

```sage
sage: E = EllipticCurve(GF(487^2), [311,205])
sage: G = E.abelian_group().torsion_subgroup(42)
sage: P, Q = G.torsion_subgroup(6).gens()
sage: G.discrete_log(2*P + 3*Q, [P, Q])
```

The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.

**Branch/Commit:** [93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)

**Reviewer:** Kwankyu Lee

**Author:** Lorenz Panny

Issue created by migration from https://trac.sagemath.org/ticket/34716





---

archive/issue_events_309879.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:02:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309879"
}
```



---

archive/issue_comments_562831.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n sage: G.discrete_log(2*P + 3*Q, [P, Q])\n ```\n \n-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.\n+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.\n``````\n",
    "created_at": "2022-11-02T17:02:31Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562831",
    "user": "https://github.com/yyyyx4"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 sage: G.discrete_log(2*P + 3*Q, [P, Q])
 ```
 
-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.
+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.
``````




---

archive/issue_events_309880.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:02:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "rename": {
        "from": "fix assertion failure in AdditiveAbelianGroupWrapper._discrete_log_pgroup when group is trivial",
        "to": "fix assertion failure in _discrete_log_pgroup() when group is trivial"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309880"
}
```



---

archive/issue_comments_562832.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n sage: G.discrete_log(2*P + 3*Q, [P, Q])\n ```\n \n-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.\n+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.\n``````\n",
    "created_at": "2022-11-03T03:59:59Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562832",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 sage: G.discrete_log(2*P + 3*Q, [P, Q])
 ```
 
-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.
+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.
``````




---

archive/issue_comments_562833.json:
```json
{
    "body": "<a id='comment:3'></a>\nWouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?",
    "created_at": "2022-11-03T04:02:18Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562833",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:3'></a>
Wouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?



---

archive/issue_comments_562834.json:
```json
{
    "body": "**Changing commit** from \"[ce4c48ca56e6fd502049e06191e79f09a17588e1](https://github.com/sagemath/sagetrac-mirror/commit/ce4c48ca56e6fd502049e06191e79f09a17588e1)\" to \"[bd5687cc890ffa10f1de71f4cdd79568ad7afa18](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)\".",
    "created_at": "2022-11-03T05:35:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ce4c48ca56e6fd502049e06191e79f09a17588e1](https://github.com/sagemath/sagetrac-mirror/commit/ce4c48ca56e6fd502049e06191e79f09a17588e1)" to "[bd5687cc890ffa10f1de71f4cdd79568ad7afa18](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)".



---

archive/issue_comments_562835.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18\">bd5687c</a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>\n",
    "created_at": "2022-11-03T05:35:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18">bd5687c</a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>




---

archive/issue_comments_562836.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.",
    "created_at": "2022-11-03T05:39:20Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562836",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:5'></a>
Thanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.



---

archive/issue_comments_562837.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [Lorenz Panny](#comment%3A5):\n> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.\n\nAs it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.\n\nBut if you still want to keep it for the reason you mentioned, just let me know.",
    "created_at": "2022-11-03T06:12:46Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562837",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:6'></a>
Replying to [Lorenz Panny](#comment%3A5):
> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.

As it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.

But if you still want to keep it for the reason you mentioned, just let me know.



---

archive/issue_comments_562838.json:
```json
{
    "body": "**Changing commit** from \"[bd5687cc890ffa10f1de71f4cdd79568ad7afa18](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)\" to \"[93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)\".",
    "created_at": "2022-11-03T06:27:13Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bd5687cc890ffa10f1de71f4cdd79568ad7afa18](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)" to "[93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)".



---

archive/issue_comments_562839.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339\">93dc05c</a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>\n",
    "created_at": "2022-11-03T06:27:13Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339">93dc05c</a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>




---

archive/issue_comments_562840.json:
```json
{
    "body": "<a id='comment:8'></a>\nI don't mind. Done.",
    "created_at": "2022-11-03T06:30:33Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562840",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'></a>
I don't mind. Done.



---

archive/issue_comments_562841.json:
```json
{
    "body": "**Reviewer:** Kwankyu Lee",
    "created_at": "2022-11-03T12:03:45Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562841",
    "user": "https://github.com/kwankyu"
}
```

**Reviewer:** Kwankyu Lee



---

archive/issue_comments_562842.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks. LGTM.",
    "created_at": "2022-11-03T12:03:45Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562842",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:9'></a>
Thanks. LGTM.



---

archive/issue_events_309881.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-11-03T12:03:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309881"
}
```



---

archive/issue_events_309882.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-11-03T12:03:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309882"
}
```



---

archive/issue_events_309883.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-11-07T20:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309883"
}
```



---

archive/issue_events_309884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4edaafebeede460a24c52c2d647da7a4c7fc40a4",
    "created_at": "2022-11-07T20:25:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-309884"
}
```



---

archive/issue_comments_562843.json:
```json
{
    "body": "**Changing branch** from \"[public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log)\" to \"[93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)\".",
    "created_at": "2022-11-07T20:25:22Z",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-562843",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log)" to "[93dc05ccd9a6bf3358e57902cf84da87b0d91339](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)".
